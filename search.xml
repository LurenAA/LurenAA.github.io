<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>å¦‚ä½•è§£å†³basic_string::_M_createé”™è¯¯ï¼Ÿ</title>
      <link href="/2020/03/03/problems7/"/>
      <url>/2020/03/03/problems7/</url>
      
        <content type="html"><![CDATA[<h4 id="ğŸ‘½åŸå› "><a href="#ğŸ‘½åŸå› " class="headerlink" title="ğŸ‘½åŸå› "></a>ğŸ‘½åŸå› </h4><p>&emsp;&emsp;åŸå› åœ¨äºä½¿ç”¨string(iter1, iter2)è¿™ä¸ªæ„é€ å‡½æ•°æ—¶ï¼Œ<strong>iter1&gt;iter2</strong>ã€‚</p><p>å³ï¼š <strong>å­—ç¬¦ä¸²æ„é€ å¤±è´¥</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">s</span><span class="params">(<span class="string">"abc"</span>)</span></span>;</span><br><span class="line">    <span class="built_in">string</span>::const_iterator ie = s.cbegin() + <span class="number">1</span>,</span><br><span class="line">      ia = s.cbegin() ;</span><br><span class="line">    <span class="built_in">string</span> as = <span class="built_in">string</span>(ie, ia);</span><br><span class="line">  &#125;<span class="keyword">catch</span>(exception&amp; e) &#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; e.what() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ğŸ‘ºç”±æ¥ï¼ˆåºŸè¯-ï¼‰"><a href="#ğŸ‘ºç”±æ¥ï¼ˆåºŸè¯-ï¼‰" class="headerlink" title="ğŸ‘ºç”±æ¥ï¼ˆåºŸè¯ ï¼‰"></a>ğŸ‘ºç”±æ¥ï¼ˆ<del>åºŸè¯</del> ï¼‰</h4><p>&emsp;&emsp;æœ€è¿‘åœ¨æŒ‚æœåŠ¡å™¨çš„æ—¶å€™ç»å¸¸é‡è§ä¸€ä¸ªè«åçš„å´©æºƒåŸå› ï¼šbasic_string::<em>M</em>createã€‚ä¸ç®¡æ˜¯ç™¾åº¦è¿˜æ˜¯googleæ€»æ˜¯æ‰¾ä¸åˆ°ç›¸å…³çš„é—®é¢˜ï¼Œåœ¨stackflowä¸Šä¹Ÿæ²¡èƒ½æ‰¾åˆ°åˆç†çš„ç­”æ¡ˆï¼Œstackflowä¸Š<a href="https://stackoverflow.com/questions/38070031/c-terminate-called-after-throwing-an-instance-of-stdlength-error-what" target="_blank" rel="noopener">å”¯ä¸€ä¸€ä¸ªç›¸å…³é—®é¢˜</a>æ˜¯ä¸mysqlç›¸å…³çš„ï¼Œå› ä¸ºæˆ‘ä¹Ÿä½¿ç”¨äº†mysqlçš„æ¥å£ï¼Œè®©æˆ‘ä¸ç¦è§‰å¾—è¿™ä¸ªé—®é¢˜æ¥è‡ªäºmysqlçš„æ’ä»¶ï¼Œæœ€åæˆ‘å‘ç°é—®é¢˜åœ¨äºæˆ‘è‡ªå·±å†™çš„Httpè§£æç»„ä»¶ã€‚</p><p><img src="https://img-blog.csdnimg.cn/20191016215520543.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMDE1MDQ4,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/20191016220615453.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
      
      
      
        <tags>
            
            <tag> é‡è§çš„é—®é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ¨æ€è§„åˆ’</title>
      <link href="/2020/03/03/alg9/"/>
      <url>/2020/03/03/alg9/</url>
      
        <content type="html"><![CDATA[<h4 id="ğŸ‘ºåŠ¨æ€è§„åˆ’å®šä¹‰"><a href="#ğŸ‘ºåŠ¨æ€è§„åˆ’å®šä¹‰" class="headerlink" title="ğŸ‘ºåŠ¨æ€è§„åˆ’å®šä¹‰"></a>ğŸ‘ºåŠ¨æ€è§„åˆ’å®šä¹‰</h4><blockquote><p>åŠ¨æ€è§„åˆ’åœ¨å¯»æ‰¾æœ‰å¾ˆå¤šé‡å å­é—®é¢˜çš„æƒ…å†µçš„æœ€ä½³è§£æ—¶æœ‰æ•ˆã€‚å®ƒå°†é—®é¢˜é‡æ–°ç»„åˆæˆå­é—®é¢˜ã€‚ä¸ºäº†é¿å…å¤šæ¬¡è§£å†³è¿™äº›å­é—®é¢˜ï¼Œå®ƒä»¬çš„ç»“æœéƒ½é€æ¸è¢«è®¡ç®—å¹¶è¢«å‚¨å­˜ï¼Œä»ç®€å•çš„é—®é¢˜ç›´åˆ°æ•´ä¸ªé—®é¢˜éƒ½è¢«è§£å†³ã€‚å› æ­¤ï¼ŒåŠ¨æ€è§„åˆ’å‚¨å­˜é€’è¿´æ—¶çš„ç»“æœï¼Œå› è€Œä¸ä¼šåœ¨è§£å†³åŒæ ·çš„é—®é¢˜æ—¶èŠ±è´¹æ—¶é—´ã€‚</p></blockquote><br><h4 id="ğŸ¤¡åŠ¨æ€è§„åˆ’æ­ªè§£"><a href="#ğŸ¤¡åŠ¨æ€è§„åˆ’æ­ªè§£" class="headerlink" title="ğŸ¤¡åŠ¨æ€è§„åˆ’æ­ªè§£"></a>ğŸ¤¡<del>åŠ¨æ€è§„åˆ’æ­ªè§£</del></h4><p>æˆ‘ä»¬å…ˆè®¡ç®—1+1+1+1+1+1+1+1+1+1ç­‰äºå¤šå°‘ã€‚é€šè¿‡è®¡ç®—ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ä¸Šé¢é‚£ä¸ªå¼å­ç­‰äº10ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ä¸Šé¢é‚£ä¸ªå¼å­çš„å·¦è¾¹å†åŠ ä¸Šä¸€ä¸ª1+å‘¢ï¼Ÿæˆ‘ä»¬ä¸ç”¨ç”¨æ‰‹è®¡ç®—å°±å¯ä»¥ç›´æ¥çŸ¥é“ç­‰äº11.å› ä¸ºæˆ‘ä»¬çŸ¥é“äº†&emsp;&emsp;<strong>1+ä¸Šé¢é‚£ä¸ªå¼å­</strong>&emsp;&emsp;è€Œè¿™ä¸ªç»“æ„ä¸­ï¼Œ<strong>é‚£ä¸ªå¼å­</strong>ç»“æœç­‰äº10ï¼Œæˆ‘ä»¬è®°å¿†ä½äº†ï¼Œé¿å…äº†é‡å¤è®¡ç®—ã€‚è¿™å°±æ˜¯åŠ¨æ€è§„åˆ’ã€‚</p><br><h4 id="ğŸ§‘â€åŠ¨æ€è§„åˆ’æ­¥éª¤"><a href="#ğŸ§‘â€åŠ¨æ€è§„åˆ’æ­¥éª¤" class="headerlink" title="ğŸ§‘â€åŠ¨æ€è§„åˆ’æ­¥éª¤"></a>ğŸ§‘â€åŠ¨æ€è§„åˆ’æ­¥éª¤</h4><ol><li><p>å»ºç«‹çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼ˆæœ€éš¾ä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€æ­¥ï¼‰</p></li><li><p>ç¼“å­˜å¹¶å¤ç”¨ä»¥å¾€ç»“æœ</p></li><li><p>æŒ‰é¡ºåºä»å°å¾€å¤§ç®—ï¼ˆè‡ªåº•å‘ä¸Šï¼‰</p></li></ol><br><h4 id="ğŸ¥¶ä¸ªäººç†è§£"><a href="#ğŸ¥¶ä¸ªäººç†è§£" class="headerlink" title="ğŸ¥¶ä¸ªäººç†è§£"></a>ğŸ¥¶ä¸ªäººç†è§£</h4><p>æ€»ç»“æ¥è¯´ï¼ŒåŠ¨æ€è§„åˆ’å…·æœ‰<strong>æœ€ä¼˜å­ç»“æ„</strong>å’Œ<strong>é‡å å­é—®é¢˜</strong>çš„ç‰¹ç‚¹ï¼Œ åŠ¨æ€è§„åˆ’çš„é—®é¢˜ä¸€èˆ¬éƒ½å’Œé€’å½’æœ‰ç›¸å…³æ€§ï¼Œ<strong>å¹¶ä¸”åŠ¨æ€è§„åˆ’èƒ½å¤Ÿä¼˜åŒ–é€’å½’ï¼Œå‡å°‘é‡å¤çš„è®¡ç®—é‡</strong>ã€‚ä¹Ÿå°±æ˜¯<strong>é€’å½’+å¤‡å¿˜å½•è®°å½•å€¼</strong>çš„æ•ˆæœã€‚</p><p>ä»å¦ä¸€ä¸ªè§’åº¦æ¥çœ‹ï¼Œå…¶å®å¯ä»¥è¯´<strong>æ¯ä¸€ä¸ªåŠ¨æ€è§„åˆ’é—®é¢˜éƒ½å¯ä»¥ç”¨é€’å½’æ¥è§£å†³</strong>ï¼Œå› ä¸ºåŠ¨æ€è§„åˆ’æ˜¯é€’å½’çš„ä¸€ç§ä¼˜åŒ–ï¼Œå‰Šå‡äº†å¯¹äºåŒä¸€ä¸ªå­é—®é¢˜çš„é‡å¤è®¡ç®—æ‰€æµªè´¹çš„æ—¶é—´ã€‚</p><p>ã€Šå‰‘æŒ‡offerã€‹ä¸­æœ‰å¥è¯æ€»ç»“çš„å¥½ï¼šé€šå¸¸åº”ç”¨åŠ¨æ€è§„åˆ’è§£å†³é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬éƒ½æ˜¯ç”¨é€’å½’çš„æ€è·¯æ¥åˆ†æé—®é¢˜çš„ã€‚</p><br><h4 id="ğŸ¶è´ªå¿ƒç®—æ³•ä¸åŠ¨æ€è§„åˆ’"><a href="#ğŸ¶è´ªå¿ƒç®—æ³•ä¸åŠ¨æ€è§„åˆ’" class="headerlink" title="ğŸ¶è´ªå¿ƒç®—æ³•ä¸åŠ¨æ€è§„åˆ’"></a>ğŸ¶è´ªå¿ƒç®—æ³•ä¸åŠ¨æ€è§„åˆ’</h4><p>è´ªå¿ƒç®—æ³•ç€çœ¼äºå½“å‰é˜¶æ®µçš„æœ€ä¼˜è§£ï¼Œå¹¶ä¸”<strong>æœŸæœ›</strong>è¿™æ ·ä¸‹æ¥å¾—åˆ°çš„ç»“æœæ˜¯å…¨å±€çš„æœ€ä¼˜è§£ï¼ˆå®é™…ä¸Šæœªå¿…æ˜¯ï¼‰ã€‚ç›¸æ¯”äºåŠ¨æ€è§„åˆ’æœ‰ä¸€å®šçš„å›ºå®šæ¨¡å¼æ¥è¯´ï¼Œè´ªå¿ƒæ›´åå‘æ˜¯ä¸€ç§æ€æƒ³ã€‚</p><p>åŠ¨æ€è§„åˆ’æ˜¯è®¡ç®—äº†æ‰€æœ‰å­é—®é¢˜çš„æœ€ä¼˜è§£ï¼Œåœ¨æœ€åé€šè¿‡ä¸Šå±‚æ¥ç›´æ¥è·å–å…¨å±€æœ€ä¼˜è§£ã€‚å³<strong>åŠ¨æ€è§„åˆ’åœ¨è®¡ç®—å­é—®é¢˜æ—¶æ˜¯æ²¡æœ‰åå¥½çš„ï¼Œå®ƒä¼šè®¡ç®—æ‰€æœ‰çš„å­é—®é¢˜</strong>ã€‚è€Œè´ªå¿ƒç®—æ³•ï¼Œå› ä¸ºè´ªå¿ƒï¼ŒåŒæ ·çš„å­é—®é¢˜ä»–åªä¼šè®¡ç®—æœ€å¤§ï¼ˆä¼˜ï¼‰çš„ä¸€ä¸ªã€‚</p><p>è´ªå¿ƒç®—æ³•æ˜¯æ¯ä¸€æ­¥åªé€‰æœ€ä¼˜çš„ï¼Œå¹¶ä¸”æœŸæœ›æ¯ä¸€æ­¥é€‰æ‹©çš„æœ€ä¼˜è§£èƒ½è¾¾æˆå…¨å±€çš„æœ€ä¼˜è§£ï¼Œè¯´å®è¯è¿™å¤ªéš¾äº†ï¼Œå› ä¸ºä¸€èˆ¬ä¸€ä¸ªé—®é¢˜çš„é€‰æ‹©éƒ½ä¼šå½±å“ä¸‹ä¸€ä¸ªé—®é¢˜çš„é€‰æ‹©ï¼Œé™¤é<strong>å­é—®é¢˜ä¹‹é—´å®Œå…¨ç‹¬ç«‹ï¼Œæ²¡æœ‰å…³è”</strong>ï¼Œæ¯”å¦‚<strong>å‡‘é›¶é’±çš„ä¾‹å­</strong>ï¼Œ å¦‚æœä¸€ä¸ªå›½å®¶çš„é’ç¥¨æ¯”è¾ƒå¥‡è‘©ï¼Œåªæœ‰ 1ï¼Œ5ï¼Œ11 è¿™ä¸‰ç§é¢å€¼çš„é’ç¥¨ï¼Œå¦‚ä½•ç”¨æœ€å°‘çš„é’ç¥¨å‡‘å‡º 15 å‘¢ï¼Œå¦‚æœç”¨è´ªå¿ƒç¬¬ä¸€æ¬¡é€‰ 11ï¼Œ é‚£ä¹‹ååªèƒ½é€‰ 4 å¼  1 äº†ï¼Œå³ 15 = 1 x 11 + 4 x1ã€‚å…¶å®æœ€ä¼˜è§£åº”è¯¥æ˜¯ 3 å¼  5 å…ƒçš„é’ç¥¨ï¼Œä¸ºå•¥è¿™ç§æƒ…å†µä¸‹ç”¨è´ªå¿ƒä¸é€‚ç”¨å‘¢ï¼Œå› ä¸ºç¬¬ä¸€æ¬¡é€‰äº† 11ï¼Œå½±å“äº†åé¢é’ç¥¨çš„é€‰æ‹©ï¼Œä¹Ÿå°±æ˜¯è¯´å­é—®é¢˜ä¹‹é—´å¹¶ä¸æ˜¯ç‹¬ç«‹çš„ï¼Œè€Œæ˜¯äº’ç›¸åˆ¶çº¦ï¼Œäº’æœ‰å½±å“çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰è´ªå¿ƒçš„æ—¶å€™ä¸€å®šè¦æ³¨æ„å®ƒçš„é€‚ç”¨åœºæ™¯ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ’åºç®—æ³•æ¢³ç†</title>
      <link href="/2020/02/25/alg8/"/>
      <url>/2020/02/25/alg8/</url>
      
        <content type="html"><![CDATA[<h4 id="ğŸ¶å†’æ³¡æ’åº"><a href="#ğŸ¶å†’æ³¡æ’åº" class="headerlink" title="ğŸ¶å†’æ³¡æ’åº"></a>ğŸ¶å†’æ³¡æ’åº</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * &lt;å†’æ³¡æ’åº&gt;</span><br><span class="line"> * æ—¶é—´å¤æ‚åº¦: æœ€å¥½O(n) æœ€åO(n^2) å¹³å‡O(n^2) ç¨³å®š</span><br><span class="line"> * ç©ºé—´å¤æ‚åº¦: O(1)</span><br><span class="line">  (5)   2   3   4   2   1   0</span><br><span class="line">   2   (5)   3   4   2   1   0</span><br><span class="line">   2   3   (5)   4   2   1   0</span><br><span class="line">   2   3   4   (5)   2   1   0</span><br><span class="line">   2   2   3   4   (5)   1   0</span><br><span class="line">   1   2   2   3   4   (5)   0</span><br><span class="line">   0   1   2   2   3   4   (5)</span><br><span class="line">  */</span><br><span class="line">class Solution &#123;</span><br><span class="line">public:</span><br><span class="line">    vector&lt;int&gt; sortArray(vector&lt;int&gt;&amp; nums) &#123;</span><br><span class="line">        for(int i = 0; i &lt; nums.size(); ++i) </span><br><span class="line">            for(int j = i + 1; j &lt; nums.size(); ++j) &#123;</span><br><span class="line">                if(nums[i] &gt; nums[j])</span><br><span class="line">                    swap(nums[i], nums[j]);</span><br><span class="line">            &#125;</span><br><span class="line">        return nums;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="ğŸ™ˆé€‰æ‹©æ’åº"><a href="#ğŸ™ˆé€‰æ‹©æ’åº" class="headerlink" title="ğŸ™ˆé€‰æ‹©æ’åº"></a>ğŸ™ˆé€‰æ‹©æ’åº</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * &lt;é€‰æ‹©æ’åº&gt;</span><br><span class="line"> * æ—¶é—´å¤æ‚åº¦: æœ€å¥½O(n^2) æœ€åO(n^2) å¹³å‡O(n^2) ç¨³å®š</span><br><span class="line"> * ç©ºé—´å¤æ‚åº¦: O(1)</span><br><span class="line"> */</span><br><span class="line">class Solution &#123;</span><br><span class="line">public:</span><br><span class="line">    vector&lt;int&gt; sortArray(vector&lt;int&gt;&amp; nums) &#123;</span><br><span class="line">        for(int i = 0; i &lt; nums.size(); ++i) &#123;</span><br><span class="line">            int _min = i;</span><br><span class="line">            for(int j = i + 1; j &lt; nums.size(); ++j) </span><br><span class="line">                if(nums[j] &lt; nums[_min]) _min = j;</span><br><span class="line">            swap(nums[_min], nums[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        return nums;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="ğŸ‘ºæ’å…¥æ’åº"><a href="#ğŸ‘ºæ’å…¥æ’åº" class="headerlink" title="ğŸ‘ºæ’å…¥æ’åº"></a>ğŸ‘ºæ’å…¥æ’åº</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * &lt;æ’å…¥æ’åº&gt;</span><br><span class="line"> * æ—¶é—´å¤æ‚åº¦: æœ€å¥½O(n) æœ€åO(n^2) å¹³å‡O(n^2) ç¨³å®š</span><br><span class="line"> * ç©ºé—´å¤æ‚åº¦: O(1)</span><br><span class="line"> */</span><br><span class="line">class Solution &#123;</span><br><span class="line">public:</span><br><span class="line">    vector&lt;int&gt; sortArray(vector&lt;int&gt;&amp; nums) &#123;</span><br><span class="line">        for(int i = 1; i &lt; nums.size(); ++i)</span><br><span class="line">            for(int j = i; j &gt; 0 &amp;&amp; nums[j] &lt; nums[j-1]; --j) </span><br><span class="line">                swap(nums[j-1], nums[j]);</span><br><span class="line">        return nums;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="ğŸƒå¸Œå°”æ’åº"><a href="#ğŸƒå¸Œå°”æ’åº" class="headerlink" title="ğŸƒå¸Œå°”æ’åº"></a>ğŸƒå¸Œå°”æ’åº</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * &lt;å¸Œå°”æ’åº&gt; / &lt;ç¼©å°å¢é‡æ’åº&gt;</span><br><span class="line"> * æ—¶é—´å¤æ‚åº¦: å¹³å‡O(n^1.3) ä¸ç¨³å®š</span><br><span class="line"> * ç©ºé—´å¤æ‚åº¦: O(1)</span><br><span class="line"> * ç‰¹ç‚¹: ç¼©å°å¢é‡çš„æ’å…¥æ’åº</span><br><span class="line"> */</span><br><span class="line">class Solution &#123;</span><br><span class="line">public:</span><br><span class="line">    vector&lt;int&gt; sortArray(vector&lt;int&gt;&amp; nums) &#123;</span><br><span class="line">        int h = 1;</span><br><span class="line">        while(h &lt; nums.size() / 3) h = h * 3 + 1;</span><br><span class="line">        while(h &gt;= 1) &#123;</span><br><span class="line">            for(int i = h; i &lt; nums.size(); i+= h)  &#123;</span><br><span class="line">                for(int j = i; j &gt;= h &amp;&amp; nums[j] &lt; nums[j - h]; j -= h) </span><br><span class="line">                    swap(nums[j], nums[j - h]);</span><br><span class="line">            &#125;</span><br><span class="line">            h = h / 3;</span><br><span class="line">        &#125;</span><br><span class="line">        return nums;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="ğŸ‘©â€ğŸš’å½’å¹¶æ’åº"><a href="#ğŸ‘©â€ğŸš’å½’å¹¶æ’åº" class="headerlink" title="ğŸ‘©â€ğŸš’å½’å¹¶æ’åº"></a>ğŸ‘©â€ğŸš’å½’å¹¶æ’åº</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * &lt;å½’å¹¶æ’åº&gt;</span><br><span class="line"> * æ—¶é—´å¤æ‚åº¦: æœ€å¥½O(n*log(n)) æœ€åO(n*log(n)) å¹³å‡O(n*log(n)) ç¨³å®š</span><br><span class="line"> * ç©ºé—´å¤æ‚åº¦: O(n)</span><br><span class="line"> */</span><br><span class="line">class Solution &#123;</span><br><span class="line">public:</span><br><span class="line">    vector&lt;int&gt; aux;</span><br><span class="line">    vector&lt;int&gt; sortArray(vector&lt;int&gt;&amp; nums) &#123;</span><br><span class="line">        aux.resize(nums.size());</span><br><span class="line">        _sortArray(nums, 0, nums.size() - 1);</span><br><span class="line">        return nums;</span><br><span class="line">    &#125;</span><br><span class="line">    void _sortArray(vector&lt;int&gt;&amp; nums, int lo, int hi) &#123;</span><br><span class="line">        if(hi &lt;= lo)</span><br><span class="line">            return ;</span><br><span class="line">        int mid = lo + (hi - lo) / 2;</span><br><span class="line">        _sortArray(nums,lo ,mid);</span><br><span class="line">        _sortArray(nums, mid + 1, hi);</span><br><span class="line">        merge(nums, lo, mid, hi);</span><br><span class="line">    &#125;</span><br><span class="line">    void merge(vector&lt;int&gt;&amp; nums, int lo, int mid, int hi) &#123;</span><br><span class="line">        int i = lo, j = mid + 1;</span><br><span class="line">        for(int k = lo; k &lt;= hi; ++k) </span><br><span class="line">            aux[k] = nums[k];</span><br><span class="line">        for(int k = lo; k &lt;= hi; ++k) &#123;</span><br><span class="line">            if(i &gt; mid) nums[k] = aux[j++];</span><br><span class="line">            else if (j &gt; hi) nums[k] = aux[i++];</span><br><span class="line">            else if (aux[i] &lt; aux[j]) nums[k] = aux[i++];</span><br><span class="line">            else nums[k] = aux[j++]; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//è‡ªåº•å‘ä¸Š</span><br><span class="line">class Solution &#123;</span><br><span class="line">public:</span><br><span class="line">    vector&lt;int&gt; aux;</span><br><span class="line">    vector&lt;int&gt; sortArray(vector&lt;int&gt;&amp; nums) &#123;</span><br><span class="line">        aux.resize(nums.size());</span><br><span class="line">        for(int sz = 1; sz &lt; nums.size(); sz = 2 * sz)</span><br><span class="line">            for(int lo = 0; lo &lt; nums.size(); lo += sz + sz) </span><br><span class="line">                merge(nums, lo, lo + sz - 1, min(lo + sz + sz - 1, (int)nums.size() - 1));</span><br><span class="line">        return nums;</span><br><span class="line">    &#125;</span><br><span class="line">    void merge(vector&lt;int&gt;&amp; nums, int lo, int mid, int hi) &#123;</span><br><span class="line">        int i = lo, j = mid + 1;</span><br><span class="line">        for(int k = lo; k &lt;= hi; ++k) </span><br><span class="line">            aux[k] = nums[k];</span><br><span class="line">        for(int k = lo; k &lt;= hi; ++k) &#123;</span><br><span class="line">            if(i &gt; mid) nums[k] = aux[j++];</span><br><span class="line">            else if (j &gt; hi) nums[k] = aux[i++];</span><br><span class="line">            else if (aux[i] &lt; aux[j]) nums[k] = aux[i++];</span><br><span class="line">            else nums[k] = aux[j++]; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="ğŸ§‘â€å¿«é€Ÿæ’åº"><a href="#ğŸ§‘â€å¿«é€Ÿæ’åº" class="headerlink" title="ğŸ§‘â€å¿«é€Ÿæ’åº"></a>ğŸ§‘â€å¿«é€Ÿæ’åº</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * &lt;å¿«é€Ÿæ’åº&gt;</span><br><span class="line"> * æ—¶é—´å¤æ‚åº¦: æœ€å¥½O(n*log(n)) æœ€åO(n^2) å¹³å‡O(n*log(n)) ä¸ç¨³å®š</span><br><span class="line"> * ç©ºé—´å¤æ‚åº¦: O(log(n))</span><br><span class="line"> * ç‰¹ç‚¹: æœ¬è´¨æ˜¯ç»™åŸºå‡†æ•°æ‰¾å…¶æ­£ç¡®ä½ç½®çš„è¿‡ç¨‹.</span><br><span class="line"> */</span><br><span class="line">class Solution &#123;</span><br><span class="line">public:</span><br><span class="line">    vector&lt;int&gt; sortArray(vector&lt;int&gt;&amp; nums) &#123;</span><br><span class="line">        sort(nums, 0, nums.size() - 1);</span><br><span class="line">        return nums;</span><br><span class="line">    &#125;</span><br><span class="line">    void sort(vector&lt;int&gt;&amp; nums, int lo, int hi) &#123;</span><br><span class="line">        if(lo &gt;= hi)</span><br><span class="line">            return ;</span><br><span class="line">        int k = parti(nums, lo, hi);</span><br><span class="line">        sort(nums, lo, k - 1);</span><br><span class="line">        sort(nums, k + 1, hi);</span><br><span class="line">    &#125;</span><br><span class="line">    int parti(vector&lt;int&gt;&amp; nums, int lo, int hi) &#123;</span><br><span class="line">        int lf = lo, rt = hi + 1;</span><br><span class="line">        int v = nums[lo];</span><br><span class="line">        while(true) &#123;</span><br><span class="line">            while(nums[++lf] &lt;= v) if(lf == hi) break;</span><br><span class="line">            while(nums[--rt] &gt;= v) if(rt == lo) break;</span><br><span class="line">            if(lf &gt;= rt)</span><br><span class="line">                break;</span><br><span class="line">            swap(nums[lf], nums[rt]);</span><br><span class="line">        &#125;</span><br><span class="line">        swap(nums[lo], nums[rt]);</span><br><span class="line">        return rt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="ğŸ¸å †æ’åº"><a href="#ğŸ¸å †æ’åº" class="headerlink" title="ğŸ¸å †æ’åº"></a>ğŸ¸å †æ’åº</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * &lt;å †æ’åº&gt;</span><br><span class="line"> * æ—¶é—´å¤æ‚åº¦: æœ€å¥½O(n*log(n)) æœ€åO(n*log(n)) å¹³å‡O(n*log(n)) ä¸ç¨³å®š</span><br><span class="line"> * ç©ºé—´å¤æ‚åº¦: O(1)</span><br><span class="line"> */</span><br><span class="line">class Solution &#123;</span><br><span class="line">public:</span><br><span class="line">    vector&lt;int&gt; sortArray(vector&lt;int&gt;&amp; nums) &#123;</span><br><span class="line">        int N = nums.size();</span><br><span class="line">        nums.insert(nums.begin(), 0);</span><br><span class="line">        // for(int i = N / 2; i &gt;= 1; --i)</span><br><span class="line">        //     sink(nums, i, N);</span><br><span class="line">        for(int i = 1; i &lt;= N; ++i) </span><br><span class="line">            swim(nums, i ,N);</span><br><span class="line">        while(N &gt; 1) &#123;</span><br><span class="line">            swap(nums[1], nums[N--]);</span><br><span class="line">            sink(nums, 1, N);</span><br><span class="line">        &#125;</span><br><span class="line">        nums.erase(nums.begin());</span><br><span class="line">        return nums;</span><br><span class="line">    &#125;</span><br><span class="line">    void sink(vector&lt;int&gt;&amp; nums, int i, int N) &#123;</span><br><span class="line">        while(i &lt;= N / 2) &#123;</span><br><span class="line">            int k = i * 2;</span><br><span class="line">            if(k + 1 &lt;= N &amp;&amp; nums[k] &lt; nums[k + 1]) k = k + 1;</span><br><span class="line">            if(nums[i] &gt;= nums[k]) break;</span><br><span class="line">            swap(nums[k], nums[i]);</span><br><span class="line">            i = k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    void swim(vector&lt;int&gt;&amp; nums, int i, int N) &#123;</span><br><span class="line">        while(i &gt; 1 &amp;&amp; nums[i] &gt;= nums[i / 2]) &#123;</span><br><span class="line">            swap(nums[i], nums[i / 2]);</span><br><span class="line">            i /= 2;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>äºŒåˆ†æŸ¥æ‰¾çš„ç»†èŠ‚æ€»ç»“</title>
      <link href="/2020/02/18/alg7/"/>
      <url>/2020/02/18/alg7/</url>
      
        <content type="html"><![CDATA[<h4 id="ğŸ¶ç»“æ„1è¾¨æ"><a href="#ğŸ¶ç»“æ„1è¾¨æ" class="headerlink" title="ğŸ¶ç»“æ„1è¾¨æ"></a>ğŸ¶ç»“æ„1è¾¨æ</h4><p>&emsp;&emsp;è¿™é‡Œä»‹ç»ç¬¬ä¸€ç§ç»“æ„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function binary_search(A, n, T) is</span><br><span class="line">    L := 0</span><br><span class="line">    R := n âˆ’ 1</span><br><span class="line">    while L â‰¤ R do</span><br><span class="line">        m := floor((L + R) / 2)</span><br><span class="line">        if A[m] &lt; T then</span><br><span class="line">            L := m + 1</span><br><span class="line">        else if A[m] &gt; T then</span><br><span class="line">            R := m - 1</span><br><span class="line">        else:</span><br><span class="line">            return m</span><br><span class="line">    return unsuccessful</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;è¿™é‡Œ<strong>m := floor((L + R) / 2)</strong>æœ‰æ—¶ä¼šæ›¿æ¢æˆ<strong>m := ceiling((L + R) / 2)</strong>ï¼Œç®€å•æ¥è¯´å°±æ˜¯(L + R) / 2æ›¿æ¢æˆ(L + R + 1) / 2ã€‚</p><p>&emsp;&emsp;åœ¨ä»¥ä¸Šç»“æ„ä¸­è¿™ä¸ªè¯­å¥çš„æ›¿æ¢<strong>ä¸ä¼šå½±å“ç®—æ³•çš„æ­£ç¡®æ€§</strong>ã€‚ä¸è¿‡åœ¨ç›®æ ‡Tåœ¨æ•°ç»„Aä¸­æœ‰å¤šä¸ªçš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå½±å“åˆ°åº•è¿”å›å¤šä¸ªTä¸­çš„å“ªä¸€ä¸ªã€‚</p><p>&emsp;&emsp;æ¯”å¦‚[1 2 2 2 3 4]ï¼Œåœ¨flooræ—¶è¿”å›çš„ä¸‹æ ‡æ˜¯2ï¼Œåœ¨ceilingæ—¶è¿”å›çš„ä¸‹æ ‡æ˜¯3.</p><h4 id="ğŸ¦Šä¼˜åŒ–1"><a href="#ğŸ¦Šä¼˜åŒ–1" class="headerlink" title="ğŸ¦Šä¼˜åŒ–1"></a>ğŸ¦Šä¼˜åŒ–1</h4><p>&emsp;&emsp;è¿™é‡Œæœ‰ä¸€ä¸ªå¯ä»¥å°ä¼˜åŒ–çš„åœ°æ–¹ï¼ŒL+Rå­˜åœ¨æ•´å½¢æº¢å‡ºçš„æƒ…å†µï¼Œå¯ä»¥æ”¹ä¸ºL + ï¼ˆR - L) / 2é¿å…æº¢å‡ºé—®é¢˜ã€‚</p><h4 id="ğŸ¹ç»“æ„2è¾¨æ"><a href="#ğŸ¹ç»“æ„2è¾¨æ" class="headerlink" title="ğŸ¹ç»“æ„2è¾¨æ"></a>ğŸ¹ç»“æ„2è¾¨æ</h4><p>&emsp;&emsp;è¿™å…¶å®ä¹Ÿæ˜¯ä¸€ç§ä¼˜åŒ–ï¼Œå› ä¸ºä»¥ä¸Šç»“æ„ä¸­åœ¨æ¯ä¸ªå¾ªç¯ä¸­æ¯”è¾ƒæ¬¡æ•°å¤ªå¤šï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç»“æ„æ¥ä»£æ›¿ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function binary_search_alternative(A, n, T) is</span><br><span class="line">    L := 0</span><br><span class="line">    R := n âˆ’ 1</span><br><span class="line">    while L != R do</span><br><span class="line">        m := ceil((L + R) / 2)</span><br><span class="line">        if A[m] &gt; T then</span><br><span class="line">            R := m - 1</span><br><span class="line">        else:</span><br><span class="line">            L := m</span><br><span class="line">    if A[L] = T then</span><br><span class="line">        return L</span><br><span class="line">    return unsuccessful</span><br></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function binary_search_alternative(A, n, T) is</span><br><span class="line">    L := 0</span><br><span class="line">    R := n âˆ’ 1</span><br><span class="line">    while L != R do</span><br><span class="line">        m := floor((L + R) / 2)</span><br><span class="line">        if A[m] &lt; T then</span><br><span class="line">            L := m + 1</span><br><span class="line">        else:</span><br><span class="line">            R := m</span><br><span class="line">    if A[L] = T then</span><br><span class="line">        return L</span><br><span class="line">    return unsuccessful</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;ä»¥ä¸Šä¸¤ç§ç»“æ„å¯ä»¥åœ¨æ¯æ¬¡å¾ªç¯ä¸­å‡å°‘ä¸€æ¬¡çš„æ¯”è¾ƒã€‚</p><p>&emsp;&emsp;å¹¶ä¸”å€¼çš„æ³¨æ„çš„æ˜¯ä»¥ä¸‹ä¸¤ç§ç»“æ„æ˜¯é”™è¯¯çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ğŸ‘¿function binary_search_alternative(A, n, T) is</span><br><span class="line">    L := 0</span><br><span class="line">    R := n âˆ’ 1</span><br><span class="line">    while L != R do</span><br><span class="line">        m := ceil((L + R) / 2)</span><br><span class="line">        if A[m] &lt; T then</span><br><span class="line">            L := m + 1</span><br><span class="line">        else:</span><br><span class="line">            R := m</span><br><span class="line">    if A[L] = T then</span><br><span class="line">        return L</span><br><span class="line">    return unsuccessful</span><br></pre></td></tr></table></figure><p>å‡è®¾åœ¨[2 3 4]ä¸­æŸ¥æ‰¾2ï¼Œ <br><br>ç¬¬ä¸€è¶Ÿï¼š L = 0 R = 5 m = 1 A[m] &gt; T <br><br>ç¬¬äºŒè¶Ÿ:  L = 0 R = 1 m = 1 A[m] &gt; T <br><br>ç¬¬ä¸‰è¶Ÿï¼šL = 0 R = 1 m = 1 A[m] &gt; T <br><br>â€¦ <br><br>ç¬¬Nè¶Ÿï¼šL = 0 R = 1 m = 1 A[m] &gt; T <br><br>è¿™é‡Œä¼šå¯¼è‡´æ— çº¿å¾ªç¯ï¼Œå› ä¸ºceilingå–ä¸Šé™ï¼Œå¹¶ä¸”æˆ‘ä»¬å°†må–åœ¨å³è¾¹ï¼Œå¯¼è‡´åŒºé—´åœ¨å·¦è¾¹æ²¡æ³•æ”¶æ•›ã€‚</p><p>åŒç†ï¼Œä¸‹é¢ç»“æ„ä¹Ÿæ˜¯é”™è¯¯çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ğŸ‘¿function binary_search_alternative(A, n, T) is</span><br><span class="line">    L := 0</span><br><span class="line">    R := n âˆ’ 1</span><br><span class="line">    while L != R do</span><br><span class="line">        m := floor((L + R) / 2)</span><br><span class="line">        if A[m] &gt; T then</span><br><span class="line">            R := m - 1</span><br><span class="line">        else:</span><br><span class="line">            L := m</span><br><span class="line">    if A[L] = T then</span><br><span class="line">        return L</span><br><span class="line">    return unsuccessful</span><br></pre></td></tr></table></figure><p>å¯ä»¥[2 3 4]ä¸­æŸ¥æ‰¾4æ¥è¯•è¯•ã€‚</p><h4 id="ğŸ™ˆç»“æ„3è¾¨æ"><a href="#ğŸ™ˆç»“æ„3è¾¨æ" class="headerlink" title="ğŸ™ˆç»“æ„3è¾¨æ"></a>ğŸ™ˆç»“æ„3è¾¨æ</h4><p>&emsp;&emsp;åœ¨å­˜åœ¨é‡å¤å…ƒç´ çš„æ—¶å€™ï¼Œç©¶ç«Ÿè¯¥è¿”å›å“ªä¸€ä¸ªå‘¢ï¼Ÿæ¯”å¦‚[1,2,4,4,4,5,6,7]æŸ¥æ‰¾4ï¼Œæ˜¯è¿”å›2è¿˜æ˜¯3ï¼Œæˆ–è€…4ï¼Ÿ</p><p>&emsp;&emsp;ä¸‹é¢è¿™æ ·ä¸€ä¸ªç»“æ„å¯ä»¥è¿”å›æœ€å·¦è¾¹çš„å…ƒç´ ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function binary_search_leftmost(A, n, T):</span><br><span class="line">    L := 0</span><br><span class="line">    R := n</span><br><span class="line">    while L &lt; R:</span><br><span class="line">        m := floor((L + R) / 2)</span><br><span class="line">        if A[m] &lt; T:</span><br><span class="line">            L := m + 1</span><br><span class="line">        else:</span><br><span class="line">            R := m</span><br><span class="line">    return L</span><br></pre></td></tr></table></figure><p>åœ¨æ‰¾åˆ°å…ƒç´ åï¼Œä¾æ—§ä¼šé€šè¿‡R = må‘å·¦è¾¹æ”¶ç¼©ã€‚</p><p>&emsp;&emsp;ä¸‹é¢è¿™æ ·ä¸€ä¸ªç»“æ„å¯ä»¥è¿”å›æœ€å³è¾¹çš„å…ƒç´ ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function binary_search_rightmost(A, n, T):</span><br><span class="line">    L := 0</span><br><span class="line">    R := n</span><br><span class="line">    while L &lt; R:</span><br><span class="line">        m := floor((L + R) / 2)</span><br><span class="line">        if A[m] &lt;= T:</span><br><span class="line">            L := m + 1</span><br><span class="line">        else:</span><br><span class="line">            R := m</span><br><span class="line">    return R - 1</span><br></pre></td></tr></table></figure><p>åœ¨æ‰¾åˆ°å…ƒç´ åï¼Œä¾æ—§ä¼šé€šè¿‡left = m + 1å‘å³è¾¹æ”¶ç¼©ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚æœè§£å†³â€œcorrupted size vs. prev_sizeâ€é—®é¢˜ï¼Ÿ</title>
      <link href="/2020/02/13/problems5/"/>
      <url>/2020/02/13/problems5/</url>
      
        <content type="html"><![CDATA[<p>ğŸ“£</p><p>åœ¨C++ä¸­æˆ‘ä»¬æ—¶å¸¸ä¼šé‡è§â€œcorrupted size vs. prev_sizeâ€çš„æŠ¥é”™ï¼Œå®ƒçš„åŸå› åœ¨äº<strong>å†…å­˜è¶Šç•Œ</strong>ï¼Œå…¶å®è§£å†³è¿™ä¸ªé—®é¢˜çš„åŠæ³•åœ¨äºä½¿ç”¨<strong>vector</strong>æ¥ä»£æ›¿è‡ªå·±ç”³è¯·å†…å­˜ï¼Œå¹¶ä¸”ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹æ³•æ¥è®¿é—®å…ƒç´ ï¼š</p><ul><li>ä½¿ç”¨è¿­ä»£å™¨</li><li>ä½¿ç”¨at</li></ul><p>å°½é‡è¦é¿å…ä½¿ç”¨[]æ¥è®¿é—®vectorï¼Œè¶Šç•Œçš„æ—¶å€™å¾ˆéš¾æ‰¾åˆ°é”™è¯¯çš„åœ°æ–¹ï¼Œä½¿ç”¨atå¸¦æœ‰è¶Šç•Œçš„æ£€æŸ¥ï¼Œæ›´ä¸ºå®‰å…¨ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> é‡è§çš„é—®é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•å¼€å¯ubuntusçš„core_dumpï¼Ÿ</title>
      <link href="/2020/02/03/problems6/"/>
      <url>/2020/02/03/problems6/</url>
      
        <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br></pre></td></tr></table></figure><p> ç„¶åï¼Œåœ¨å…¶ä¸­ä¸­æ·»åŠ ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ulimit</span> -c unlimited</span><br></pre></td></tr></table></figure><p>ç„¶åé‡å¯æœºå™¨æˆ–è€…ä½¿ç”¨sourceå‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> é‡è§çš„é—®é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬äº”ç«  Internetåè®®</title>
      <link href="/2020/01/23/TIV5/"/>
      <url>/2020/01/23/TIV5/</url>
      
        <content type="html"><![CDATA[<p><strong>IPv4å¤´éƒ¨é•¿åº¦</strong>åŒ…å«20ä¸ªå­—èŠ‚ï¼ˆæ²¡æœ‰é€‰é¡¹ï¼‰ï¼Œ<strong>IPv6å¤´éƒ¨é•¿åº¦</strong>å›ºå®šï¼ˆ40å­—èŠ‚ï¼‰ã€‚<br><br><strong>ç½‘ç»œå­—èŠ‚åº</strong>ï¼šé«˜ä½ä¼˜å…ˆå­—èŠ‚åºã€‚<br><br>Internetå¤´éƒ¨è¢«é™åˆ¶ä¸º60ä¸ªå­—èŠ‚ï¼Œå› ä¸º<strong>IHLå­—æ®µé•¿åº¦</strong>ä¸º4ä½ï¼Œä¿å­˜IPv4å¤´éƒ¨ä¸­32ä½å­—çš„æ•°é‡ã€‚<br><br>ä¸»æœºä¸éœ€è¦æ¥æ”¶å¤§äº576å­—èŠ‚çš„IPv4æ•°æ®æŠ¥ã€‚<br><br><strong>å¤´éƒ¨æ ¡éªŒå’Œ</strong>å­—æ®µä»…è®¡ç®—IPv4å¤´éƒ¨ã€‚ <br></p>]]></content>
      
      
      
        <tags>
            
            <tag> ã€ŠTCP/IPè¯¦è§£ã€‹è¯»ä¹¦ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬ä¸‰ç«  é“¾è·¯å±‚</title>
      <link href="/2020/01/23/TIV3/"/>
      <url>/2020/01/23/TIV3/</url>
      
        <content type="html"><![CDATA[<h4 id="ğŸ˜å…³é”®è¯æ±‡"><a href="#ğŸ˜å…³é”®è¯æ±‡" class="headerlink" title="ğŸ˜å…³é”®è¯æ±‡"></a>ğŸ˜å…³é”®è¯æ±‡</h4><p><strong>æœ€å¤§ä¼ è¾“å•å…ƒ</strong>ï¼š MTU<br><br><strong>ä»¥å¤ªç½‘</strong>ï¼šé€šå¸¸æŒ‡ä¸€å¥—æ ‡å‡†ã€‚10Mbit/sä»¥å¤ªç½‘ï¼Œåˆç§°802.3æ ‡å‡†ã€‚<br></p><h4 id="ğŸ³å…³é”®æ¦‚å¿µ"><a href="#ğŸ³å…³é”®æ¦‚å¿µ" class="headerlink" title="ğŸ³å…³é”®æ¦‚å¿µ"></a>ğŸ³å…³é”®æ¦‚å¿µ</h4><p>&emsp;äº¤æ¢æœºä»¥åŒå·¥æ–¹å¼è¿è¡Œï¼Œå¹¶ä¸”ä¸éœ€è¦ä½¿ç”¨CSMA/CDç®—æ³•.<br><br>&emsp;ä¼ ç»Ÿä»¥å¤ªç½‘æœ€å°çš„å¸§æ˜¯64å­—èŠ‚ï¼Œè¦æ±‚æ•°æ®åŒºé•¿åº¦æœ€å°ä¸º48å­—èŠ‚ï¼Œæœ€å¤§å¸§é•¿åº¦ä¸º1518å­—èŠ‚ï¼ŒMTUå¤§å°é™åˆ¶ä¸º1500å­—èŠ‚ã€‚<br></p>]]></content>
      
      
      
        <tags>
            
            <tag> ã€ŠTCP/IPè¯¦è§£ã€‹è¯»ä¹¦ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬äºŒç«  Internetåœ°å€ç»“æ„</title>
      <link href="/2020/01/23/TIV2/"/>
      <url>/2020/01/23/TIV2/</url>
      
        <content type="html"><![CDATA[<h4 id="ğŸ˜å…³é”®è¯æ±‡"><a href="#ğŸ˜å…³é”®è¯æ±‡" class="headerlink" title="ğŸ˜å…³é”®è¯æ±‡"></a>ğŸ˜å…³é”®è¯æ±‡</h4><p><strong>å­ç½‘å¯»å€</strong>ï¼šä¸€ä¸ªç«™ç‚¹è¢«åˆ†é…ä¸€ä¸ªAç±»ã€Bç±»å’ŒCç±»çš„ç½‘ç»œå·ï¼Œä¿ç•™ä¸€äº›å‰©ä½™ä¸»æœºå·è¿›ä¸€æ­¥ç”¨ç«™ç‚¹åˆ†é…ã€‚è¯¥ç«™ç‚¹å¯èƒ½å°†åŸºç¡€åœ°å€ä¸­çš„ä¸»æœºéƒ¨åˆ†è¿›ä¸€æ­¥åˆ’åˆ†ä¸ºä¸€ä¸ªå­ç½‘å·å’Œä¸€ä¸ªä¸»æœºå·ã€‚<br><br><strong>Aç±»ç½‘ç»œåœ°å€</strong>ï¼šç½‘ç»œå·8ä½ï¼Œ0 + 7ä½è‡ªç”±;ä¸»æœºå·24ä½ <br><br><strong>Bç±»ç½‘ç»œåœ°å€</strong>ï¼šç½‘ç»œå·16ä½ï¼Œ10 + 14ä½è‡ªç”±ï¼›ä¸»æœº16ä½ <br><br><strong>Cç±»ç½‘ç»œåœ°å€</strong>ï¼šç½‘ç»œå·24ä½ï¼Œ110 + 21ä½è‡ªç”± ï¼›ä¸»æœº8ä½<br><br><strong>Dç±»ç½‘ç»œåœ°å€</strong>ï¼šç½‘ç»œå·32ä½ï¼Œ1110 + 28ä½è‡ªç”± <br><br><strong>Eç±»ç½‘ç»œåœ°å€</strong>ï¼šç½‘ç»œå·32ä½ï¼Œ1111 + 28ä½è‡ªç”± <br><br><strong>å­ç½‘æ©ç </strong>ï¼šç”±ä¸»æœºæˆ–è·¯ç”±å™¨ä½¿ç”¨çš„åˆ†é…ä½ï¼Œä»¥ç¡®å®šå¦‚ä½•ä»ä¸€å°ä¸»æœºå¯¹åº”IPåœ°å€ä¸­è·å¾—ç½‘ç»œå’Œå­ç½‘ä¿¡æ¯ã€‚å­ç½‘æ©ç çº¯ç²¹æ˜¯ç«™ç‚¹å†…éƒ¨çš„å±€éƒ¨é—®é¢˜ã€‚<br><br><strong>å®šå‘å¹¿æ’­</strong>ï¼š ä½¿ç”¨<strong>å­ç½‘å¹¿æ’­åœ°å€</strong>ä½œä¸ºç›®çš„åœ°çš„æ•°æ®æŠ¥ã€‚<br><br><strong>æœ‰é™å¹¿æ’­</strong>ï¼š255.255.255.255è¢«ä¿ç•™ä¸º<strong>æœ¬åœ°ç½‘ç»œå¹¿æ’­</strong>ï¼Œå®ƒæ ¹æœ¬ä¸ä¼šè¢«è·¯ç”±å™¨è½¬å‘ã€‚<br><br><strong>ä»»æ„æºç»„æ’­</strong>ï¼šASM,ä»»ä½•å‘é€æ–¹å¯ä»¥å‘é€ç»™ä»»ä½•ç»„ã€‚<br><br><strong>ç‰¹ç‚¹ç»„æ’­</strong>ï¼šSSMï¼Œåœ¨æ¯ä¸ªç»„ä¸­åªä½¿ç”¨ä¸€ä¸ªå‘é€æ–¹ã€‚<br></p><h4 id="ğŸ³å…³é”®æ¦‚å¿µ"><a href="#ğŸ³å…³é”®æ¦‚å¿µ" class="headerlink" title="ğŸ³å…³é”®æ¦‚å¿µ"></a>ğŸ³å…³é”®æ¦‚å¿µ</h4><p>&emsp;IPv6åœ°å€é•¿åº¦128ä½ï¼ˆ16* 8ï¼‰ï¼ŒIPv4åœ°å€é•¿åº¦32ä½ï¼ˆ8* 4ï¼‰ <br><br>&emsp;IPv6å—çš„å‰å¯¼çš„é›¶ä¸å¿…ä¹¦å†™ã€‚å…¨é›¶çš„å—å¯ä»¥çœç•¥ï¼Œå¹¶ç”¨ç¬¦å·::ä»£æ›¿ï¼Œä¸ºäº†é¿å…æ­§ä¹‰ï¼Œä¸€ä¸ªIPv6åœ°å€ä¸­çš„ç¬¦å·::åªèƒ½ä½¿ç”¨ä¸€æ¬¡ã€‚åœ¨IPv6æ ¼å¼ä¸­åµŒå…¥IPv4åœ°å€å¯ä»¥ä½¿ç”¨æ··åˆç¬¦å·å½¢å¼ï¼Œç´§æ¥ç€IPv4éƒ¨åˆ†çš„åœ°å€å—çš„å€¼ä¸ºffffï¼Œåœ°å€çš„å…¶ä»–éƒ¨åˆ†ä½¿ç”¨ç‚¹åˆ†å››ç»„æ ¼å¼ï¼ˆ::ffff:10.0.0.1ï¼‰ <br><br>&emsp;åªæœ‰åˆ’åˆ†å­ç½‘çš„ç½‘ç»œä¸­çš„ä¸»æœºå’Œè·¯ç”±å™¨çŸ¥é“å­ç½‘ç»“æ„ï¼ŒInternetå…¶ä»–éƒ¨åˆ†ä»ç„¶å°†å®ƒä½œä¸ºç«™ç‚¹ç›¸å…³çš„åœ°å€æ¥çœ‹å¾….<br><br>&emsp;128.32.1.255/24è¿™ä¸ªåœ°å€ç§°ä¸º<strong>å­ç½‘å¹¿æ’­åœ°å€</strong>ã€‚<br><br>&emsp;CIDRç¼“è§£IPv4åœ°å€çš„å‹åŠ›ï¼Œå¤„ç†å¤§äº255å°äº65536çš„ä¸»æœºæ•°ã€‚<br></p>]]></content>
      
      
      
        <tags>
            
            <tag> ã€ŠTCP/IPè¯¦è§£ã€‹è¯»ä¹¦ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬ä¸€ç«  æ¦‚è¿°</title>
      <link href="/2020/01/22/TIV1/"/>
      <url>/2020/01/22/TIV1/</url>
      
        <content type="html"><![CDATA[<h4 id="ğŸ˜å…³é”®è¯æ±‡"><a href="#ğŸ˜å…³é”®è¯æ±‡" class="headerlink" title="ğŸ˜å…³é”®è¯æ±‡"></a>ğŸ˜å…³é”®è¯æ±‡</h4><p><strong>åè®®æ—</strong>ï¼š ä¸€ç³»åˆ—ç›¸å…³åè®®çš„é›†åˆã€‚ <br><br><strong>ç½‘å…³</strong>ï¼šåˆç§°è·¯ç”±å™¨ã€‚ <br><br><strong>è™šç”µè·¯</strong>ï¼šè¡¨ç°å‡ºå¾ˆå¤šç”µè·¯è¡Œä¸ºï¼Œä½†æ˜¯ä¸ä¾èµ–äºç‰©ç†çš„äº¤æ¢æœºï¼Œè€Œé€šè¿‡é¡¶å±‚çš„<strong>é¢å‘è¿æ¥çš„åˆ†ç»„</strong>æ¥å®ç° <br><br><strong>æ•°æ®æŠ¥</strong>ï¼šä¸€ä¸ªç‰¹å®šç±»å‹çš„<strong>åˆ†ç»„</strong>ï¼ŒåŒ…å«æ‰€æœ‰æ¥æºåœ°å’Œç›®çš„åœ°çš„æ‰€æœ‰è¯†åˆ«ä¿¡æ¯ã€‚ <br><br><strong>æ¶ˆæ¯è¾¹ç•Œ</strong>ï¼šå‡è®¾å‘é€3ä¸ªæ•°æ®æŠ¥ï¼Œæ¥æ”¶æ—¶å¿…é¡»æ˜¯3ä¸ªæ•°æ®æŠ¥ï¼Œé‚£ä¹ˆè¿™å°±æ˜¯æœ‰æ¶ˆæ¯è¾¹ç•Œçš„ï¼›å¦‚æœå¯ä»¥è‡ªå·±é€‰æ‹©æ¥æ”¶æ¬¡æ•°ï¼Œä¸€æ¬¡æ¥æ”¶3ä¸ªæ•°æ®æŠ¥ï¼Œæˆ–è€…2æ¬¡ï¼Œè¿™å°±æ˜¯æ²¡æœ‰æ¶ˆæ¯è¾¹ç•Œã€‚<br><br><strong>ä¼šè¯å±‚</strong>ï¼šè¡¨ç¤ºè¿è¡Œä¸­çš„åº”ç”¨ä¹‹é—´çš„äº¤äº’ï¼Œä¼šè¯å±‚åè®®å¯æä¾›ä¾‹å¦‚è¿æ¥åˆå§‹åŒ–å’Œé‡æ–°å¯åŠ¨ã€å¢åŠ æ£€æŸ¥ç‚¹ç­‰åŠŸèƒ½ã€‚<br><br><strong>è¡¨ç¤ºå±‚</strong>ï¼šè´Ÿè´£ä¿¡æ¯æ ¼å¼è½¬æ¢å’Œæ ‡å‡†åŒ–ç¼–ç ã€‚<br><br><strong>PDU</strong>ï¼šåè®®æ•°æ®å•å…ƒ <br><br><strong>è½¬å‘</strong>ï¼šæ¯ä¸ªæ•°æ®æŠ¥çš„ç›®çš„åœ°å€ç”¨äºå†³å®šå°†è¯¥æ•°æ®æŠ¥å‘é€åˆ°å“ªé‡Œï¼Œè€Œåšå‡ºæ­¤å†³å®šå’Œå‘é€æ•°æ®æŠ¥åˆ°ä¸‹ä¸€è·³çš„è¿‡ç¨‹ã€‚<br><br><strong>å•æ’­</strong>ï¼šç›®çš„åœ°æ˜¯ä¸€å°ä¸»æœºã€‚<br><br><strong>å¹¿æ’­</strong>ï¼šç›®çš„åœ°æ˜¯ä¸€ä¸ªæŒ‡å®šç½‘ç»œä¸­çš„æ‰€æœ‰ä¸»æœºã€‚ <br><br><strong>ç»„æ’­</strong>ï¼šç›®çš„åœ°æ˜¯å±äºä¸€ä¸ªç»„æ’­ç»„çš„ä¸€ç»„ä¸»æœºã€‚ <br><br><strong>ICMP</strong>: Internetæ§åˆ¶æ¶ˆæ¯åè®®æ˜¯<strong>IPçš„ä¸€ä¸ªè¾…åŠ©åè®®</strong>ã€‚IPå±‚ä½¿ç”¨å®ƒä¸å…¶ä»–ä¸»æœºæˆ–è·¯ç”±å™¨çš„IPå±‚ä¹‹é—´äº¤æ¢å·®é”™æ¶ˆæ¯å’Œå…¶ä»–é‡è¦æ¶ˆæ¯ã€‚ åº”ç”¨ï¼špingã€tracerouteã€‚<br><br><strong>IGMP</strong>ï¼šInternetç»„ç®¡ç†åè®®æ˜¯<strong>IPv4çš„å¦ä¸€ä¸ªè¾…åŠ©åè®®</strong>ã€‚å®ƒé‡‡ç”¨ç»„æ’­å¯»å€å’Œäº¤ä»˜æ¥ç®¡ç†ä½œä¸ºç»„æ’­æˆå‘˜çš„ä¸»æœºã€‚<br><br><strong>SCTP</strong>: æµæ§åˆ¶ä¼ è¾“åè®®. <br><br><strong>ç«¯å£å·</strong>ï¼š16ä½éè´Ÿæ•´æ•°ï¼ˆ0~65535ï¼‰ï¼Œç†ŸçŸ¥ç«¯å£å·ï¼ˆ0 ~ 1023ï¼‰ï¼Œæ³¨å†Œç«¯å£å·ï¼ˆ1024 ~ 49151ï¼‰ï¼ŒåŠ¨æ€/ç§æœ‰ç«¯å£å·ï¼ˆ49152 ~ 65535ï¼‰<br><br><strong>internet</strong>ï¼šå¸¸è§åè®®æ—äº’è”çš„å¤šä¸ªç½‘ç»œã€‚<br><br><strong>Internet</strong>: TCP/IPé€šä¿¡çš„ä¸–ç•ŒèŒƒå›´çš„ä¸»æœºé›†åˆã€‚<br></p><h4 id="ğŸ³å…³é”®æ¦‚å¿µ"><a href="#ğŸ³å…³é”®æ¦‚å¿µ" class="headerlink" title="ğŸ³å…³é”®æ¦‚å¿µ"></a>ğŸ³å…³é”®æ¦‚å¿µ</h4><p>&emsp;TCP/IPæ˜¯ä¸€ä¸ªå®ç°Internetä½“ç³»ç»“æ„çš„<strong>åè®®æ—</strong>ã€‚ <br><br>&emsp;åœ¨<strong>å°½åŠ›è€Œä¸º</strong>çš„äº¤ä»˜ä¸­ï¼Œç½‘ç»œä¸ä¼šèŠ±è´¹å¾ˆå¤§åŠªåŠ›æ¥ç¡®ä¿æ•°æ®åœ¨æ²¡æœ‰å·®é”™æˆ–ç¼ºé™·çš„æƒ…å†µä¸‹äº¤ä»˜ã€‚<br><br>&emsp;åœ¨å°½åŠ›è€Œä¸ºçš„IPç½‘ç»œä¸­ï¼Œé™ä½å‘é€æ–¹çš„å‘é€é€Ÿåº¦å¯é€šè¿‡<strong>æµé‡æ§åˆ¶</strong>æœºåˆ¶å®ç°ã€‚<br><br>&emsp;é€šå¸¸è®¤ä¸ºTCP/IPä½“ç³»ç»“æ„åŒ…å«5å±‚ã€‚<br><br>&emsp;ç«¯ä¸»æœºå®ç°æ‰€æœ‰å±‚ï¼Œäº¤æ¢æœºå®ç°åˆ°ç¬¬äºŒå±‚ï¼Œè·¯ç”±å™¨å®ç°åˆ°ç¬¬ä¸‰å±‚ã€‚ <br><br>&emsp;<strong>é€šå¸¸ä¸è®¤ä¸ºäº¤æ¢æœºæˆ–æ¡¥æ¥æ˜¯ä¸€ä¸ªä¸­é—´ç³»ç»Ÿ</strong>ï¼Œè¿™æ—¶ç”±äºå®ƒä»¬æ²¡æœ‰ä½¿ç”¨äº’è”ç½‘ç»œåè®®çš„åœ°å€æ ¼å¼æ¥ç¼–å€ï¼Œå¹¶åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šä»¥é€æ˜äºç½‘ç»œå±‚åè®®çš„æ–¹å¼è¿è¡Œã€‚<br><br>&emsp;æœ‰å¤šä¸ªæ¥å£çš„ç³»ç»Ÿç§°ä¸º<strong>å¤šå®¿ä¸»</strong>. <br><br>&emsp;IPå‘é€ç»™<strong>é“¾è·¯å±‚åè®®</strong>çš„PDUç§°ä¸º<strong>IPæ•°æ®æŠ¥</strong>ï¼Œå®ƒçš„å¤§å°æ˜¯64KBï¼ˆIPv6æ˜¯4GBï¼‰,æˆ‘ä»¬ç®€åŒ–ç§°ä¸º<strong>åˆ†ç»„</strong><br><br>&emsp;å¤§çš„åˆ†ç»„æ”¾å…¥é“¾è·¯å±‚PDUï¼ˆç§°ä¸º<strong>å¸§</strong>ï¼‰æ—¶éœ€è¦è¿›è¡Œç¼©å°å¤„ç†ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º<strong>åˆ†ç‰‡</strong>ã€‚ <br><br>&emsp;TCPå‘é€åˆ°IPçš„PDUç§°ä¸º<strong>TCPæ®µ</strong>ã€‚ <br><br>&emsp;ç”¨æˆ·å¯ä»¥é€šè¿‡<strong>è™šæ‹Ÿä¸“ç”¨ç½‘VPN</strong>è¿æ¥åˆ°å†…è”ç½‘ã€‚<br><br>&emsp;</p>]]></content>
      
      
      
        <tags>
            
            <tag> ã€ŠTCP/IPè¯¦è§£ã€‹è¯»ä¹¦ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•£åˆ—è¡¨</title>
      <link href="/2020/01/22/alg6/"/>
      <url>/2020/01/22/alg6/</url>
      
        <content type="html"><![CDATA[<h4 id="ğŸ¥£æ‹‰é“¾æ³•çš„æ•£åˆ—è¡¨"><a href="#ğŸ¥£æ‹‰é“¾æ³•çš„æ•£åˆ—è¡¨" class="headerlink" title="ğŸ¥£æ‹‰é“¾æ³•çš„æ•£åˆ—è¡¨"></a>ğŸ¥£æ‹‰é“¾æ³•çš„æ•£åˆ—è¡¨</h4><p>&emsp;&emsp;åŸºäº<strong>é“¾è¡¨å®ç°çš„å­—å…¸</strong>å®ç°è€Œæ¥ <br><br>æ•£åˆ—è¡¨çš„é‡ç‚¹åœ¨äºè§£å†³å†²çªï¼Œæ‹‰é“¾æ³•è§£å†³å†²çªçš„æ–¹æ³•æ˜¯é€šè¿‡æ•°ç»„ï¼‹é“¾è¡¨çš„å½¢å¼æ¥å®ç°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">#pragma once</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &quot;Common.hpp&quot;</span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line">#include &lt;algorithm&gt;</span><br><span class="line">#include &lt;memory&gt;</span><br><span class="line">#include &quot;BinarySearchST.hpp&quot;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * æ‹‰é“¾æ³•æ•£åˆ—è¡¨</span><br><span class="line"> * å› ä¸ºæ²¡æœ‰Javaçš„hasCodeæ–¹æ³•ï¼Œ</span><br><span class="line"> * æ‰€ä»¥è¿™é‡Œçš„ä»£ç ç›´æ¥ä½¿ç”¨intç±»å‹</span><br><span class="line"> **/ </span><br><span class="line"></span><br><span class="line">template&lt;typename Value&gt;</span><br><span class="line">class SeparateChainingHashST</span><br><span class="line">&#123;</span><br><span class="line">  public:</span><br><span class="line">    SeparateChainingHashST(int M);</span><br><span class="line">    ~SeparateChainingHashST();</span><br><span class="line">    Value get(int key);</span><br><span class="line">    void put(int key, Value val);</span><br><span class="line">    int size() const &#123;return this-&gt;N;&#125;</span><br><span class="line">  private:</span><br><span class="line">    int N; //é”®å€¼å¯¹æ€»æ•°</span><br><span class="line">    int M; //æ•£åˆ—è¡¨çš„å¤§å°</span><br><span class="line">    BinarySearchST&lt;int, Value&gt; *st;</span><br><span class="line"></span><br><span class="line">    int hash(int key) const;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">template&lt;typename Value&gt;</span><br><span class="line">SeparateChainingHashST&lt;Value&gt;::SeparateChainingHashST(int M)</span><br><span class="line">  : N(0), M(M)</span><br><span class="line">&#123;</span><br><span class="line">  st = new BinarySearchST&lt;int, Value&gt;[M]();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Value&gt;</span><br><span class="line">SeparateChainingHashST&lt;Value&gt;::~SeparateChainingHashST()</span><br><span class="line">&#123;</span><br><span class="line">  delete [] st;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Value&gt;</span><br><span class="line">int SeparateChainingHashST&lt;Value&gt;::hash(int key) const</span><br><span class="line">&#123;</span><br><span class="line">  return (key &amp; 0x7fffffff) % M;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Value&gt;</span><br><span class="line">Value SeparateChainingHashST&lt;Value&gt;::get(int key)</span><br><span class="line">&#123;</span><br><span class="line">  return st[hash(key)].get(key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Value&gt;</span><br><span class="line">void SeparateChainingHashST&lt;Value&gt;::put(int key, Value val)</span><br><span class="line">&#123;</span><br><span class="line">  st[hash(key)].put(key, val);</span><br><span class="line">  N++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ğŸ˜¤çº¿æ€§æ¢æµ‹æ³•çš„æ•£åˆ—è¡¨"><a href="#ğŸ˜¤çº¿æ€§æ¢æµ‹æ³•çš„æ•£åˆ—è¡¨" class="headerlink" title="ğŸ˜¤çº¿æ€§æ¢æµ‹æ³•çš„æ•£åˆ—è¡¨"></a>ğŸ˜¤çº¿æ€§æ¢æµ‹æ³•çš„æ•£åˆ—è¡¨</h4><p>&emsp;&emsp;çº¿æ€§æ¢æµ‹æ³•çš„é‡ç‚¹åœ¨äºhashå€¼ç›¸åŒæ—¶ï¼Œå°†é”®å€¼å¾€åç§»ï¼Œè¿™æ ·å°±å…±ç”¨ä¸€ä¸ªæ•°ç»„ï¼Œå¯¹äºæ‹‰é“¾æ³•çš„æ•£åˆ—è¡¨ï¼Œè¿™ç§æ–¹æ³•æ˜¯<strong>ç”¨æ—¶é—´å¤æ‚åº¦æ¥æ¢å–ç©ºé—´å¤æ‚åº¦</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line">#pragma once</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &quot;Common.hpp&quot;</span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line">#include &lt;algorithm&gt;</span><br><span class="line">#include &lt;memory&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * çº¿æ€§æ¢æµ‹æ³•çš„æ•£åˆ—è¡¨</span><br><span class="line"> **/ </span><br><span class="line"></span><br><span class="line">template&lt;typename Value&gt;</span><br><span class="line">class LinearProbingHashST&#123;</span><br><span class="line">  public:</span><br><span class="line">    LinearProbingHashST(int M);</span><br><span class="line">    int size() const &#123;return N;&#125;</span><br><span class="line">    void put(int key, Value val);</span><br><span class="line">    Value get(int key);</span><br><span class="line">    void delet(int key);</span><br><span class="line">    bool contain(int key) const;</span><br><span class="line">  private:</span><br><span class="line">    int M; //é•¿åº¦</span><br><span class="line">    int N; //é”®å€¼å¯¹æ•°é‡</span><br><span class="line">    int* keys;</span><br><span class="line">    Value* vals;</span><br><span class="line"></span><br><span class="line">    void resize(int sz);</span><br><span class="line">    int hash(int key) const;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">template&lt;typename Value&gt;</span><br><span class="line">int LinearProbingHashST&lt;Value&gt;::hash(int key) const</span><br><span class="line">&#123;</span><br><span class="line">  return (key &amp; 0x7fffffff) % M;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Value&gt;</span><br><span class="line">LinearProbingHashST&lt;Value&gt;::LinearProbingHashST(int M)</span><br><span class="line"> :M(M), N(0)</span><br><span class="line">&#123;</span><br><span class="line">  keys = new int [M]();</span><br><span class="line">  vals = new Value [M]();</span><br><span class="line">  for(int i  = 0; i &lt; M; ++i)</span><br><span class="line">    keys[i] = -1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Value&gt;</span><br><span class="line">void </span><br><span class="line">LinearProbingHashST&lt;Value&gt;::put(int key, Value val)</span><br><span class="line">&#123;</span><br><span class="line">  if(N &gt; M / 2) &#123;</span><br><span class="line">    resize(2 * M);</span><br><span class="line">  &#125;</span><br><span class="line">  int i;</span><br><span class="line">  for(i = hash(key); keys[i] != -1; i = (i + 1) % M) &#123;</span><br><span class="line">    if(keys[i] == key) </span><br><span class="line">    &#123;</span><br><span class="line">      vals[i] = val;</span><br><span class="line">      return ;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  keys[i] = key;</span><br><span class="line">  vals[i] = val;</span><br><span class="line">  N++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Value&gt;</span><br><span class="line">void </span><br><span class="line">LinearProbingHashST&lt;Value&gt;::resize(int sz)</span><br><span class="line">&#123;</span><br><span class="line">  int * keys1 = keys;</span><br><span class="line">  Value* vals1 = vals;</span><br><span class="line">  int M1 = M;</span><br><span class="line">  keys = new int [sz]();</span><br><span class="line">  vals = new Value [sz] ();</span><br><span class="line">  for(int i = 0; i &lt; sz; ++i) &#123;</span><br><span class="line">    keys[i] = -1;</span><br><span class="line">  &#125;</span><br><span class="line">  N = 0;</span><br><span class="line">  M = sz;</span><br><span class="line">  for(int i = 0; i &lt; M1; ++i) &#123;</span><br><span class="line">    if(keys1[i] != -1) &#123;</span><br><span class="line">      put(keys1[i], vals1[i]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  delete [] keys1;</span><br><span class="line">  delete [] vals1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Value&gt;</span><br><span class="line">Value </span><br><span class="line">LinearProbingHashST&lt;Value&gt;::get(int key)</span><br><span class="line">&#123;</span><br><span class="line">  int i = hash(key);</span><br><span class="line">  for(; keys[i] != -1; i = (i + 1) % M) &#123;</span><br><span class="line">    if(keys[i] == key) &#123;</span><br><span class="line">      return vals[i];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return Value();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Value&gt;</span><br><span class="line">void </span><br><span class="line">LinearProbingHashST&lt;Value&gt;::delet(int key)</span><br><span class="line">&#123;</span><br><span class="line">  if(!contain(key))</span><br><span class="line">    return ;</span><br><span class="line">  int i = hash(key);</span><br><span class="line">  for(; keys[i] != -1; i = (i + 1) % M)</span><br><span class="line">    if(keys[i] == key)</span><br><span class="line">      break;</span><br><span class="line">  keys[i] = -1;</span><br><span class="line">  vals[i] = Value();</span><br><span class="line">  i = (i + 1) % M;</span><br><span class="line">  int k;</span><br><span class="line">  Value v;</span><br><span class="line">  while(keys[i] != -1) &#123;</span><br><span class="line">    k = keys[i];</span><br><span class="line">    v = vals[i];</span><br><span class="line">    N--;</span><br><span class="line">    keys[i] = -1;</span><br><span class="line">    vals[i] = Value();</span><br><span class="line">    put(k, v);</span><br><span class="line">    i = (i + 1) % M; </span><br><span class="line">  &#125;</span><br><span class="line">  N--;</span><br><span class="line">  if(N &gt; 0 &amp;&amp; N == M/8)</span><br><span class="line">    resize(M / 2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Value&gt;</span><br><span class="line">bool </span><br><span class="line">LinearProbingHashST&lt;Value&gt;::contain(int key) const</span><br><span class="line">&#123;</span><br><span class="line">  int i = hash(key);</span><br><span class="line">  for(; keys[i] != -1; i = (i + 1) % M) &#123;</span><br><span class="line">    if(keys[i] == key)</span><br><span class="line">      return true;</span><br><span class="line">  &#125;</span><br><span class="line">  return false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨C++ä¸­æ˜¯å¦æœ‰æ›¿ä»£INT_MINè¿™äº›å®å®šä¹‰çš„åŠŸèƒ½ï¼Ÿ</title>
      <link href="/2020/01/13/problems4/"/>
      <url>/2020/01/13/problems4/</url>
      
        <content type="html"><![CDATA[<p>ğŸ“£åœ¨C++ä¸­æˆ‘ä»¬ä¾ç„¶å¯ä»¥åŒ…å« <cstdint>å¤´æ–‡ä»¶ï¼Œç„¶åå»ä½¿ç”¨INT_MINè¿™äº›å®å®šä¹‰,ä½†æ˜¯å…¶å®åœ¨C++ä¸­æ˜¯å­˜åœ¨æ›´åŠ ä¼˜é›…çš„æ–¹å¼çš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;limits&gt;</span><br><span class="line">std::numeric_limits&lt;int&gt;::min() //INT_MIN</span><br><span class="line">std::numeric_limits&lt;int&gt;::max() //INT_MAX</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> é‡è§çš„é—®é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•åˆ›å»ºæ•°ç»„çš„å…±äº«æŒ‡é’ˆ</title>
      <link href="/2020/01/12/problems3/"/>
      <url>/2020/01/12/problems3/</url>
      
        <content type="html"><![CDATA[<p>C++11åœ¨shared_ptræ˜¯æ²¡æœ‰shared_ptr&lt;int []&gt;è¿™æ ·çš„ä¸œè¥¿çš„ï¼Œ<br>ä½†æ˜¯std::unique_ptr&lt;int[]&gt;æ˜¯æœ‰çš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">std::shared_ptr&lt;int[]&gt; a(new int[10]()); // é”™è¯¯ï¼Œc++17å‰ä¸èƒ½ä¼ é€’æ•°ç»„ç±»å‹ä½œä¸ºshared_ptrçš„æ¨¡æ¿å‚æ•°</span><br><span class="line">std::unique_ptr&lt;int[]&gt; b(new int[10]()); // ok, unique_ptrå¯¹æ­¤åšäº†ç‰¹åŒ–</span><br><span class="line"></span><br><span class="line">std::shared_ptr&lt;int&gt; c(new int[10]()); // é”™è¯¯ï¼Œå¯ä»¥ç¼–è¯‘ï¼Œä½†ä¼šäº§ç”Ÿæœªå®šä¹‰è¡Œä¸ºï¼Œè¯·ä¸è¦è¿™ä¹ˆåš</span><br><span class="line">std::shared_ptr&lt;int&gt; sp3(new int[10](), std::default_delete&lt;int[]&gt;()); //æ­£ç¡®åšæ³•</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> é‡è§çš„é—®é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å­—å…¸</title>
      <link href="/2020/01/12/alg5/"/>
      <url>/2020/01/12/alg5/</url>
      
        <content type="html"><![CDATA[<h4 id="ğŸ¥£é“¾è¡¨å®ç°"><a href="#ğŸ¥£é“¾è¡¨å®ç°" class="headerlink" title="ğŸ¥£é“¾è¡¨å®ç°"></a>ğŸ¥£é“¾è¡¨å®ç°</h4><p>é“¾è¡¨å®ç°æ’å…¥ã€æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯Nï¼Œå¹¶éä¸€ä¸ªé«˜æ•ˆçš„å®ç°æ–¹å¼ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">#pragma once</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &quot;Common.hpp&quot;</span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line">#include &lt;algorithm&gt;</span><br><span class="line">#include &lt;memory&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * é“¾è¡¨å®ç°</span><br><span class="line"> **/</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">class SequentialSearchST &#123;</span><br><span class="line">  public:</span><br><span class="line">    struct Node &#123;</span><br><span class="line">      Node(const S&amp; key, const T&amp; val, shared_ptr&lt;Node&gt; next = nullptr)</span><br><span class="line">      :key(key), val(val), next(next) &#123;&#125;</span><br><span class="line">      </span><br><span class="line">      const S key;</span><br><span class="line">      T val;</span><br><span class="line">      shared_ptr&lt;Node&gt; next;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    void show() const; </span><br><span class="line">    void put(S key, T val);</span><br><span class="line">    const T get(const S&amp; key) const;</span><br><span class="line">    bool contain(const S&amp; key) const;</span><br><span class="line">    const vector&lt;S&gt; keys() const;</span><br><span class="line">  private:</span><br><span class="line">    shared_ptr&lt;Node&gt; head;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">const T SequentialSearchST&lt;S,T&gt;::get(const S&amp; key) const &#123;</span><br><span class="line">  shared_ptr&lt;Node&gt; sk(head);</span><br><span class="line">  while(sk &amp;&amp; sk-&gt;key != key) &#123;</span><br><span class="line">    sk = sk-&gt;next;</span><br><span class="line">  &#125;</span><br><span class="line">  if(!sk) </span><br><span class="line">    return T();</span><br><span class="line">  return sk-&gt;val;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">void SequentialSearchST&lt;S,T&gt;::put(S key, T val) &#123;</span><br><span class="line">  shared_ptr&lt;Node&gt; sk(head);</span><br><span class="line">  while(sk &amp;&amp; sk-&gt;key != key) &#123;</span><br><span class="line">    sk = sk-&gt;next;</span><br><span class="line">  &#125;</span><br><span class="line">  if(sk) </span><br><span class="line">    sk-&gt;val = val;</span><br><span class="line">  else &#123;</span><br><span class="line">    shared_ptr&lt;Node&gt; newOne(make_shared&lt;Node&gt;(key, val, head));</span><br><span class="line">    head = newOne;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">void SequentialSearchST&lt;S,T&gt;::show() const &#123;</span><br><span class="line">  shared_ptr&lt;Node&gt; sk(head);</span><br><span class="line">  while(sk) &#123;</span><br><span class="line">    cout &lt;&lt; sk-&gt;key &lt;&lt; &quot; &quot; &lt;&lt; sk-&gt;val &lt;&lt; endl;</span><br><span class="line">    sk = sk-&gt;next;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">bool SequentialSearchST&lt;S,T&gt;::contain(const S&amp; key) const &#123;</span><br><span class="line">  shared_ptr&lt;Node&gt; sk(head);</span><br><span class="line">  while(sk &amp;&amp; sk-&gt;key != key) &#123;</span><br><span class="line">    sk = sk-&gt;next;</span><br><span class="line">  &#125;</span><br><span class="line">  if(!sk) </span><br><span class="line">    return false;</span><br><span class="line">  return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">const vector&lt;S&gt; SequentialSearchST&lt;S,T&gt;::keys() const &#123;</span><br><span class="line">  vector&lt;S&gt; res;</span><br><span class="line">  shared_ptr&lt;Node&gt; sk(head);</span><br><span class="line">  while(sk) &#123;</span><br><span class="line">    res.push_back(sk-&gt;key);</span><br><span class="line">    sk = sk-&gt;next;</span><br><span class="line">  &#125;</span><br><span class="line">  return res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ğŸš†æ”¹è¿›1ï¼šæ”¹ç”¨æ•°ç»„å®ç°ï¼ŒäºŒåˆ†æŸ¥æ‰¾"><a href="#ğŸš†æ”¹è¿›1ï¼šæ”¹ç”¨æ•°ç»„å®ç°ï¼ŒäºŒåˆ†æŸ¥æ‰¾" class="headerlink" title="ğŸš†æ”¹è¿›1ï¼šæ”¹ç”¨æ•°ç»„å®ç°ï¼ŒäºŒåˆ†æŸ¥æ‰¾"></a>ğŸš†æ”¹è¿›1ï¼šæ”¹ç”¨æ•°ç»„å®ç°ï¼ŒäºŒåˆ†æŸ¥æ‰¾</h4><p>æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦é™ä½ä¸ºlgNï¼Œä½†æ˜¯å› ä¸ºæ•°ç»„ç§»ä½çš„åŸå› ï¼Œæ’å…¥çš„æ—¶é—´å¤æ‚åº¦è¿˜æ˜¯N</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">#pragma once</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &quot;Common.hpp&quot;</span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line">#include &lt;algorithm&gt;</span><br><span class="line">#include &lt;memory&gt;</span><br><span class="line">#include &lt;iterator&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * æ•°ç»„å®ç°</span><br><span class="line"> **/</span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">class BinarySearchST &#123;</span><br><span class="line">  public:</span><br><span class="line">    BinarySearchST(int size = 10000);</span><br><span class="line">    ~BinarySearchST();</span><br><span class="line">    void put(const S&amp;, const T&amp;);</span><br><span class="line">    const T get(const S&amp;);</span><br><span class="line">    bool contain(const S&amp; key) const;</span><br><span class="line">    const vector&lt;S&gt; keys() const;</span><br><span class="line">    void show() const;</span><br><span class="line">  private:</span><br><span class="line">    const int rank(const S&amp;) const;</span><br><span class="line">    S* _keys;</span><br><span class="line">    T* vals;</span><br><span class="line">    int _capacity;</span><br><span class="line">    int n;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">BinarySearchST&lt;S,T&gt;::BinarySearchST(int size) </span><br><span class="line">  : _keys(new S[size]),</span><br><span class="line">  vals(new T[size]),</span><br><span class="line">  _capacity(size),</span><br><span class="line">  n(0)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">BinarySearchST&lt;S,T&gt;::~BinarySearchST()&#123;</span><br><span class="line">  delete []_keys;</span><br><span class="line">  delete []vals;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">const int BinarySearchST&lt;S,T&gt;::rank(const S&amp; key) const&#123;</span><br><span class="line">  if(n == 0) </span><br><span class="line">    return 0;</span><br><span class="line">  int lo = 0,</span><br><span class="line">    hi = n - 1,</span><br><span class="line">    mid;</span><br><span class="line">  while(lo &lt; hi) &#123;</span><br><span class="line">    mid = lo + (hi - lo) / 2;</span><br><span class="line">    if(_keys[mid] &lt; key) </span><br><span class="line">      lo = mid + 1;</span><br><span class="line">    else </span><br><span class="line">      hi = mid;</span><br><span class="line">  &#125;</span><br><span class="line">  if(_keys[lo] &lt; key)</span><br><span class="line">    return lo + 1;</span><br><span class="line">  else </span><br><span class="line">    return lo;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">void BinarySearchST&lt;S,T&gt;::put(const S&amp; key, const T&amp; val)</span><br><span class="line">&#123;</span><br><span class="line">  int pos = rank(key);</span><br><span class="line">  if(pos &lt; n &amp;&amp; _keys[pos] == key) &#123; </span><br><span class="line">    vals[pos] = val;</span><br><span class="line">    return ;</span><br><span class="line">  &#125;</span><br><span class="line">  //æš‚æ—¶ä¸è€ƒè™‘è¶…å‡ºå®¹é‡çš„æƒ…å†µ</span><br><span class="line">  for(int i = n; i &gt; pos; --i) &#123;</span><br><span class="line">    _keys[i] = _keys[i - 1];</span><br><span class="line">    vals[i] = vals[i - 1];</span><br><span class="line">  &#125;</span><br><span class="line">  _keys[pos] = key;</span><br><span class="line">  vals[pos] = val;</span><br><span class="line">  ++n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">const T BinarySearchST&lt;S,T&gt;::get(const S&amp; key) &#123;</span><br><span class="line">  int pos = rank(key);</span><br><span class="line">  if(pos &lt; n &amp;&amp; _keys[pos] == key) &#123; </span><br><span class="line">    return vals[pos];</span><br><span class="line">  &#125;</span><br><span class="line">  return T();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">bool BinarySearchST&lt;S,T&gt;::contain(const S&amp; key) const &#123;</span><br><span class="line">  if(!n) </span><br><span class="line">    return false;</span><br><span class="line">  int pos = rank(key);</span><br><span class="line">  return _keys[pos] == key;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">const vector&lt;S&gt; BinarySearchST&lt;S,T&gt;::keys() const &#123;</span><br><span class="line">  return vector&lt;S&gt;(_keys, _keys + n);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">void BinarySearchST&lt;S,T&gt;::show() const &#123;</span><br><span class="line">  for(int i = 0; i &lt; n; ++i) &#123;</span><br><span class="line">    cout &lt;&lt; _keys[i] &lt;&lt; &quot; &quot; &lt;&lt; vals[i] &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ğŸš†æ”¹è¿›2ï¼šæ”¹ç”¨äºŒå‰æŸ¥æ‰¾æ ‘"><a href="#ğŸš†æ”¹è¿›2ï¼šæ”¹ç”¨äºŒå‰æŸ¥æ‰¾æ ‘" class="headerlink" title="ğŸš†æ”¹è¿›2ï¼šæ”¹ç”¨äºŒå‰æŸ¥æ‰¾æ ‘"></a>ğŸš†æ”¹è¿›2ï¼šæ”¹ç”¨äºŒå‰æŸ¥æ‰¾æ ‘</h4><p>æŸ¥æ‰¾ã€ä¿®æ”¹çš„å¹³å‡æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯lgNï¼Œä½†æ˜¯æœ€åæƒ…å†µä¸¤è€…éƒ½é€€å›åˆ°N</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br></pre></td><td class="code"><pre><span class="line">#pragma once</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &quot;Common.hpp&quot;</span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line">#include &lt;algorithm&gt;</span><br><span class="line">#include &lt;memory&gt;</span><br><span class="line">#include &lt;iterator&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * äºŒå‰æŸ¥æ‰¾æ ‘çš„å®ç°</span><br><span class="line"> **/</span><br><span class="line">#pragma once</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &quot;Common.hpp&quot;</span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line">#include &lt;algorithm&gt;</span><br><span class="line">#include &lt;memory&gt;</span><br><span class="line">#include &lt;iterator&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * äºŒå‰æŸ¥æ‰¾æ ‘çš„å®ç°</span><br><span class="line"> **/</span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">class BST&#123;</span><br><span class="line">  public:</span><br><span class="line">    struct Node &#123;</span><br><span class="line">      const S key;</span><br><span class="line">      T val;</span><br><span class="line">      shared_ptr&lt;Node&gt; left, right;</span><br><span class="line">      int N;</span><br><span class="line">      Node(const S&amp;key, const T&amp; val, int N) :</span><br><span class="line">        key(key), val(val), left(), right(), N(N) &#123;&#125;</span><br><span class="line">      int compareTo(shared_ptr&lt;Node&gt; node) const;</span><br><span class="line">      int compareTo(const S&amp;) const;</span><br><span class="line">      static int Nsize(shared_ptr&lt;Node&gt; x);  </span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    const S min() const;</span><br><span class="line">    const S max() const;</span><br><span class="line">    bool contain(const S&amp;) const;</span><br><span class="line">    const T get(const S&amp;) const;</span><br><span class="line">    void put(const S&amp; key, const T&amp; val);</span><br><span class="line">    void show() const; //è°ƒè¯•</span><br><span class="line">    const vector&lt;S&gt; keys() const;</span><br><span class="line">    const S floor(const S&amp; key) const;</span><br><span class="line">    const S ceiling(const S&amp;key) const;</span><br><span class="line">    const S select(int x) const;</span><br><span class="line">    const int rank(const T&amp;) const;</span><br><span class="line">    void deleteMin();</span><br><span class="line">    void delet(const T&amp; key);</span><br><span class="line">  private:</span><br><span class="line">    shared_ptr&lt;Node&gt; delet(shared_ptr&lt;Node&gt; nd, const T&amp; key);</span><br><span class="line">    shared_ptr&lt;Node&gt; deleteMin(shared_ptr&lt;Node&gt;);</span><br><span class="line">    const int _rank(shared_ptr&lt;Node&gt; nd, const T&amp; key) const;</span><br><span class="line">    shared_ptr&lt;Node&gt; _select(shared_ptr&lt;Node&gt; nd, int x) const;</span><br><span class="line">    shared_ptr&lt;Node&gt; _floor(shared_ptr&lt;Node&gt; x, const S&amp; key) const;</span><br><span class="line">    shared_ptr&lt;Node&gt; _ceiling(shared_ptr&lt;Node&gt; x, const S&amp;key) const;</span><br><span class="line">    shared_ptr&lt;Node&gt; _min(shared_ptr&lt;Node&gt; x) const;</span><br><span class="line">    shared_ptr&lt;Node&gt; _max(shared_ptr&lt;Node&gt; x) const;</span><br><span class="line">    shared_ptr&lt;Node&gt; _put(shared_ptr&lt;Node&gt; x, const S&amp; key, const T&amp; val);</span><br><span class="line">    const T _get(shared_ptr&lt;Node&gt; x,const S&amp;) const;</span><br><span class="line">    void _show(shared_ptr&lt;Node&gt; x) const;</span><br><span class="line">    void _keys(vector&lt;S&gt;&amp;, shared_ptr&lt;Node&gt; x) const;</span><br><span class="line">    shared_ptr&lt;Node&gt; head;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">void BST&lt;S,T&gt;::put(const S&amp; key, const T&amp; val) &#123;</span><br><span class="line">  head = _put(head, key, val);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">shared_ptr&lt;typename BST&lt;S,T&gt;::Node&gt; </span><br><span class="line">BST&lt;S,T&gt;::_put(shared_ptr&lt;Node&gt; x, const S&amp; key, const T&amp; val) </span><br><span class="line">&#123;</span><br><span class="line">  if(!x) </span><br><span class="line">    return make_shared&lt;Node&gt;(key, val, 1);</span><br><span class="line">  int cmp = x-&gt;compareTo(key);</span><br><span class="line">  if(cmp &gt; 0) x-&gt;left = _put(x-&gt;left, key, val); </span><br><span class="line">  else if(cmp &lt; 0) x-&gt;right = _put(x-&gt;right, key, val);</span><br><span class="line">  else x-&gt;val = val;</span><br><span class="line">  x-&gt;N = Node::Nsize(x-&gt;left) + Node::Nsize(x-&gt;right) + 1;</span><br><span class="line">  return x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &gt; 1</span><br><span class="line"> * = 0</span><br><span class="line"> * &lt; -1</span><br><span class="line"> **/ </span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">int BST&lt;S,T&gt;::Node::compareTo(shared_ptr&lt;Node&gt; node) const &#123;</span><br><span class="line">  return compareTo(node-&gt;key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">int BST&lt;S,T&gt;::Node::compareTo(const S&amp; key2) const &#123;</span><br><span class="line">  return key &gt; key2 ? 1 : key &lt; key2 ? -1 : 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">int BST&lt;S,T&gt;::Node::Nsize(shared_ptr&lt;Node&gt; x) &#123;</span><br><span class="line">  if(!x) </span><br><span class="line">    return 0;</span><br><span class="line">  else </span><br><span class="line">    return x-&gt;N;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">const T BST&lt;S,T&gt;::get(const S&amp; key) const &#123;</span><br><span class="line">  return _get(head, key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">const T BST&lt;S,T&gt;::_get(shared_ptr&lt;Node&gt; x,const S&amp; key) const &#123;</span><br><span class="line">  if(!x) </span><br><span class="line">    return T();</span><br><span class="line">  int cmp = x-&gt;compareTo(key);</span><br><span class="line">  if(cmp &gt; 0) return _get(x-&gt;right, key);</span><br><span class="line">  else if(cmp &lt; 0) return _get(x-&gt;left, key);</span><br><span class="line">  else return x-&gt;val;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">bool BST&lt;S,T&gt;::contain(const S&amp; key) const &#123;</span><br><span class="line">  return get(key) != T();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">void BST&lt;S,T&gt;::show() const &#123;</span><br><span class="line">  _show(head);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">void BST&lt;S,T&gt;::_show(shared_ptr&lt;Node&gt; x) const &#123;</span><br><span class="line">  if(!x) </span><br><span class="line">    return ;</span><br><span class="line">  if(x-&gt;left) </span><br><span class="line">    _show(x-&gt;left);</span><br><span class="line">  cout &lt;&lt; x-&gt;key &lt;&lt; &quot; &quot; &lt;&lt; x-&gt;val &lt;&lt; endl;</span><br><span class="line">  if(x-&gt;right)</span><br><span class="line">    _show(x-&gt;right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">const vector&lt;S&gt; BST&lt;S,T&gt;::keys() const &#123;</span><br><span class="line">  vector&lt;S&gt; res;</span><br><span class="line">  _keys(res, head);</span><br><span class="line">  return res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">void BST&lt;S,T&gt;::_keys(vector&lt;S&gt;&amp; res, shared_ptr&lt;Node&gt; x) const &#123;</span><br><span class="line">  if(!x) </span><br><span class="line">    return ;</span><br><span class="line">  res.push_back(x-&gt;key);</span><br><span class="line">  _keys(res,x-&gt;left);</span><br><span class="line">  _keys(res, x-&gt;right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">const S BST&lt;S,T&gt;::min() const &#123;</span><br><span class="line">  if(!head) </span><br><span class="line">    return S();</span><br><span class="line">  return _min(head)-&gt;key;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">shared_ptr&lt;typename BST&lt;S,T&gt;::Node&gt; </span><br><span class="line">BST&lt;S,T&gt;::_min(shared_ptr&lt;Node&gt; x) const </span><br><span class="line">&#123;</span><br><span class="line">  if(!x || !x-&gt;left)</span><br><span class="line">    return x;</span><br><span class="line">  else</span><br><span class="line">    return _min(x-&gt;left);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">const S BST&lt;S,T&gt;::max() const &#123;</span><br><span class="line">  if(!head) </span><br><span class="line">    return S();</span><br><span class="line">  return _max(head)-&gt;key;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">shared_ptr&lt;typename BST&lt;S,T&gt;::Node&gt; </span><br><span class="line">BST&lt;S,T&gt;::_max(shared_ptr&lt;Node&gt; x) const </span><br><span class="line">&#123;</span><br><span class="line">  if(!x || !x-&gt;right)</span><br><span class="line">    return x;</span><br><span class="line">  else</span><br><span class="line">    return _max(x-&gt;right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">const S BST&lt;S,T&gt;::floor(const S&amp; key) const &#123;</span><br><span class="line">  shared_ptr&lt;Node&gt; nd = _floor(head, key);</span><br><span class="line">  if(!nd) return S();</span><br><span class="line">  return nd-&gt;key;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">const S BST&lt;S,T&gt;::ceiling(const S&amp;key) const &#123;</span><br><span class="line">  shared_ptr&lt;Node&gt; nd = _ceiling(head, key);</span><br><span class="line">  if(!nd) return S();</span><br><span class="line">  return nd-&gt;key;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">shared_ptr&lt;typename BST&lt;S,T&gt;::Node&gt; </span><br><span class="line">BST&lt;S,T&gt;::_floor(shared_ptr&lt;Node&gt; x, const S&amp; key) const </span><br><span class="line">&#123;</span><br><span class="line">  if(!x) return x;</span><br><span class="line">  int cmp = x-&gt;compareTo(key);</span><br><span class="line">  if(cmp == 0) return x;</span><br><span class="line">  else if (cmp &gt; 0) return _floor(x-&gt;left, key);</span><br><span class="line">  shared_ptr&lt;Node&gt; y = _floor(x-&gt;right, key);</span><br><span class="line">  if(!y) return x;</span><br><span class="line">  return y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">shared_ptr&lt;typename BST&lt;S,T&gt;::Node&gt; </span><br><span class="line">BST&lt;S,T&gt;::_ceiling(shared_ptr&lt;Node&gt; x, const S&amp;key) const </span><br><span class="line">&#123;</span><br><span class="line">  if(!x) return x;</span><br><span class="line">  int cmp = x-&gt;compareTo(key);</span><br><span class="line">  if(!cmp) return x;</span><br><span class="line">  else if(cmp &lt; 0) return _ceiling(x-&gt;right, key);</span><br><span class="line">  shared_ptr&lt;Node&gt; y = _ceiling(x-&gt;left, key);</span><br><span class="line">  if(!y) return x;</span><br><span class="line">  return y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">const S BST&lt;S,T&gt;::select(int x) const &#123;</span><br><span class="line">  if(x &lt; 0 || x &gt;= head-&gt;N)</span><br><span class="line">    return S();</span><br><span class="line">  auto nd =  _select(head, x);</span><br><span class="line">  if(!nd) </span><br><span class="line">    return S();</span><br><span class="line">  return nd-&gt;key;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">shared_ptr&lt;typename BST&lt;S,T&gt;::Node&gt; </span><br><span class="line">BST&lt;S,T&gt;::_select(shared_ptr&lt;Node&gt; nd, int x) const </span><br><span class="line">&#123;</span><br><span class="line">  if(!nd) </span><br><span class="line">    return nd;</span><br><span class="line">  int nd_rank = Node::Nsize(nd-&gt;left);</span><br><span class="line">  if(nd_rank &gt; x) </span><br><span class="line">    return _select(nd-&gt;left, x);</span><br><span class="line">  else if (nd_rank &lt; x)</span><br><span class="line">    return _select(nd-&gt;right, x - nd_rank - 1);</span><br><span class="line">  return nd;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">const int BST&lt;S,T&gt;::rank(const T&amp; key) const &#123;</span><br><span class="line">  int rk = _rank(head, key);</span><br><span class="line">  // if(select(rk) != key)</span><br><span class="line">  //   return -1;</span><br><span class="line">  return rk;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">const int BST&lt;S,T&gt;::_rank(shared_ptr&lt;Node&gt; nd, const T&amp; key) const </span><br><span class="line">&#123;</span><br><span class="line">  if(!nd) return 0;</span><br><span class="line">  int nd_rank = Node::Nsize(nd-&gt;left);</span><br><span class="line">  if(nd-&gt;key &lt; key) </span><br><span class="line">    return nd_rank + 1 + _rank(nd-&gt;right, key);</span><br><span class="line">  else if(nd-&gt;key &gt; key) </span><br><span class="line">    return _rank(nd-&gt;left, key);</span><br><span class="line">  return nd_rank;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * è¿™ä¸ªå‡½æ•°åªèƒ½åˆ é™¤æ ¹èŠ‚ç‚¹å·¦è¾¹çš„</span><br><span class="line"> **/ </span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">void BST&lt;S,T&gt;::deleteMin() &#123;</span><br><span class="line">  deleteMin(head);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">shared_ptr&lt;typename BST&lt;S,T&gt;::Node&gt; </span><br><span class="line">BST&lt;S,T&gt;::deleteMin(shared_ptr&lt;Node&gt; x) </span><br><span class="line">&#123;</span><br><span class="line">  if(!x-&gt;left)</span><br><span class="line">    return x-&gt;right;</span><br><span class="line">  x-&gt;left = deleteMin(x-&gt;left);</span><br><span class="line">  x-&gt;N = Node::Nsize(x-&gt;left) + Node::Nsize(x-&gt;right) + 1;</span><br><span class="line">  return x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">void BST&lt;S,T&gt;::delet(const T&amp; key) &#123;</span><br><span class="line">  head = delet(head, key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename S, typename T&gt;</span><br><span class="line">shared_ptr&lt;typename BST&lt;S,T&gt;::Node&gt; </span><br><span class="line">BST&lt;S,T&gt;::delet(shared_ptr&lt;Node&gt; nd, const T&amp; key)</span><br><span class="line">&#123;</span><br><span class="line">  if(!nd) &#123;</span><br><span class="line">    return nd;</span><br><span class="line">  &#125;</span><br><span class="line">  int cmp = nd-&gt;compareTo(key);</span><br><span class="line">  if(cmp &lt; 0) </span><br><span class="line">  &#123;</span><br><span class="line">    nd-&gt;right = delet(nd-&gt;right, key);</span><br><span class="line">  &#125; else if(cmp &gt; 0) &#123;</span><br><span class="line">    nd -&gt;left = delet(nd-&gt;left, key);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    if(!nd-&gt;left) return nd-&gt;right;</span><br><span class="line">    if(!nd-&gt;right) return nd-&gt;left;</span><br><span class="line">    auto minO = _min(nd-&gt;right);</span><br><span class="line">    minO-&gt;right = deleteMin(nd-&gt;right);</span><br><span class="line">    minO-&gt;left = nd-&gt;left;</span><br><span class="line">    nd = minO;</span><br><span class="line">  &#125;</span><br><span class="line">  nd-&gt;N = Node::Nsize(nd-&gt;left) + Node::Nsize(nd-&gt;right) + 1;</span><br><span class="line">  return nd;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ğŸš†æ”¹è¿›3ï¼šçº¢é»‘æ ‘"><a href="#ğŸš†æ”¹è¿›3ï¼šçº¢é»‘æ ‘" class="headerlink" title="ğŸš†æ”¹è¿›3ï¼šçº¢é»‘æ ‘"></a>ğŸš†æ”¹è¿›3ï¼šçº¢é»‘æ ‘</h4><p>æŸ¥æ‰¾ã€æ’å…¥çš„æ—¶é—´å¤æ‚åº¦æ’å®šä¸ºlogN</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> * @Author: XiaoGongBai </span><br><span class="line"> * @Date: 2020-01-19 10:21:20 </span><br><span class="line"> * @Last Modified by: XiaoGongBai</span><br><span class="line"> * @Last Modified time: 2020-01-19 11:31:04</span><br><span class="line"> */</span><br><span class="line">#pragma once</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &quot;Common.hpp&quot;</span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line">#include &lt;algorithm&gt;</span><br><span class="line">#include &lt;memory&gt;</span><br><span class="line">#include &lt;iterator&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * çº¢é»‘æ ‘</span><br><span class="line"> **/</span><br><span class="line">enum class Color&#123;</span><br><span class="line">  Red ,</span><br><span class="line">  Black </span><br><span class="line">&#125;;</span><br><span class="line">template&lt;typename Key, typename Val&gt;</span><br><span class="line">class RedBlackBST&#123;</span><br><span class="line">  public:</span><br><span class="line">    struct Node&#123;</span><br><span class="line">      Key key;</span><br><span class="line">      Val val;</span><br><span class="line">      shared_ptr&lt;Node&gt; left,right;</span><br><span class="line">      int N;</span><br><span class="line">      Color color;</span><br><span class="line">      Node(const Key&amp; key, const Val&amp; val, int N, Color color)</span><br><span class="line">        :key(key), val(val), left(), right(), N(N), color(color) &#123;&#125;</span><br><span class="line">      static int Nsize(shared_ptr&lt;Node&gt; x);  </span><br><span class="line">      int compareTo(const Key&amp; key) const;</span><br><span class="line">    &#125;;</span><br><span class="line">    void put(const Key&amp; key, const Val&amp; val);</span><br><span class="line">    shared_ptr&lt;Node&gt; get(const Key&amp; key) const;</span><br><span class="line">    void deleteMin();</span><br><span class="line">    void deleteMax();</span><br><span class="line">    void delet(const Key&amp;);</span><br><span class="line">    Key min() const;</span><br><span class="line">    Key max() const;</span><br><span class="line">    vector&lt;Key&gt; keys(const Key&amp; m, const Key&amp; e) const;</span><br><span class="line">    vector&lt;Key&gt; keys() const;</span><br><span class="line"></span><br><span class="line">    const int size() const &#123;return root ? root-&gt;N : 0;&#125;</span><br><span class="line">  private:</span><br><span class="line">    </span><br><span class="line">    shared_ptr&lt;Node&gt; root;</span><br><span class="line"></span><br><span class="line">    void keys(shared_ptr&lt;Node&gt; h, vector&lt;Key&gt;&amp; res, const Key&amp; m, const Key&amp; e) const;</span><br><span class="line">    shared_ptr&lt;Node&gt; max(shared_ptr&lt;Node&gt; h) const;</span><br><span class="line">    shared_ptr&lt;Node&gt; min(shared_ptr&lt;Node&gt;) const;</span><br><span class="line">    shared_ptr&lt;Node&gt; get(shared_ptr&lt;Node&gt; h,const Key&amp; key) const;</span><br><span class="line">    shared_ptr&lt;Node&gt; delet(shared_ptr&lt;Node&gt;, const Key&amp;);</span><br><span class="line">    shared_ptr&lt;Node&gt; balance(shared_ptr&lt;Node&gt;);</span><br><span class="line">    shared_ptr&lt;Node&gt; removeRedLeft(shared_ptr&lt;Node&gt;);</span><br><span class="line">    shared_ptr&lt;Node&gt; removeRedRight(shared_ptr&lt;Node&gt;);</span><br><span class="line">    shared_ptr&lt;Node&gt; deleteMax(shared_ptr&lt;Node&gt;);</span><br><span class="line">    shared_ptr&lt;Node&gt; deleteMin(shared_ptr&lt;Node&gt;);</span><br><span class="line">    shared_ptr&lt;Node&gt; put(shared_ptr&lt;Node&gt; h, const Key&amp; key, const Val&amp; val);</span><br><span class="line">    void flipColor(shared_ptr&lt;Node&gt; h);</span><br><span class="line">    shared_ptr&lt;Node&gt; rotateLeft(shared_ptr&lt;Node&gt; node);</span><br><span class="line">    shared_ptr&lt;Node&gt; rotateRight(shared_ptr&lt;Node&gt; h);</span><br><span class="line">    bool isRed(shared_ptr&lt;Node&gt; node)  const;  </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">template&lt;typename Key, typename Val&gt;</span><br><span class="line">int </span><br><span class="line">RedBlackBST&lt;Key,Val&gt;::Node::Nsize(shared_ptr&lt;Node&gt; x)</span><br><span class="line">&#123;</span><br><span class="line">  return x ? x-&gt;N : 0;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Key, typename Val&gt;</span><br><span class="line">int </span><br><span class="line">RedBlackBST&lt;Key,Val&gt;::Node::compareTo(const Key&amp; key) const</span><br><span class="line">&#123;</span><br><span class="line">  if(key &gt; this-&gt;key) &#123;</span><br><span class="line">    return -1;</span><br><span class="line">  &#125;  else if(key &lt; this-&gt;key) &#123;</span><br><span class="line">    return 1;</span><br><span class="line">  &#125;</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">template&lt;typename Key, typename Val&gt;</span><br><span class="line">shared_ptr&lt;typename RedBlackBST&lt;Key,Val&gt;::Node&gt; </span><br><span class="line">RedBlackBST&lt;Key,Val&gt;::rotateLeft(shared_ptr&lt;Node&gt; h)</span><br><span class="line">&#123;</span><br><span class="line">  if(!h) </span><br><span class="line">    return nullptr;</span><br><span class="line">  auto rh = h-&gt;right;</span><br><span class="line">  if(!rh)</span><br><span class="line">    return h;</span><br><span class="line">  h-&gt;right = rh-&gt;left;</span><br><span class="line">  rh-&gt;left = h;</span><br><span class="line">  rh-&gt;N = h-&gt;N;</span><br><span class="line">  h-&gt;N = Node::Nsize(h-&gt;left) + Node::Nsize(h-&gt;right) + 1;</span><br><span class="line">  swap(h-&gt;color, rh-&gt;color);</span><br><span class="line">  return rh;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Key, typename Val&gt;</span><br><span class="line">shared_ptr&lt;typename RedBlackBST&lt;Key,Val&gt;::Node&gt; </span><br><span class="line">RedBlackBST&lt;Key,Val&gt;::rotateRight(shared_ptr&lt;Node&gt; h)</span><br><span class="line">&#123;</span><br><span class="line">  if(!h) &#123;</span><br><span class="line">    return nullptr;</span><br><span class="line">  &#125;</span><br><span class="line">  auto lh = h-&gt;left;</span><br><span class="line">  if(!lh)</span><br><span class="line">    return h;</span><br><span class="line">  h-&gt;left = lh-&gt;right;;</span><br><span class="line">  lh-&gt;right = h;</span><br><span class="line">  lh-&gt;N = h-&gt;N;</span><br><span class="line">  h-&gt;N = Node::Nsize(h-&gt;left) + Node::Nsize(h-&gt;right) + 1;</span><br><span class="line">  swap(h-&gt;color, lh-&gt;color);</span><br><span class="line">  return lh;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Key, typename Val&gt;</span><br><span class="line">bool </span><br><span class="line">RedBlackBST&lt;Key,Val&gt;::isRed(shared_ptr&lt;Node&gt; h)  const</span><br><span class="line">&#123;</span><br><span class="line">  if(!h || h-&gt;color == Color::Black)</span><br><span class="line">    return false;</span><br><span class="line">  return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Key, typename Val&gt;</span><br><span class="line">void </span><br><span class="line">RedBlackBST&lt;Key,Val&gt;::put(const Key&amp; key, const Val&amp; val)</span><br><span class="line">&#123;</span><br><span class="line">  root = put(root, key, val);</span><br><span class="line">  root-&gt;color = Color::Black;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">template&lt;typename Key, typename Val&gt;</span><br><span class="line">shared_ptr&lt;typename RedBlackBST&lt;Key,Val&gt;::Node&gt; </span><br><span class="line">RedBlackBST&lt;Key,Val&gt;::put(shared_ptr&lt;Node&gt; h, const Key&amp; key, const Val&amp; val)</span><br><span class="line">&#123;</span><br><span class="line">  if(!h)</span><br><span class="line">    return make_shared&lt;Node&gt;(key, val, 1, Color::Red);</span><br><span class="line">  int cmp = h-&gt;compareTo(key);</span><br><span class="line">  if(cmp &lt; 0) &#123;</span><br><span class="line">    h-&gt;right = put(h-&gt;right, key, val);</span><br><span class="line">  &#125; else if (cmp &gt; 0) &#123;</span><br><span class="line">    h-&gt;left = put(h-&gt;left, key, val);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    h-&gt;val =val;</span><br><span class="line">  &#125;</span><br><span class="line">  if(!isRed(h-&gt;left) &amp;&amp; isRed(h-&gt;right))</span><br><span class="line">    h = rotateLeft(h);</span><br><span class="line">  if(isRed(h-&gt;left) &amp;&amp; isRed(h-&gt;left-&gt;left))</span><br><span class="line">    h = rotateRight(h);</span><br><span class="line">  if(isRed(h-&gt;left) &amp;&amp; isRed(h-&gt;right)) &#123;</span><br><span class="line">    flipColor(h);</span><br><span class="line">  &#125;</span><br><span class="line">  h-&gt;N = Node::Nsize(h-&gt;left) + Node::Nsize(h-&gt;right) + 1;</span><br><span class="line">  return h;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Key, typename Val&gt;</span><br><span class="line">void </span><br><span class="line">RedBlackBST&lt;Key,Val&gt;::flipColor(shared_ptr&lt;Node&gt; h)</span><br><span class="line">&#123;</span><br><span class="line">  h-&gt;color = h-&gt;color == Color::Black ? Color::Red : Color::Black;</span><br><span class="line">  h-&gt;right-&gt;color = h-&gt;right-&gt;color == Color::Black ? Color::Red : Color::Black;</span><br><span class="line">  h-&gt;left-&gt;color = h-&gt;left-&gt;color == Color::Black ? Color::Red : Color::Black;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Key, typename Val&gt;</span><br><span class="line">shared_ptr&lt;typename RedBlackBST&lt;Key,Val&gt;::Node&gt; </span><br><span class="line">RedBlackBST&lt;Key,Val&gt;::get(const Key&amp; key) const</span><br><span class="line">&#123;</span><br><span class="line">  return get(root, key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Key, typename Val&gt;</span><br><span class="line">shared_ptr&lt;typename RedBlackBST&lt;Key,Val&gt;::Node&gt; </span><br><span class="line">RedBlackBST&lt;Key,Val&gt;::get(shared_ptr&lt;Node&gt; h,const Key&amp; key) const</span><br><span class="line">&#123;</span><br><span class="line">  if(!h)</span><br><span class="line">    return nullptr;</span><br><span class="line">  int cmp = h-&gt;compareTo(key);</span><br><span class="line">  if(cmp &gt; 0) &#123;</span><br><span class="line">    return get(h-&gt;left, key);</span><br><span class="line">  &#125; else if (cmp &lt; 0) &#123;</span><br><span class="line">    return get(h-&gt;right, key);</span><br><span class="line">  &#125; else </span><br><span class="line">    return h;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Key, typename Val&gt;</span><br><span class="line">void RedBlackBST&lt;Key,Val&gt;::deleteMin()</span><br><span class="line">&#123;</span><br><span class="line">  if(!isRed(root-&gt;left) &amp;&amp; !isRed(root-&gt;right))</span><br><span class="line">    root-&gt;color = Color::Red;</span><br><span class="line">  root = deleteMin(root);</span><br><span class="line">  if(root)</span><br><span class="line">    root-&gt;color = Color::Black;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Key, typename Val&gt;</span><br><span class="line">shared_ptr&lt;typename RedBlackBST&lt;Key,Val&gt;::Node&gt; </span><br><span class="line">RedBlackBST&lt;Key,Val&gt;::deleteMin(shared_ptr&lt;Node&gt; h) </span><br><span class="line">&#123;</span><br><span class="line">  if(!h-&gt;left) </span><br><span class="line">    return h-&gt;right;</span><br><span class="line">  if(!isRed(h-&gt;left) &amp;&amp; !isRed(h-&gt;left-&gt;left))</span><br><span class="line">  &#123;</span><br><span class="line">    h = removeRedLeft(h);</span><br><span class="line">  &#125;</span><br><span class="line">  h-&gt;left = deleteMin(h-&gt;left);</span><br><span class="line">  h-&gt;N = Node::Nsize(h-&gt;left) + Node::Nsize(h-&gt;right) + 1;</span><br><span class="line">  return balance(h);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Key, typename Val&gt;</span><br><span class="line">shared_ptr&lt;typename RedBlackBST&lt;Key,Val&gt;::Node&gt; </span><br><span class="line">RedBlackBST&lt;Key,Val&gt;::removeRedLeft(shared_ptr&lt;Node&gt; h) </span><br><span class="line">&#123;</span><br><span class="line">  flipColor(h);</span><br><span class="line">  if(isRed(h-&gt;right) &amp;&amp; isRed(h-&gt;right-&gt;left)) </span><br><span class="line">  &#123;</span><br><span class="line">    h-&gt;right = rotateRight(h-&gt;right);</span><br><span class="line">    h = rotateLeft(h);</span><br><span class="line">    flipColor(h);</span><br><span class="line">  &#125;</span><br><span class="line">  return h;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Key, typename Val&gt;</span><br><span class="line">shared_ptr&lt;typename RedBlackBST&lt;Key,Val&gt;::Node&gt; </span><br><span class="line">RedBlackBST&lt;Key,Val&gt;::balance(shared_ptr&lt;Node&gt; h)</span><br><span class="line">&#123;</span><br><span class="line">  if(!isRed(h-&gt;left) &amp;&amp; isRed(h-&gt;right))</span><br><span class="line">    h = rotateLeft(h);</span><br><span class="line">  if(isRed(h-&gt;left) &amp;&amp; isRed(h-&gt;left-&gt;left))</span><br><span class="line">    h = rotateRight(h);</span><br><span class="line">  if(isRed(h-&gt;left) &amp;&amp; isRed(h-&gt;right)) &#123;</span><br><span class="line">    flipColor(h);</span><br><span class="line">  &#125;</span><br><span class="line">  return h;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Key, typename Val&gt;</span><br><span class="line">Key</span><br><span class="line">RedBlackBST&lt;Key,Val&gt;::min() const</span><br><span class="line">&#123;</span><br><span class="line">  if(!root)</span><br><span class="line">    return Val();</span><br><span class="line">  return min(root)-&gt;key;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Key, typename Val&gt;</span><br><span class="line">shared_ptr&lt;typename RedBlackBST&lt;Key,Val&gt;::Node&gt; </span><br><span class="line">RedBlackBST&lt;Key,Val&gt;::min(shared_ptr&lt;Node&gt; h) const </span><br><span class="line">&#123;</span><br><span class="line">  if(!h-&gt;left)</span><br><span class="line">    return h;</span><br><span class="line">  return min(h-&gt;left);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Key, typename Val&gt;</span><br><span class="line">Key </span><br><span class="line">RedBlackBST&lt;Key,Val&gt;::max() const</span><br><span class="line">&#123;</span><br><span class="line">  if(!root) </span><br><span class="line">    return Val();</span><br><span class="line">  return max(root)-&gt;key;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Key, typename Val&gt;</span><br><span class="line">shared_ptr&lt;typename RedBlackBST&lt;Key,Val&gt;::Node&gt; </span><br><span class="line">RedBlackBST&lt;Key,Val&gt;::max(shared_ptr&lt;Node&gt; h) const</span><br><span class="line">&#123;</span><br><span class="line">  if(!h-&gt;right)</span><br><span class="line">    return h;</span><br><span class="line">  return max(h-&gt;right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Key, typename Val&gt;</span><br><span class="line">void RedBlackBST&lt;Key,Val&gt;::deleteMax()</span><br><span class="line">&#123;</span><br><span class="line">  if(!isRed(root-&gt;left) &amp;&amp; !isRed(root-&gt;right))</span><br><span class="line">    root-&gt;color = Color::Red;</span><br><span class="line">  root = deleteMax(root);</span><br><span class="line">  if(root)</span><br><span class="line">    root-&gt;color = Color::Black;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Key, typename Val&gt;</span><br><span class="line">shared_ptr&lt;typename RedBlackBST&lt;Key,Val&gt;::Node&gt; </span><br><span class="line">RedBlackBST&lt;Key,Val&gt;::deleteMax(shared_ptr&lt;Node&gt; h)</span><br><span class="line">&#123;</span><br><span class="line">  if(isRed(h-&gt;left))</span><br><span class="line">    h = rotateRight(h);</span><br><span class="line">  if(!h-&gt;right)</span><br><span class="line">    return h-&gt;left;</span><br><span class="line">  if(!isRed(h-&gt;right) &amp;&amp; !isRed(h-&gt;right-&gt;left))</span><br><span class="line">    h = removeRedRight(h);</span><br><span class="line">  h-&gt;right = deleteMax(h-&gt;right);</span><br><span class="line">  h-&gt;N = Node::Nsize(h-&gt;left) + Node::Nsize(h-&gt;right) + 1;</span><br><span class="line">  return balance(h);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Key, typename Val&gt;</span><br><span class="line">shared_ptr&lt;typename RedBlackBST&lt;Key,Val&gt;::Node&gt; </span><br><span class="line">RedBlackBST&lt;Key,Val&gt;::removeRedRight(shared_ptr&lt;Node&gt; h)</span><br><span class="line">&#123;</span><br><span class="line">  flipColor(h);</span><br><span class="line">  if(isRed(h-&gt;left-&gt;left)) &#123;</span><br><span class="line">    h = rotateRight(h);</span><br><span class="line">    flipColor(h);</span><br><span class="line">  &#125;</span><br><span class="line">  return h;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Key, typename Val&gt;</span><br><span class="line">void RedBlackBST&lt;Key,Val&gt;::delet(const Key&amp; key)</span><br><span class="line">&#123;</span><br><span class="line">  if(!isRed(root-&gt;left) &amp;&amp; !isRed(root-&gt;right))</span><br><span class="line">    root-&gt;color = Color::Red;</span><br><span class="line">  root = delet(root, key);</span><br><span class="line">  if(root)</span><br><span class="line">    root-&gt;color = Color::Black;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Key, typename Val&gt;</span><br><span class="line">shared_ptr&lt;typename RedBlackBST&lt;Key,Val&gt;::Node&gt; </span><br><span class="line">RedBlackBST&lt;Key,Val&gt;::delet(shared_ptr&lt;Node&gt; h, const Key&amp; key) </span><br><span class="line">&#123;</span><br><span class="line">  int cmp = h-&gt;compareTo(key);</span><br><span class="line">  if(cmp &gt; 0) &#123;</span><br><span class="line">    if(!isRed(h-&gt;left) &amp;&amp; !isRed(h-&gt;left-&gt;left)) </span><br><span class="line">      h = removeRedLeft(h);</span><br><span class="line">    h-&gt;left = delet(h-&gt;left, key);</span><br><span class="line">  &#125; else if(cmp &lt; 0)&#123;</span><br><span class="line">    if(isRed(h-&gt;left))</span><br><span class="line">      h = rotateRight(h);</span><br><span class="line">    if(!isRed(h-&gt;right) &amp;&amp; !isRed(h-&gt;right-&gt;left)) &#123;</span><br><span class="line">      h = removeRedRight(h);</span><br><span class="line">    &#125;</span><br><span class="line">    h-&gt;right = delet(h-&gt;right, key);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    if(!h-&gt;right)</span><br><span class="line">      return h-&gt;left;</span><br><span class="line">    h-&gt;val = get(h-&gt;right, min(h-&gt;right)-&gt;key)-&gt;val;</span><br><span class="line">    h-&gt;key = min(h-&gt;right)-&gt;key;</span><br><span class="line">    h-&gt;right = deleteMin(h-&gt;right);</span><br><span class="line">  &#125;</span><br><span class="line">  h-&gt;N = Node::Nsize(h-&gt;left) + Node::Nsize(h-&gt;right) + 1;</span><br><span class="line">  return balance(h);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Key, typename Val&gt;</span><br><span class="line">vector&lt;Key&gt; </span><br><span class="line">RedBlackBST&lt;Key,Val&gt;::keys(const Key&amp; m, const Key&amp; e) const</span><br><span class="line">&#123;</span><br><span class="line">  vector&lt;Key&gt; res;</span><br><span class="line">  keys(root, res, m, e);</span><br><span class="line">  return res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Key, typename Val&gt;</span><br><span class="line">void </span><br><span class="line">RedBlackBST&lt;Key,Val&gt;::keys(shared_ptr&lt;Node&gt; h, vector&lt;Key&gt;&amp; res, const Key&amp; m, const Key&amp; e) const</span><br><span class="line">&#123;</span><br><span class="line">  if(!h)</span><br><span class="line">    return ;</span><br><span class="line">  int cmp1 = h-&gt;compareTo(m),</span><br><span class="line">    cmp2 = h-&gt;compareTo(e);</span><br><span class="line">  if(cmp1 &gt;= 0 &amp;&amp; cmp2 &lt;= 0) &#123;</span><br><span class="line">    res.push_back(h-&gt;key);</span><br><span class="line">  &#125;</span><br><span class="line">  if(cmp1 &gt; 0) &#123;</span><br><span class="line">    keys(h-&gt;left, res, m, e);</span><br><span class="line">  &#125; </span><br><span class="line">  if(cmp2 &lt; 0) &#123;</span><br><span class="line">    keys(h-&gt;right, res, m, e);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename Key, typename Val&gt;</span><br><span class="line">vector&lt;Key&gt; </span><br><span class="line">RedBlackBST&lt;Key,Val&gt;::keys() const</span><br><span class="line">&#123;</span><br><span class="line">  return keys(min(), max());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å †æ’åº</title>
      <link href="/2020/01/10/alg4/"/>
      <url>/2020/01/10/alg4/</url>
      
        <content type="html"><![CDATA[<h4 id="ğŸ˜˜ä»£ç å®ç°"><a href="#ğŸ˜˜ä»£ç å®ç°" class="headerlink" title="ğŸ˜˜ä»£ç å®ç°"></a>ğŸ˜˜ä»£ç å®ç°</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">#pragma once</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &quot;Common.hpp&quot;</span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line">#include &lt;algorithm&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">/**</span><br><span class="line"> * å †æ’åº</span><br><span class="line"> **/</span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">class HeapSort &#123;</span><br><span class="line">  public:</span><br><span class="line">    static void sort(vector&lt;T&gt;&amp;);</span><br><span class="line">  private:</span><br><span class="line">    static void sink(vector&lt;T&gt;&amp; a, int k, int N);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">void HeapSort&lt;T&gt;::sort(vector&lt;T&gt;&amp; a) &#123;</span><br><span class="line">  int N = a.size() - 1;</span><br><span class="line">  for(int i = N / 2; i &gt;= 1; --i)</span><br><span class="line">    sink(a, i, N);</span><br><span class="line">  while(N &gt; 1) &#123;</span><br><span class="line">    swap(a[1], a[N--]);</span><br><span class="line">    sink(a, 1, N);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">void HeapSort&lt;T&gt;::sink(vector&lt;T&gt;&amp; a, int k, int N) &#123;</span><br><span class="line">  int j;</span><br><span class="line">  while(k &lt;= N / 2) &#123;</span><br><span class="line">    j = 2 * k;</span><br><span class="line">    if(j &lt; N &amp;&amp; a[j] &lt; a[j + 1]) ++j;</span><br><span class="line">    if(a[k] &gt;= a[j]) break;</span><br><span class="line">    swap(a[k], a[j]);</span><br><span class="line">    k = j;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ğŸ‘¿æ³¨æ„"><a href="#ğŸ‘¿æ³¨æ„" class="headerlink" title="ğŸ‘¿æ³¨æ„"></a>ğŸ‘¿æ³¨æ„</h4><ul><li>è¦æ³¨æ„çˆ¶èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹æ—¶çš„æƒ…å†µï¼Œåœ¨sinkå‡½æ•°ä¸­ï¼ˆif(j &lt; N &amp;&amp; a[j] &lt; a[j + 1]) ++j;ï¼‰ä¸€å®šè¦æ³¨æ„j&lt;Nï¼Œä¸èƒ½è¶…å‡ºèŒƒå›´</li><li>æ„é€ æœ€å¤§å †æ—¶ï¼Œforå¾ªç¯ä»i = N / 2å¼€å§‹çš„åŸå› æ˜¯ï¼šsinkä¸­æœ‰é™åˆ¶æ¡ä»¶while(k &lt;= N / 2)ï¼Œæ‰€ä»¥N/2&lt;i&lt;Néƒ¨åˆ†æ— æ³•è¿›å…¥sinkçš„whileå¾ªç¯ï¼Œæ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå¾’å¢N/2æ¬¡æ¯”è¾ƒ</li><li>é€’å¢æ’åºä½¿ç”¨æœ€å¤§å †ï¼Œé€’å‡æ’åºä½¿ç”¨æœ€å°å †</li><li>vectorçš„ç¬¬ä¸€ä¸ªå€¼ï¼ˆä¸‹æ ‡ä¸º0ï¼‰ä¸ä½¿ç”¨</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç´¢å¼•ä¼˜å…ˆé˜Ÿåˆ—</title>
      <link href="/2020/01/10/alg3/"/>
      <url>/2020/01/10/alg3/</url>
      
        <content type="html"><![CDATA[<h4 id="ğŸ¥›åˆ†æ"><a href="#ğŸ¥›åˆ†æ" class="headerlink" title="ğŸ¥›åˆ†æ"></a>ğŸ¥›åˆ†æ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public class IndexMaxPQ...&#123;</span><br><span class="line">    private int maxN;        // maximum number of elements on PQ</span><br><span class="line">    private int n;           // number of elements on PQ</span><br><span class="line">    private int[] pq;        // binary heap using 1-based indexing</span><br><span class="line">    private int[] qp;        // inverse of pq - qp[pq[i]] = pq[qp[i]] = i</span><br><span class="line">    private Key[] keys;      // keys[i] = priority of i</span><br><span class="line"></span><br><span class="line">//ä¸­é—´çœç•¥...</span><br><span class="line">public void insert(int i, Key key) &#123;</span><br><span class="line">        ...</span><br><span class="line">        n++;</span><br><span class="line">        qp[i] = n;</span><br><span class="line">        pq[n] = i;</span><br><span class="line">        keys[i] = key;</span><br><span class="line">        swim(n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;æ ¹æ®ã€Šç®—æ³•4ã€‹ç»™å‡ºçš„ä»£ç ï¼Œåˆ†æè¿™ä¸¤æ®µä»£ç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ï¼š</p><ul><li>åœ¨å®šä¹‰å¤„å¯çŸ¥pqæ˜¯<strong>äºŒå‰å †çš„æ•°ç»„</strong></li><li>ç”±qp[i] = n;<pre><code>pq[n] = i;å¯ä»¥çœ‹å‡ºæ¥ï¼Œqpè¿™ä¸ªæ•°ç»„çš„ç”¨å¤„å°±æ˜¯ä¸ºäº†è®°å½•**pqä¸­å€¼ä¸ºiçš„ä¸‹æ ‡æ˜¯å¤šå°‘**ï¼Œè¿™æ ·å½“æˆ‘ä»¬è¦æ”¹ä¸‹æ ‡ä¸ºiçš„å…ƒç´ çš„å€¼æ—¶ï¼Œæˆ‘ä»¬å°±ä¸ç”¨éå†pqæ¥è·å¾—ä½ç½®äº†ï¼Œ**ç”¨ç©ºé—´æ¥æ¢å–æ—¶é—´**</code></pre></li><li>å¹¶ä¸”è¿™ä¸ªç´¢å¼•iä»…ä»…ä¸ºäº†æ‰¾åˆ°å…ƒç´ å¯¹è±¡keyï¼Œå¹¶æ²¡å®é™…çš„æ„ä¹‰ã€‚næ‰æ˜¯å¯¹åº”äºŒå‰å †çš„ä½ç½®ã€‚<br></li></ul><h4 id="ğŸ˜ä»£ç å®ç°"><a href="#ğŸ˜ä»£ç å®ç°" class="headerlink" title="ğŸ˜ä»£ç å®ç°"></a>ğŸ˜ä»£ç å®ç°</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;vector&gt;</span><br><span class="line">#include &lt;algorithm&gt;</span><br><span class="line">#include  &lt;functional&gt;</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &quot;Common.hpp&quot;</span><br><span class="line">#include &lt;limits&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * ç´¢å¼•æœ€å°ä¼˜å…ˆé˜Ÿåˆ—</span><br><span class="line"> **/ </span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">class IndexMinPQ &#123;</span><br><span class="line">  public:</span><br><span class="line">    IndexMinPQ(int max);</span><br><span class="line">    void show() const;</span><br><span class="line">    int size() const &#123;return N;&#125;</span><br><span class="line">    int capacity() const &#123;return _capacity;&#125;</span><br><span class="line">    void insert(int k, T item);</span><br><span class="line">    void change(int k, T item);</span><br><span class="line">    bool contain(int k) const &#123;return qp[k] != -1;&#125;;</span><br><span class="line">    int delMin();</span><br><span class="line">  private:</span><br><span class="line">    void sink(int i);</span><br><span class="line">    void swim(int i);</span><br><span class="line">    T* element; //å…ƒç´ </span><br><span class="line">    int* pq; //äºŒå‰å †</span><br><span class="line">    int *qp; //index</span><br><span class="line">    int N;</span><br><span class="line">    int _capacity;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">IndexMinPQ&lt;T&gt;::IndexMinPQ(int max) :</span><br><span class="line">  element(new T[max + 1]), pq(new int[max + 1])</span><br><span class="line">  , qp(new int[max + 1]), N(0), _capacity(max) </span><br><span class="line">&#123;</span><br><span class="line">  for(int i = 0; i &lt; max + 1; ++i)</span><br><span class="line">    qp[i] = -1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">void IndexMinPQ&lt;T&gt;::sink(int n)&#123;</span><br><span class="line">  while(n &lt; N) &#123;</span><br><span class="line">    int m = n * 2;</span><br><span class="line">    if(element[pq[m]] &gt; element[pq[m + 1]]) ++m;</span><br><span class="line">    if(element[pq[m]] &lt; element[pq[n]]) break;</span><br><span class="line">    swap(pq[m], pq[n]);</span><br><span class="line">    swap(qp[pq[m]], qp[pq[n]]);</span><br><span class="line">    n = m;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">void IndexMinPQ&lt;T&gt;::swim(int n) &#123;</span><br><span class="line">  while(n &gt; 1) &#123;</span><br><span class="line">    int m = n / 2;</span><br><span class="line">    if(element[pq[m]] &lt;= element[pq[n]]) break;</span><br><span class="line">    swap(pq[m], pq[n]);</span><br><span class="line">    swap(qp[pq[m]], qp[pq[n]]);</span><br><span class="line">    n = m; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">void IndexMinPQ&lt;T&gt;::insert(int k, T item) &#123;</span><br><span class="line">  // cout &lt;&lt; &quot;insert &quot; &lt;&lt; k &lt;&lt; &quot; &quot; &lt;&lt; item &lt;&lt; endl;</span><br><span class="line">  if(capacity() == size())&#123;</span><br><span class="line">    cout &lt;&lt; &quot;out of size&quot; &lt;&lt; endl;</span><br><span class="line">    return ;</span><br><span class="line">  &#125;</span><br><span class="line">  pq[++N] = k;</span><br><span class="line">  element[k] = item;</span><br><span class="line">  qp[k] = N;</span><br><span class="line">  swim(N);</span><br><span class="line">  // show();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">void IndexMinPQ&lt;T&gt;::show() const</span><br><span class="line">&#123;</span><br><span class="line">  cout &lt;&lt; &quot;pq: &quot;;</span><br><span class="line">  for(int i = 1; i &lt;= capacity(); ++i) </span><br><span class="line">    cout &lt;&lt; pq[i] &lt;&lt; &quot; &quot;;</span><br><span class="line">  cout &lt;&lt; endl;</span><br><span class="line">  cout &lt;&lt; &quot;qp: &quot;;</span><br><span class="line">  for(int i = 1; i &lt;= capacity(); ++i) </span><br><span class="line">    cout &lt;&lt; qp[i] &lt;&lt; &quot; &quot;;</span><br><span class="line">  cout &lt;&lt; endl;</span><br><span class="line">  cout &lt;&lt; &quot;element: &quot;;</span><br><span class="line">  for(int i = 1; i &lt;= capacity(); ++i) </span><br><span class="line">    cout &lt;&lt; element[i] &lt;&lt; &quot; &quot;;</span><br><span class="line">  cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">void IndexMinPQ&lt;T&gt;::change(int k, T item) &#123;</span><br><span class="line">  if(!contain(k)) &#123;</span><br><span class="line">    cout &lt;&lt; &quot;change not contain&quot; &lt;&lt; endl;</span><br><span class="line">    return ;   </span><br><span class="line">  &#125;</span><br><span class="line">  T old_one = element[k];</span><br><span class="line">  element[k] = item;</span><br><span class="line">  if(item &gt; old_one) </span><br><span class="line">    sink(qp[k]);</span><br><span class="line">  else if(item &lt; old_one)</span><br><span class="line">    swim(qp[k]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">int IndexMinPQ&lt;T&gt;::delMin() &#123;</span><br><span class="line">  int max = pq[1];</span><br><span class="line">  swap(pq[1], pq[N]);</span><br><span class="line">  swap(qp[pq[1]], qp[pq[N]]);</span><br><span class="line">  --N;</span><br><span class="line">  show();</span><br><span class="line">  sink(1);</span><br><span class="line">  show();</span><br><span class="line">  qp[max] = -1;</span><br><span class="line">  element[max] = -1;</span><br><span class="line">  pq[N + 1] = -1;</span><br><span class="line">  return max;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char** argv) &#123;</span><br><span class="line">  IndexMinPQ&lt;int&gt; pq(6);</span><br><span class="line">  vector&lt;int&gt; v = Common::getInstance()-&gt;getRandomVector(6);</span><br><span class="line">  for(size_t i = 0; i &lt; v.size(); ++i) &#123;</span><br><span class="line">    pq.insert(i + 1, v[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  pq.show();</span><br><span class="line">  pq.delMin();</span><br><span class="line">  pq.show();</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ğŸ å‚è€ƒèµ„æ–™ï¼šé“¾æ¥"><a href="#ğŸ å‚è€ƒèµ„æ–™ï¼šé“¾æ¥" class="headerlink" title="ğŸ å‚è€ƒèµ„æ–™ï¼šé“¾æ¥"></a>ğŸ å‚è€ƒèµ„æ–™ï¼š<a href="https://www.cnblogs.com/nullzx/p/6624731.html" target="_blank" rel="noopener">é“¾æ¥</a></h4>]]></content>
      
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¼˜å…ˆé˜Ÿåˆ—</title>
      <link href="/2020/01/10/alg2/"/>
      <url>/2020/01/10/alg2/</url>
      
        <content type="html"><![CDATA[<h4 id="ğŸ ä¼˜å…ˆé˜Ÿåˆ—çš„å®ç°æœ‰ä¸‰ç§ï¼š"><a href="#ğŸ ä¼˜å…ˆé˜Ÿåˆ—çš„å®ç°æœ‰ä¸‰ç§ï¼š" class="headerlink" title="ğŸ ä¼˜å…ˆé˜Ÿåˆ—çš„å®ç°æœ‰ä¸‰ç§ï¼š"></a>ğŸ ä¼˜å…ˆé˜Ÿåˆ—çš„å®ç°æœ‰ä¸‰ç§ï¼š</h4><ul><li>æœ‰åºæ•°ç»„</li><li>æ— åºæ•°ç»„</li><li>å †</li></ul><h5 id="ğŸ…æœ‰åºæ•°ç»„"><a href="#ğŸ…æœ‰åºæ•°ç»„" class="headerlink" title="ğŸ…æœ‰åºæ•°ç»„"></a>ğŸ…æœ‰åºæ•°ç»„</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;vector&gt;</span><br><span class="line">#include &lt;algorithm&gt;</span><br><span class="line">#include  &lt;functional&gt;</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &quot;Common.hpp&quot;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * ä¼˜å…ˆé˜Ÿåˆ—</span><br><span class="line"> * 2.4.3 æœ‰åºæ•°ç»„å®ç°</span><br><span class="line"> **/ </span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">class OrderArrayMaxPQ &#123;</span><br><span class="line">  private:</span><br><span class="line">    pair&lt;int, T&gt;* arr;</span><br><span class="line">    int N;</span><br><span class="line">    int _capacity;</span><br><span class="line">  public:</span><br><span class="line">    void show() const ;</span><br><span class="line">    explicit OrderArrayMaxPQ(int max);</span><br><span class="line">    ~OrderArrayMaxPQ() &#123;delete [] arr;&#125;</span><br><span class="line">    // explicit OrderArrayMaxPQ(std::initializer_list&lt;pair&lt;int, T&gt;&gt;);</span><br><span class="line">    void insert(pair&lt;int, T&gt;);</span><br><span class="line">    pair&lt;int, T&gt; delMax();</span><br><span class="line">    bool isEmpty() const &#123; return N == 0;&#125;</span><br><span class="line">    int size() const &#123;return N;&#125; </span><br><span class="line">    int capacity() const &#123;return _capacity;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">OrderArrayMaxPQ&lt;T&gt;::OrderArrayMaxPQ(int max) :</span><br><span class="line">  arr(new pair&lt;int, T&gt;[max]()), N(0), _capacity(max)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// template&lt;typename T&gt;</span><br><span class="line">// OrderArrayMaxPQ&lt;T&gt;::OrderArrayMaxPQ(std::initializer_list&lt;pair&lt;int, T&gt;&gt; l) </span><br><span class="line">//   : arr(new pair&lt;int, T&gt;[l.size()]()), N(l.size()), _capacity(l.size())</span><br><span class="line">// &#123;</span><br><span class="line">//   copy(l.begin(), l.end(), arr);</span><br><span class="line">// &#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">void OrderArrayMaxPQ&lt;T&gt;::insert(pair&lt;int, T&gt; x) &#123;</span><br><span class="line">  if(capacity() == size()) </span><br><span class="line">    return ;</span><br><span class="line">  arr[N++] = x;</span><br><span class="line">  for(int i = N - 1; i &gt; 0 &amp;&amp; arr[i] &lt; arr[i - 1]; --i)</span><br><span class="line">    swap(arr[i], arr[i - 1]); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">pair&lt;int, T&gt; OrderArrayMaxPQ&lt;T&gt;::delMax() &#123;</span><br><span class="line">  pair&lt;int ,T&gt; res;</span><br><span class="line">  if(isEmpty())</span><br><span class="line">    return res;</span><br><span class="line">  res = arr[N - 1];</span><br><span class="line">  arr[--N] = pair&lt;int , T&gt;();</span><br><span class="line">  return res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">void OrderArrayMaxPQ&lt;T&gt;::show() const &#123;</span><br><span class="line">  cout &lt;&lt; &quot;N: &quot; &lt;&lt; size() &lt;&lt; &quot; arr: &quot;;</span><br><span class="line">  for(int i = 0; i &lt; N; ++i)</span><br><span class="line">    cout &lt;&lt; arr[i].first &lt;&lt; &quot; &quot;;</span><br><span class="line">  cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char** argv) &#123;</span><br><span class="line">  OrderArrayMaxPQ&lt;int&gt; pq(20);</span><br><span class="line">  vector&lt;int&gt; v = Common::getInstance()-&gt;getRandomVector(12);</span><br><span class="line">  for(auto x: v) &#123;</span><br><span class="line">    pq.insert(&#123;x, x&#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  while(pq.size()) &#123;</span><br><span class="line">    pq.show();</span><br><span class="line">    pq.delMax();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ğŸ¥¦æ— åºæ•°ç»„"><a href="#ğŸ¥¦æ— åºæ•°ç»„" class="headerlink" title="ğŸ¥¦æ— åºæ•°ç»„"></a>ğŸ¥¦æ— åºæ•°ç»„</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;vector&gt;</span><br><span class="line">#include &lt;algorithm&gt;</span><br><span class="line">#include  &lt;functional&gt;</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &quot;Common.hpp&quot;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * ä¼˜å…ˆé˜Ÿåˆ—</span><br><span class="line"> * 2.4.3 æ— åºæ•°ç»„å®ç°</span><br><span class="line"> **/ </span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">class UnOrderArrayMaxPQ &#123;</span><br><span class="line">  private:</span><br><span class="line">    pair&lt;int, T&gt;* arr;</span><br><span class="line">    int N;</span><br><span class="line">    int _capacity;</span><br><span class="line">  public:</span><br><span class="line">    void show() const ;</span><br><span class="line">    explicit UnOrderArrayMaxPQ(int max);</span><br><span class="line">    ~UnOrderArrayMaxPQ() &#123;delete [] arr;&#125;</span><br><span class="line">    explicit UnOrderArrayMaxPQ(std::initializer_list&lt;pair&lt;int, T&gt;&gt;);</span><br><span class="line">    void insert(pair&lt;int, T&gt;);</span><br><span class="line">    pair&lt;int, T&gt; delMax();</span><br><span class="line">    bool isEmpty() const &#123; return N == 0;&#125;</span><br><span class="line">    int size() const &#123;return N;&#125; </span><br><span class="line">    int capacity() const &#123;return _capacity;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">UnOrderArrayMaxPQ&lt;T&gt;::UnOrderArrayMaxPQ(int max) :</span><br><span class="line">  arr(new pair&lt;int, T&gt;[max]()), N(0), _capacity(max)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">UnOrderArrayMaxPQ&lt;T&gt;::UnOrderArrayMaxPQ(std::initializer_list&lt;pair&lt;int, T&gt;&gt; l) </span><br><span class="line">  : arr(new pair&lt;int, T&gt;[l.size()]()), N(l.size()), _capacity(l.size())</span><br><span class="line">&#123;</span><br><span class="line">  copy(l.begin(), l.end(), arr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">void UnOrderArrayMaxPQ&lt;T&gt;::insert(pair&lt;int, T&gt; x) &#123;</span><br><span class="line">  if(capacity() == size()) </span><br><span class="line">    return ;</span><br><span class="line">  arr[N++] = x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">pair&lt;int, T&gt; UnOrderArrayMaxPQ&lt;T&gt;::delMax() &#123;</span><br><span class="line">  if(isEmpty())</span><br><span class="line">    return pair&lt;int, T&gt;();</span><br><span class="line">  int max_one = 0;</span><br><span class="line">  for(int i = 0; i &lt; N; ++i) </span><br><span class="line">    if(arr[max_one].first &lt; arr[i].first) &#123;</span><br><span class="line">      max_one = i;</span><br><span class="line">    &#125;</span><br><span class="line">  swap(arr[max_one], arr[--N]);</span><br><span class="line">  pair&lt;int,T&gt; res = arr[N];</span><br><span class="line">  arr[N] = pair&lt;int,T&gt;();</span><br><span class="line">  return res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">void UnOrderArrayMaxPQ&lt;T&gt;::show() const &#123;</span><br><span class="line">  cout &lt;&lt; &quot;N: &quot; &lt;&lt; size() &lt;&lt; &quot; arr: &quot;;</span><br><span class="line">  for(int i = 0; i &lt; N; ++i)</span><br><span class="line">    cout &lt;&lt; arr[i].first &lt;&lt; &quot; &quot;;</span><br><span class="line">  cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char** argv) &#123;</span><br><span class="line">  UnOrderArrayMaxPQ&lt;int&gt; pq(20);</span><br><span class="line">  vector&lt;int&gt; v = Common::getInstance()-&gt;getRandomVector(12);</span><br><span class="line">  for(auto x: v) &#123;</span><br><span class="line">    pq.insert(&#123;x, x&#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  while(pq.size()) &#123;</span><br><span class="line">    pq.show();</span><br><span class="line">    pq.delMax();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ğŸ¥§å †"><a href="#ğŸ¥§å †" class="headerlink" title="ğŸ¥§å †"></a>ğŸ¥§å †</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;vector&gt;</span><br><span class="line">#include &lt;algorithm&gt;</span><br><span class="line">#include  &lt;functional&gt;</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &quot;Common.hpp&quot;</span><br><span class="line">#include &lt;limits&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * ä¼˜å…ˆé˜Ÿåˆ—</span><br><span class="line"> * äºŒå‰å †å®ç°</span><br><span class="line"> **/ </span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">class MaxPQ &#123;</span><br><span class="line">  private:</span><br><span class="line">    pair&lt;int, T&gt;* arr;</span><br><span class="line">    int N;</span><br><span class="line">    int _capacity;</span><br><span class="line">    void swim(int i);</span><br><span class="line">    void sink(int i);</span><br><span class="line">  public:</span><br><span class="line">    void show() const ;</span><br><span class="line">    explicit MaxPQ(int max);</span><br><span class="line">    ~MaxPQ() &#123;delete [] arr;&#125;</span><br><span class="line">    void insert(pair&lt;int, T&gt;);</span><br><span class="line">    pair&lt;int, T&gt; delMax();</span><br><span class="line">    bool isEmpty() const &#123; return N == 0;&#125;</span><br><span class="line">    int size() const &#123;return N;&#125; </span><br><span class="line">    int capacity() const &#123;return _capacity;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">MaxPQ&lt;T&gt;::MaxPQ(int max) :</span><br><span class="line">  arr(new pair&lt;int, T&gt;[max + 1]()), N(0), _capacity(max + 1)</span><br><span class="line">&#123;</span><br><span class="line">  arr[0] = pair&lt;int, T&gt;(INT8_MIN, T());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">void MaxPQ&lt;T&gt;::insert(pair&lt;int, T&gt; x) &#123;</span><br><span class="line">  if(capacity() == size()) </span><br><span class="line">    return ;</span><br><span class="line">  arr[++N] = x;</span><br><span class="line">  swim(N);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">pair&lt;int, T&gt; MaxPQ&lt;T&gt;::delMax() &#123;</span><br><span class="line">  pair&lt;int ,T&gt; res;</span><br><span class="line">  if(isEmpty())</span><br><span class="line">    return res;</span><br><span class="line">  swap(arr[N--], arr[1]);</span><br><span class="line">  res =  arr[N + 1];</span><br><span class="line">  arr[N + 1] = pair&lt;int ,T&gt;();</span><br><span class="line">  sink(1);</span><br><span class="line">  return res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">void MaxPQ&lt;T&gt;::show() const &#123;</span><br><span class="line">  cout &lt;&lt; &quot;N: &quot; &lt;&lt; size() &lt;&lt; &quot; arr: &quot;;</span><br><span class="line">  for(int i = 1; i &lt;= N; ++i)</span><br><span class="line">    cout &lt;&lt; arr[i].first &lt;&lt; &quot; &quot;;</span><br><span class="line">  cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">void MaxPQ&lt;T&gt;::swim(int i) &#123;</span><br><span class="line">  while(i &gt; 1) &#123;</span><br><span class="line">    if(arr[i].first &gt; arr[i / 2].first) swap(arr[i], arr[i / 2]);</span><br><span class="line">    i /= 2;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">void MaxPQ&lt;T&gt;::sink(int i) &#123;</span><br><span class="line">  int k;</span><br><span class="line">  while(i &lt; N) &#123;</span><br><span class="line">    k = 2 * i;</span><br><span class="line">    if(arr[k].first &lt; arr[k + 1].first) ++k;</span><br><span class="line">    if(arr[k].first &lt;= arr[i].first) break;</span><br><span class="line">    swap(arr[k], arr[i]);</span><br><span class="line">    i = k;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char** argv) &#123;</span><br><span class="line">  MaxPQ&lt;int&gt; pq(20);</span><br><span class="line">  vector&lt;int&gt; v = Common::getInstance()-&gt;getRandomVector(12);</span><br><span class="line">  for(auto x: v) &#123;</span><br><span class="line">    pq.insert(&#123;x, x&#125;);</span><br><span class="line">    // pq.show();</span><br><span class="line">  &#125;</span><br><span class="line">  while(pq.size()) &#123;</span><br><span class="line">    pq.show();</span><br><span class="line">    pq.delMax();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ğŸ¥¨æ—¶é—´å¤æ‚åº¦å¯¹æ¯”"><a href="#ğŸ¥¨æ—¶é—´å¤æ‚åº¦å¯¹æ¯”" class="headerlink" title="ğŸ¥¨æ—¶é—´å¤æ‚åº¦å¯¹æ¯”"></a>ğŸ¥¨æ—¶é—´å¤æ‚åº¦å¯¹æ¯”</h4><ul><li>æœ‰åºæ•°ç»„ï¼š æ’å…¥ï¼šNï¼Œåˆ é™¤ï¼š1</li><li>æ— åºæ•°ç»„ï¼š æ’å…¥ï¼š1ï¼Œåˆ é™¤ï¼šN</li><li>å †ï¼šæ’å…¥ã€åˆ é™¤ï¼šlgN</li><li>ç†æƒ³æƒ…å†µï¼šéƒ½æ˜¯1</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ºç”šä¹ˆå¼‚æˆ–èƒ½å¤Ÿç¡®å®šä¸¤ä¸ªæ•°çš„ç¬¦å·æ˜¯å¦ç›¸åŒï¼Ÿ</title>
      <link href="/2020/01/08/problems2/"/>
      <url>/2020/01/08/problems2/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">unsigned int a  = -1;</span><br><span class="line">printf(&quot;%d,%u,%x&quot;,a,a,a);</span><br></pre></td></tr></table></figure><p>-1,4294967295,ffffffff<br><br>ä»ç»“æœä¸Šæ¥è¯´,éªŒè¯äº†C++ä¸­ä½¿ç”¨çš„æ˜¯<strong>è¡¥ç </strong>ã€‚</p><h4 id="ğŸ ç°åœ¨è¯´ä¸€è¯´ä¸ºä»€ä¹ˆå¼‚æˆ–èƒ½å¤Ÿç¡®å®šä¸¤ä¸ªæ•°çš„ç¬¦å·æ˜¯å¦ç›¸åŒï¼Ÿ"><a href="#ğŸ ç°åœ¨è¯´ä¸€è¯´ä¸ºä»€ä¹ˆå¼‚æˆ–èƒ½å¤Ÿç¡®å®šä¸¤ä¸ªæ•°çš„ç¬¦å·æ˜¯å¦ç›¸åŒï¼Ÿ" class="headerlink" title="ğŸ ç°åœ¨è¯´ä¸€è¯´ä¸ºä»€ä¹ˆå¼‚æˆ–èƒ½å¤Ÿç¡®å®šä¸¤ä¸ªæ•°çš„ç¬¦å·æ˜¯å¦ç›¸åŒï¼Ÿ"></a>ğŸ ç°åœ¨è¯´ä¸€è¯´ä¸ºä»€ä¹ˆå¼‚æˆ–èƒ½å¤Ÿç¡®å®šä¸¤ä¸ªæ•°çš„ç¬¦å·æ˜¯å¦ç›¸åŒï¼Ÿ</h4><p>&emsp;&emsp;è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå‰æï¼Œä¸¤ä¸ªæ•°éƒ½æ˜¯intç±»å‹ï¼Œå› ä¸ºè¡¥ç çš„åŸå› ï¼Œå¦‚æœä¸¤ä¸ªæ•°çš„æ­£è´Ÿä¸åŒï¼Œé‚£ä¹ˆå®ƒä»¬çš„ç¬¬ä¸€ä½å°±ä¸åŒï¼Œå› ä¸ºintçš„ç¬¬ä¸€ä½æ˜¯æ­£è´Ÿçš„æ ‡å¿—ä½ã€‚<br>é€šè¿‡å¼‚æˆ–ï¼Œé‚£ä¹ˆæ­£æ•°çš„ç¬¬ä¸€ä½ä¸º0ï¼Œè´Ÿæ•°çš„ç¬¬ä¸€ä½ä¸º1ï¼Œå¼‚æˆ–åç¬¬ä¸€ä½å°±ä¸º1ï¼Œæ‰€ä»¥å¯ä»¥å¾—åˆ°è®¡ç®—å‡ºçš„å€¼ä¸ºè´Ÿå€¼ã€‚ç›¸åå¦‚æœä¸¤è€…ç¬¦å·ç›¸åŒï¼Œé‚£ä¹ˆé€šè¿‡å¼‚æˆ–åï¼Œç¬¬ä¸€ä½å°±ä¸º0ï¼Œæ‰€ä»¥ä¸ºæ­£æ•°ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> é‡è§çš„é—®é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>äºŒåˆ†æŸ¥æ‰¾</title>
      <link href="/2020/01/07/alg1/"/>
      <url>/2020/01/07/alg1/</url>
      
        <content type="html"><![CDATA[<h4 id="æ—¶é—´å¤æ‚åº¦"><a href="#æ—¶é—´å¤æ‚åº¦" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h4><p>logN</p><h4 id="äºŒåˆ†æŸ¥æ‰¾çš„å®ç°å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯é€’å½’å¼çš„ã€å¦ä¸€ç§æ˜¯å¾ªç¯å¼çš„"><a href="#äºŒåˆ†æŸ¥æ‰¾çš„å®ç°å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯é€’å½’å¼çš„ã€å¦ä¸€ç§æ˜¯å¾ªç¯å¼çš„" class="headerlink" title="äºŒåˆ†æŸ¥æ‰¾çš„å®ç°å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯é€’å½’å¼çš„ã€å¦ä¸€ç§æ˜¯å¾ªç¯å¼çš„"></a>äºŒåˆ†æŸ¥æ‰¾çš„å®ç°å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯é€’å½’å¼çš„ã€å¦ä¸€ç§æ˜¯å¾ªç¯å¼çš„</h4><p>ğŸ˜œé€’å½’å¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">int BinarySearch(vector&lt;int&gt;&amp; a,int lo,int ho, int key) &#123;</span><br><span class="line">  // if(lo &gt; ho) return -1;</span><br><span class="line">  // int mid = (lo + ho) / 2;</span><br><span class="line">  // if(a[mid] &gt; key) return BinarySearch(a, lo, mid - 1, key);</span><br><span class="line">  // else if(a[mid] &lt; key) BinarySearch(a, mid + 1, ho, key);</span><br><span class="line">  // else return mid;</span><br><span class="line">  if(lo &gt;= ho) return -1;</span><br><span class="line">  int mid = (lo + ho) / 2;</span><br><span class="line">  if(a[mid] &gt; key) return BinarySearch(a, lo, mid, key);</span><br><span class="line">  else if(a[mid] &lt; key) BinarySearch(a, mid + 1, ho, key);</span><br><span class="line">  else return mid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;<del>åŒºé—´çš„å¼€é—­è‡ªç”±é€‰å–ï¼Œä¸»è¦æ˜¯è¦<strong>ç»Ÿä¸€</strong>ï¼Œå¦‚æœè¦æ±‚ä¼ å…¥å·¦é—­å³å¼€åŒºé—´ï¼Œé‚£ä¹ˆåœ¨å‡½æ•°å†…éƒ¨çš„å¤„ç†ä¹Ÿè¦ä¿æŒå·¦é—­å³å¼€ã€‚</del><br>ä¸€èˆ¬çš„é€‰æ‹©åº”è¯¥æ—¶å·¦å³éƒ½æ˜¯é—­åŒºé—´ï¼Œè€Œåœ¨ç‰¹æ®Šæƒ…å†µæ—¶ï¼ˆæ•°ç»„ä¸­æœ‰å¤šä¸ªç›¸åŒçš„ç›®æ ‡æ—¶ï¼‰ï¼Œè¿™æ—¶é€‰æ‹©å·¦é—­å³å¼€ã€‚<br><br><br>ğŸ¥›å‚è€ƒï¼š<a href="https://en.wikipedia.org/wiki/Binary_search_algorithm" target="_blank" rel="noopener">wikié“¾æ¥</a><br><br><br>&emsp;&emsp;ä¸ºäº†é¿å…ho + lo å¤§äºINT_MAXæœ€å¥½æ”¹ç”¨lo + (ho - lo) / 2</p><p>ğŸˆ¶éé€’å½’å¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">int BinarySearch(vector&lt;int&gt;&amp; a, int key) &#123;</span><br><span class="line">  int lo = 0,</span><br><span class="line">    ho = a.size(),</span><br><span class="line">  mid;</span><br><span class="line">  while(lo &lt; ho) &#123;</span><br><span class="line">    mid = (lo + ho) / 2;</span><br><span class="line">    if(a[mid] &gt; key) ho = mid;</span><br><span class="line">    else if(a[mid] &lt; key) lo = mid + 1;</span><br><span class="line">    else return mid;</span><br><span class="line">  &#125;</span><br><span class="line">  return -1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€’å½’è¦æ»¡è¶³ä¸‰ä¸ªåŸåˆ™ï¼š</p><ol><li>é€’å½’æ€»æœ‰ä¸€ä¸ªæœ€ç®€å•çš„æƒ…å†µâ€”æ–¹æ³•çš„ç¬¬ä¸€å¥æ€»æ˜¯ä¸€ä¸ªåŒ…å«returnçš„æ¡ä»¶è¯­å¥ã€‚</li><li>é€’å½’è°ƒç”¨æ€»è¦å°è¯•å–è§£å†³ä¸€ä¸ª<strong>è§„æ¨¡æ›´å°</strong>çš„å­é—®é¢˜ã€‚</li><li>é€’å½’è°ƒç”¨çš„çˆ¶é—®é¢˜å’Œå­é—®é¢˜ä¹‹é—´ä¸åº”è¯¥æœ‰<strong>äº¤é›†</strong>ã€‚</li></ol><p>ğŸ¥˜æ¨èç›¸å…³èµ„æ–™ï¼š<a href="https://leetcode-cn.com/problems/search-insert-position/solution/te-bie-hao-yong-de-er-fen-cha-fa-fa-mo-ban-python-/" target="_blank" rel="noopener">è®²è§£</a></p><h5 id="ğŸ‘ç»ƒä¹ é¢˜ç›®1ï¼š4-å¯»æ‰¾ä¸¤ä¸ªæœ‰åºæ•°ç»„çš„ä¸­ä½æ•°"><a href="#ğŸ‘ç»ƒä¹ é¢˜ç›®1ï¼š4-å¯»æ‰¾ä¸¤ä¸ªæœ‰åºæ•°ç»„çš„ä¸­ä½æ•°" class="headerlink" title="ğŸ‘ç»ƒä¹ é¢˜ç›®1ï¼š4. å¯»æ‰¾ä¸¤ä¸ªæœ‰åºæ•°ç»„çš„ä¸­ä½æ•°"></a>ğŸ‘ç»ƒä¹ é¢˜ç›®1ï¼š<a href="https://leetcode-cn.com/problems/median-of-two-sorted-arrays/submissions/" target="_blank" rel="noopener">4. å¯»æ‰¾ä¸¤ä¸ªæœ‰åºæ•°ç»„çš„ä¸­ä½æ•°</a></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">public:</span><br><span class="line">    double findMedianSortedArrays(vector&lt;int&gt;&amp; nums1, vector&lt;int&gt;&amp; nums2) &#123;</span><br><span class="line">        //é¦–å…ˆè¦åˆ¤å®šæ‹¿ä¸ªåºåˆ—æ›´åŠ é•¿</span><br><span class="line">        if(nums1.size() &gt; nums2.size())</span><br><span class="line">            swap(nums1, nums2);</span><br><span class="line">        //å·¦é—­å³å¼€</span><br><span class="line">        int imin = 0,</span><br><span class="line">            imax = nums1.size(),</span><br><span class="line">            j, i,</span><br><span class="line">            m = nums1.size(),</span><br><span class="line">            n = nums2.size(),</span><br><span class="line">            halflen = (m + n + 1) / 2;</span><br><span class="line">        while(imin &lt;= imax) &#123;</span><br><span class="line">            i = (imax + imin ) / 2;</span><br><span class="line">            j =  halflen - i;</span><br><span class="line">            // cout &lt;&lt; i &lt;&lt; j &lt;&lt; endl;</span><br><span class="line">            if (j &lt;= n &amp;&amp; i &lt; imax &amp;&amp; nums1[i] &lt; nums2[j - 1]) &#123;</span><br><span class="line">                imin = i + 1;</span><br><span class="line">            &#125; else if (i &gt; imin &amp;&amp; j &lt; n &amp;&amp; nums2[j] &lt; nums1[i - 1]) &#123;</span><br><span class="line">                imax = i;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                // cout &lt;&lt; &quot;end&quot; &lt;&lt; endl;</span><br><span class="line">                int leftMax, rightMin;</span><br><span class="line">                if(i == 0 ) leftMax = nums2[j - 1];</span><br><span class="line">                else if(j == 0) leftMax = nums1[i - 1];</span><br><span class="line">                else leftMax = max(nums1[i - 1], nums2[j - 1]);</span><br><span class="line">                if((m + n) % 2) return leftMax;</span><br><span class="line"></span><br><span class="line">                if(i == m) rightMin = nums2[j ];</span><br><span class="line">                else if (j == n) rightMin = nums1[ i ];</span><br><span class="line">                else rightMin = min(nums1[i], nums2[j]) ;</span><br><span class="line">                // cout &lt;&lt; leftMax &lt;&lt; rightMin &lt;&lt; endl;</span><br><span class="line">                return static_cast&lt;double&gt;(leftMax + rightMin) / 2;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return -1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h5 id="ğŸ‘ç»ƒä¹ é¢˜ç›®2ï¼š35-æœç´¢æ’å…¥ä½ç½®"><a href="#ğŸ‘ç»ƒä¹ é¢˜ç›®2ï¼š35-æœç´¢æ’å…¥ä½ç½®" class="headerlink" title="ğŸ‘ç»ƒä¹ é¢˜ç›®2ï¼š35. æœç´¢æ’å…¥ä½ç½®"></a>ğŸ‘ç»ƒä¹ é¢˜ç›®2ï¼š<a href="https://leetcode-cn.com/problems/search-insert-position/" target="_blank" rel="noopener">35. æœç´¢æ’å…¥ä½ç½®</a></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">public:</span><br><span class="line">    int searchInsert(vector&lt;int&gt;&amp; nums, int target) &#123;</span><br><span class="line">        int lo = 0,</span><br><span class="line">            ho = nums.size() - 1,</span><br><span class="line">            mid;</span><br><span class="line">        while(lo &lt; ho) &#123;</span><br><span class="line">            mid = (lo + ho + 1) / 2;</span><br><span class="line">            if(nums[mid] &gt; target) &#123;</span><br><span class="line">                ho = mid - 1;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                lo = mid;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if(nums[lo] &lt; target) return lo + 1;</span><br><span class="line">        else return lo;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>libuvæºç åˆ†æï¼ˆ6ï¼‰uv_queue_work</title>
      <link href="/2019/11/26/libuv6/"/>
      <url>/2019/11/26/libuv6/</url>
      
        <content type="html"><![CDATA[<h4 id="ğŸ¤é—®é¢˜æ¥ç”±"><a href="#ğŸ¤é—®é¢˜æ¥ç”±" class="headerlink" title="ğŸ¤é—®é¢˜æ¥ç”±"></a>ğŸ¤é—®é¢˜æ¥ç”±</h4><p>&emsp;&emsp;åœ¨ä½¿ç”¨libuvçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éš¾å…é‡è§çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œæœ‰ä¸€äº›åº“æ²¡æœ‰å¼‚æ­¥ã€åªèƒ½åŒæ­¥è¿è¡Œï¼Œè¿™ç§æƒ…å†µè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿæ¯”å¦‚mysql-connector-cppã€‚</p><p>&emsp;&emsp;é¦–å…ˆè¦è¯´çš„æ˜¯ï¼Œç›´æ¥åœ¨å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œmysql-connector-cppè¿™ç§ä¼šé˜»å¡çš„æ“ä½œæ˜¯ä¸ç¬¦åˆLibuvçš„reactoræ¨¡å¼çš„ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">handle_json_lab</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">shared_ptr</span>&lt;smpHttp::HttpRequest&gt; req,<span class="built_in">std</span>::<span class="built_in">shared_ptr</span>&lt;smpHttp::HttpResponse&gt; res)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">try</span>&#123;</span><br><span class="line">    Session mq = cli.getSession();</span><br><span class="line">    <span class="keyword">auto</span> sqlres = mq.sql(<span class="string">"Select content FROM labimformation where type = 'labIntroduction'"</span>).execute();</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;<strong>ä¸Šé¢è¿™æ ·ä¾¿æ˜¯é”™è¯¯çš„æ¡ˆä¾‹</strong>ã€‚æˆ‘åœ¨å†™<a href="https://github.com/LurenAA/smpHttp" target="_blank" rel="noopener">è¿™ä¸ªé¡¹ç›®</a>æ—¶ï¼Œä¹‹å‰å°±é‡‡ç”¨äº†è¿™æ ·çš„é”™è¯¯åšæ³•ã€‚<br><br>&emsp;&emsp;æˆ‘çš„è¿™ä¸ªé¡¹ç›®æ˜¯ä¸ªhttpåå°ï¼Œæˆ‘åœ¨æ¥å—åˆ°POSTè¯·æ±‚ï¼Œç›´æ¥åœ¨å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œmysqlæ“ä½œï¼Œè¿™æ—¶<strong>æ•´ä¸ªä¸»çº¿ç¨‹å°±é˜»å¡ä½äº†<sup>1</sup></strong>ï¼Œè€Œè¿™å°±æ„å‘³ç€æˆ‘çš„httpåå°ä¸å†èƒ½æ¥å—ä»»ä½•è¯·æ±‚ï¼Œåªèƒ½ç­‰å¾…mysqlæ“ä½œå®Œæˆåï¼Œå›è°ƒå‡½æ•°è¿”å›ã€‚è€Œè¿™ä¸ªmysqlçš„æ“ä½œè€—æ—¶ä¸€èˆ¬åœ¨3sä»¥ä¸Šï¼Œè¿™å¯¹æˆ‘è¿™ä¸ªHttpåå°æ¥è¯´æ˜¯æ¯ç­æ€§çš„æ‰“å‡»ã€‚ã€‚ã€‚ã€‚</p><font size=2 color=#483D8B>1ï¼šç”¨æˆ·çš„å›è°ƒå‡½æ•°æ˜¯åœ¨work->doneå‡½æ•°çš„æœ€åæ‰§è¡Œçš„ï¼Œè€Œwork->doneæ˜¯åœ¨ä¸»çº¿ç¨‹uv_runä¸­çš„is_pollä¸­å”¤é†’loop->wq_asyncåæ‰§è¡Œçš„,åœ¨work->doneå‡½æ•°ä¸­é˜»å¡æ„å‘³ç€åœ¨ä¸»çº¿ç¨‹é˜»å¡ä½äº†ï¼Œuv_runä¸­çš„äº‹ä»¶å¾ªç¯å¡ä½ï¼Œä¸å†èƒ½æ¥å—requestï¼ˆè¿™éƒ¨åˆ†ä¸æ¸…æ¥šå¯ä»¥å»çœ‹æˆ‘çš„libuvæºç åˆ†ææ–‡ç« ï¼‰</font><h4 id="ğŸŒ†è§£å†³åŠæ³•"><a href="#ğŸŒ†è§£å†³åŠæ³•" class="headerlink" title="ğŸŒ†è§£å†³åŠæ³•"></a>ğŸŒ†è§£å†³åŠæ³•</h4><p>&emsp;&emsp;åœ¨<a href="http://docs.libuv.org/en/v1.x/threadpool.html" target="_blank" rel="noopener">æ‰‹å†ŒThread pool work scheduling</a>ä¸­ä¸ºæˆ‘ä»¬è¿™æ ·çš„éœ€æ±‚æä¾›äº†è¿™æ ·ä¸€ä¸ªå‡½æ•°ï¼š<br><strong>uv_queue_work(uv_loop_t* loop, uv_work_t* req, uv_work_cb work_cb, uv_after_work_cb after_work_cb)</strong>ã€‚<br></p><p>&emsp;&emsp;è¿™ä¸ªå‡½æ•°å°±æ˜¯ä¸Šé¢æˆ‘ä»¬é—®é¢˜çš„è§£å†³åŠæ³•ã€‚ä½†æ˜¯è¦æ³¨æ„çš„æ˜¯uv_async_tä¸å¯ä»¥æ›¿ä»£è¿™ä¸ªã€‚è™½ç„¶éƒ½æ˜¯æ‰§è¡Œç”¨æˆ·çš„å‡½æ•°ã€‚asyncæ˜¯è®©ç”¨æˆ·å‡½æ•°ç›´æ¥è¢«<strong>ä¸»çº¿ç¨‹</strong>åœ¨uv_runä¸­è¿è¡Œï¼Œè€Œuv_queue_workæ˜¯å°†work_cbæäº¤ç»™<strong>å­çº¿ç¨‹</strong>æ‰§è¡Œï¼Œå®Œæˆåé€šçŸ¥ä¸»çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹åœ¨uv_runä¸­æ‰§è¡Œafter_work_cbã€‚</p><p>&emsp;&emsp;æ€»ç»“ä¸‹æ¥å°±æ˜¯ï¼šuv_async_tç”¨æ¥æ‰§è¡Œä¸é˜»å¡çš„ä»»åŠ¡ï¼Œuv_queue_workæ‰§è¡Œè¦é˜»å¡çš„ä»»åŠ¡ï¼ˆè€ƒè™‘åˆ°çº¿ç¨‹åˆ‡æ¢çš„æ¶ˆè€—ä¸€èˆ¬ä¸ç”¨æ¥æ‰§è¡Œä¸é˜»å¡çš„ä»»åŠ¡ï¼‰</p><h4 id="ğŸ‰çœ‹çœ‹æºç "><a href="#ğŸ‰çœ‹çœ‹æºç " class="headerlink" title="ğŸ‰çœ‹çœ‹æºç "></a>ğŸ‰çœ‹çœ‹æºç </h4><p>&emsp;&emsp;è¿™ä¸€éƒ¨åˆ†å¯ä»¥ç»“åˆè¿™<a href="https://lurenaa.github.io/2019/11/26/libuv5/" target="_blank" rel="noopener">æˆ‘çš„è¿™ç¯‡æ–‡ç« -libuvæºç åˆ†æï¼ˆ5ï¼‰uv_fs_*</a>æ¥çœ‹ã€‚å¯ä»¥ä½œä¸ºä½è¯ï¼Œlibuvä¸­å¯¹ç€è¿™ç±»æ²¡æœ‰è‡ªå¸¦å¼‚æ­¥ç‰ˆæœ¬çš„é˜»å¡æ“ä½œçš„å¤„ç†æ˜¯ä¸€æ ·çš„ï¼šè®©å­çº¿ç¨‹å»æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹çš„äº‹ä»¶å¾ªç¯ï¼Œå®Œæˆåå­çº¿ç¨‹é€šçŸ¥ä¸»çº¿ç¨‹ã€‚<br><br><br>uv_queue_workæºç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">uv_queue_work</span><span class="params">(<span class="keyword">uv_loop_t</span>* loop,</span></span></span><br><span class="line"><span class="function"><span class="params">                  <span class="keyword">uv_work_t</span>* req,</span></span></span><br><span class="line"><span class="function"><span class="params">                  uv_work_cb work_cb,</span></span></span><br><span class="line"><span class="function"><span class="params">                  uv_after_work_cb after_work_cb)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (work_cb == <span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> UV_EINVAL;</span><br><span class="line"></span><br><span class="line">  uv__req_init(loop, req, UV_WORK);</span><br><span class="line">  req-&gt;loop = loop;</span><br><span class="line">  req-&gt;work_cb = work_cb;</span><br><span class="line">  req-&gt;after_work_cb = after_work_cb;</span><br><span class="line">  uv__work_submit(loop,</span><br><span class="line">                  &amp;req-&gt;work_req,</span><br><span class="line">                  UV__WORK_CPU,</span><br><span class="line">                  uv__queue_work,</span><br><span class="line">                  uv__queue_done);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†ç»“åˆ<a href="https://lurenaa.github.io/2019/11/26/libuv5/" target="_blank" rel="noopener">æˆ‘çš„è¿™ç¯‡æ–‡ç« -libuvæºç åˆ†æï¼ˆ5ï¼‰uv_fs_*</a>ä¸­uv_fs_*å‡½æ•°çš„æºç ï¼Œè¿™äº›æ“ä½œå¯ä»¥æ€»ç»“æˆä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">UV_REQ_INIT(req, typ);          <span class="comment">//åˆå§‹åŒ–åŸºç±»uv_req_t                               </span></span><br><span class="line">uv__req_register(loop, req);   <span class="comment">//æ·»åŠ loopä¸­requestçš„è®¡æ•°ï¼Œé¿å…uv_runä¸­uv__loop_aliveè¿”å›0ï¼Œä½¿å¾—ä¸»çº¿ç¨‹uv_runé€€å‡º</span></span><br><span class="line">...<span class="comment">//è¿™é‡Œæ˜¯é’ˆå¯¹ä¸åŒç±»å‹çš„æ“ä½œç‰¹æœ‰çš„åˆå§‹åŒ–éƒ¨åˆ†</span></span><br><span class="line">uv__work_submit(loop,</span><br><span class="line">                &amp;req-&gt;work_req,</span><br><span class="line">                UV__WORK_CPU, <span class="comment">//æ“ä½œç±»å‹</span></span><br><span class="line">                uv__queue_work, <span class="comment">//è¦é˜»å¡çš„æ“ä½œï¼Œåœ¨fsä¸­æ˜¯uv__fs_work</span></span><br><span class="line">                uv__queue_done); <span class="comment">//å®Œæˆåçš„å›è°ƒï¼Œåœ¨fsä¸­æ˜¯uv__fs_done</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> libuv </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>libuvæºç åˆ†æï¼ˆ5ï¼‰uv_fs_*</title>
      <link href="/2019/11/26/libuv5/"/>
      <url>/2019/11/26/libuv5/</url>
      
        <content type="html"><![CDATA[<h4 id="uv-fs"><a href="#uv-fs" class="headerlink" title="uv_fs_*"></a>uv_fs_*</h4><p>&emsp;&emsp;uv_fs_*è¿™ä¸€ç³»åˆ—çš„å‡½æ•°åŸºæœ¬æ˜¯ä¸€è‡´çš„ï¼Œå®ƒä»¬çš„é€»è¾‘å¤§æ¦‚æ˜¯å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//xä»£è¡¨ä¸€ç§æ“ä½œopenã€writeç­‰</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">uv_fs_x</span><span class="params">(...<span class="keyword">uv_fs_t</span>* req...)</span> </span>&#123;</span><br><span class="line">  INIT(x); <span class="comment">//uv_fs_tå’Œå…¶åŸºç±»uv_req_tçš„åŸºæœ¬åˆå§‹åŒ–</span></span><br><span class="line">  ... <span class="comment">//è¿™é‡Œæ˜¯æ¯ä¸ªæ“ä½œå„è‡ªä¸åŒå¯¹äºreqçš„åˆå§‹åŒ–</span></span><br><span class="line">  POST; <span class="comment">//æäº¤è¿™ä¸ªä»»åŠ¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="INIT"><a href="#INIT" class="headerlink" title="INIT"></a>INIT</h4><p>&emsp;&emsp;INITè¿™ä¸ªå®å®šä¹‰å‡½æ•°æ²¡æœ‰ç‰¹åˆ«çš„åœ°æ–¹ï¼Œå°±æ˜¯æŠŠreqåˆå§‹åŒ–ï¼Œè¯¥ç½®0çš„ç½®0ã€‚</p><h4 id="POST"><a href="#POST" class="headerlink" title="POST"></a>POST</h4><p>&emsp;&emsp;å…¶å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> POST                          </span></span><br><span class="line">  <span class="keyword">do</span> &#123;   <span class="comment">//dowhileåŒ…è£¹ä½œç”¨åŸŸ          </span></span><br><span class="line">    <span class="keyword">if</span> (cb != <span class="literal">NULL</span>) &#123;                 </span><br><span class="line">      uv__req_register(loop, req);    </span><br><span class="line">      uv__work_submit(loop,           </span><br><span class="line">      &amp;req-&gt;work_req,                 </span><br><span class="line">      UV__WORK_FAST_IO,               </span><br><span class="line">      uv__fs_work,                    </span><br><span class="line">      uv__fs_done);                   </span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;                       </span><br><span class="line">    &#125;                                 </span><br><span class="line">    <span class="keyword">else</span> &#123;                            </span><br><span class="line">      uv__fs_work(&amp;req-&gt;work_req);    </span><br><span class="line">      <span class="keyword">return</span> req-&gt;result;             </span><br><span class="line">    &#125;                                 </span><br><span class="line">  &#125;                                   </span><br><span class="line">  <span class="keyword">while</span> (<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;è¿™é‡Œé€šè¿‡æœ‰æ— å›è°ƒå‡½æ•°æ¥å†³å®šè°ƒç”¨åŒæ­¥ç‰ˆæœ¬è¿˜æ˜¯å¼‚æ­¥ç‰ˆæœ¬ã€‚</p><blockquote><p><a href="http://docs.libuv.org/en/v1.x/fs.html" target="_blank" rel="noopener">http://docs.libuv.org/en/v1.x/fs.html</a><br>libuv provides a wide variety of cross-platform sync and async file system operations. All functions defined in this document take a callback, which is allowed to be NULL. If the callback is NULL the request is completed synchronously, otherwise it will be performed asynchronously.</p></blockquote><p>&emsp;&emsp;uv__fs_workè¿™ä¸ªå‡½æ•°å°±æ˜¯<strong>æ–‡ä»¶æ“ä½œçš„å°è£…</strong>ï¼Œæ‰€æœ‰çš„æ–‡ä»¶æ“ä½œéƒ½é€šè¿‡è¿™ä¸ªå‡½æ•°æ¥å®Œæˆï¼Œå³ä½¿æ˜¯å¼‚æ­¥ï¼Œæœ€ç»ˆä¹Ÿè¦åœ¨åˆ«çš„çº¿ç¨‹ä¸­åŒæ­¥æ‰§è¡Œè¿™ä¸ªå‡½æ•°ã€‚ <br><br>&emsp;&emsp;uv__fs_doneè¿™ä¸ªå‡½æ•°ä¼šè°ƒç”¨ç”¨æˆ·ç»™çš„å›è°ƒå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šåœ¨uv_runä¸­çš„is_pollå‡½æ•°ä¸­å¾—åˆ°æ‰§è¡Œã€‚</p><p>&emsp;&emsp;uv__work_submitå‡½æ•°çš„å®ç°æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">uv__work_submit</span><span class="params">(<span class="keyword">uv_loop_t</span>* loop,struct uv__work* w,</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="keyword">enum</span> uv__work_kind kind, <span class="keyword">void</span> (*work)(struct uv__work* w),</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="keyword">void</span> (*done)(struct uv__work* w, <span class="keyword">int</span> status))</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  uv_once(&amp;once, init_once);</span><br><span class="line">  w-&gt;loop = loop;</span><br><span class="line">  w-&gt;work = work;</span><br><span class="line">  w-&gt;done = done;</span><br><span class="line">  post(&amp;w-&gt;wq, kind);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;uv_once(&amp;once, init_once);æ˜¯åˆå§‹åŒ–å¤šä¸ªçº¿ç¨‹ï¼Œæˆ‘åœ¨<a href="https://lurenaa.github.io/2019/11/18/libuv3/" target="_blank" rel="noopener">æˆ‘çš„ç¬¬ä¸‰ç¯‡æ–‡ç« </a>ä¸­æœ‰ä»‹ç»ã€‚ä¸è¿‡å½“æ—¶å¯¹äºå­çº¿ç¨‹è¿è¡Œçš„workerå‡½æ•°æ²¡æœ‰æåŠï¼Œworkå‡½æ•°å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">worker</span><span class="params">(<span class="keyword">void</span>* arg)</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  uv_mutex_lock(&amp;mutex);</span><br><span class="line">  <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">    <span class="keyword">while</span> (QUEUE_EMPTY(&amp;wq)...) &#123;</span><br><span class="line">      idle_threads += <span class="number">1</span>;</span><br><span class="line">      uv_cond_wait(&amp;cond, &amp;mutex);</span><br><span class="line">      idle_threads -= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    q = QUEUE_HEAD(&amp;wq);</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    QUEUE_REMOVE(q);</span><br><span class="line">    QUEUE_INIT(q);  </span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    w = QUEUE_DATA(q, struct uv__work, wq);</span><br><span class="line">    w-&gt;work(w);</span><br><span class="line"></span><br><span class="line">    uv_mutex_lock(&amp;w-&gt;loop-&gt;wq_mutex);</span><br><span class="line">    w-&gt;work = <span class="literal">NULL</span>;  </span><br><span class="line">    QUEUE_INSERT_TAIL(&amp;w-&gt;loop-&gt;wq, &amp;w-&gt;wq);</span><br><span class="line">    uv_async_send(&amp;w-&gt;loop-&gt;wq_async);</span><br><span class="line">    uv_mutex_unlock(&amp;w-&gt;loop-&gt;wq_mutex);</span><br><span class="line"></span><br><span class="line">    uv_mutex_lock(&amp;mutex);</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;æˆ‘å»æ‰äº†å¯¹äºslow_ioçš„å¤„ç†ï¼Œå¤§è‡´æ˜¯è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹ã€‚</p><p>&emsp;&emsp;ä¸€å¼€å§‹çº¿ç¨‹ä¼šå¡åœ¨uv_cond_waitè¿™é‡Œï¼Œç›´åˆ°è¢«uv_cond_signalå”¤é†’ï¼Œå¦‚æœå”¤é†’æ—¶wqé˜Ÿåˆ—ä¸­æœ‰ä»»åŠ¡ï¼Œå®ƒå°±ä¼šæ‰§è¡Œä»»åŠ¡ï¼Œw-&gt;work(w)ä¹Ÿå°±æ˜¯è°ƒç”¨uv__fs_workã€‚ç„¶åæŠŠwæ”¾å…¥loop-&gt;wqï¼ˆä¸ºäº†uv__fs_doneçš„æ‰§è¡Œï¼‰ã€‚</p><p>&emsp;&emsp;uv_async_sendè°ƒç”¨è®©loop-&gt;wq_asyncå¯è¯»ï¼Œä¸»çº¿ç¨‹å°±ä»uv_runä¸­çš„uv__io_pollçš„epoll_pwaitä¸­é†’æ¥ï¼Œwq_asyncçš„å›è°ƒå‡½æ•°ä¼šéå†loop-&gt;wqæ‰§è¡Œw-&gt;doneã€‚ï¼ˆ<a href="https://lurenaa.github.io/2019/11/25/libuv4/" target="_blank" rel="noopener">æˆ‘çš„ç¬¬å››ç¯‡æ–‡ç« </a>æœ‰è®²è¿™ä¸€éƒ¨åˆ†çš„è¯¦ç»†å†…å®¹ï¼‰</p><h4 id="è°æ¥è§¦å‘uv-cond-signalå”¤é†’å­çº¿ç¨‹å‘¢ï¼Ÿ"><a href="#è°æ¥è§¦å‘uv-cond-signalå”¤é†’å­çº¿ç¨‹å‘¢ï¼Ÿ" class="headerlink" title="è°æ¥è§¦å‘uv_cond_signalå”¤é†’å­çº¿ç¨‹å‘¢ï¼Ÿ"></a>è°æ¥è§¦å‘uv_cond_signalå”¤é†’å­çº¿ç¨‹å‘¢ï¼Ÿ</h4><p>ğŸ¥£uv__work_submitä¸­çš„postå‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">uv_mutex_lock(&amp;mutex);</span><br><span class="line">...</span><br><span class="line">QUEUE_INSERT_TAIL(&amp;wq, q);</span><br><span class="line"><span class="keyword">if</span> (idle_threads &gt; <span class="number">0</span>)</span><br><span class="line">  uv_cond_signal(&amp;cond);</span><br><span class="line">uv_mutex_unlock(&amp;mutex);</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;æˆ‘å†æ¬¡çœç•¥äº†slow_ioçš„éƒ¨åˆ†ï¼Œå› ä¸ºå®ƒä»¬åªæ˜¯ç‰¹æ®Šå¤„ç†ã€‚</p><p>&emsp;&emsp;è¯¥å‡½æ•°æœ‰ç©ºé—²çš„çº¿ç¨‹å°±å”¤é†’ï¼Œä¸ç„¶å°±é˜»å¡è¯¥çº¿ç¨‹ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> libuv </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>libuvæºç åˆ†æï¼ˆ4ï¼‰async</title>
      <link href="/2019/11/25/libuv4/"/>
      <url>/2019/11/25/libuv4/</url>
      
        <content type="html"><![CDATA[<h4 id="uv-async-init"><a href="#uv-async-init" class="headerlink" title="uv_async_init"></a>uv_async_init</h4><p>&emsp;&emsp;libuvä¸­asyncçš„å¼€ç«¯åœ¨uv_loop_initå‡½æ•°ä¸­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‰é¢çœç•¥</span></span><br><span class="line">err = uv_async_init(loop, &amp;loop-&gt;wq_async, uv__work_done);</span><br><span class="line"><span class="keyword">if</span> (err)</span><br><span class="line">  <span class="keyword">goto</span> fail_async_init;</span><br><span class="line"></span><br><span class="line">uv__handle_unref(&amp;loop-&gt;wq_async);</span><br><span class="line">loop-&gt;wq_async.flags |= UV_HANDLE_INTERNAL;</span><br><span class="line"><span class="comment">//åé¢çœç•¥</span></span><br></pre></td></tr></table></figure><p>&emsp;&emsp;loop-&gt;wq_asyncæ˜¯ä¸ªuv_async_tç±»å‹ï¼Œå®ƒç”¨äºçº¿ç¨‹workå‡½æ•°è°ƒç”¨æœ€åå¤„ç†loop-&gt;wqä¸­çš„å›è°ƒï¼Œæš‚æ—¶ä¸ç”¨ç®¡,æˆ‘åœ¨<a href="https://lurenaa.github.io/2019/11/26/libuv5/" target="_blank" rel="noopener">æˆ‘çš„ç¬¬äº”ç¯‡æ–‡ç« </a>ä¼šè®²åˆ°å®ƒçš„ç”¨é€”ã€‚<br/><br>&emsp;&emsp;æˆ‘ä»¬æ¥çœ‹uv_async_initå†…éƒ¨ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> err;</span><br><span class="line">err = uv__async_start(loop);</span><br><span class="line"><span class="keyword">if</span> (err)</span><br><span class="line">  <span class="keyword">return</span> err;</span><br><span class="line"></span><br><span class="line">uv__handle_init(loop, (<span class="keyword">uv_handle_t</span>*)handle, UV_ASYNC);</span><br><span class="line">handle-&gt;async_cb = async_cb;</span><br><span class="line">handle-&gt;pending = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">QUEUE_INSERT_TAIL(&amp;loop-&gt;async_handles, &amp;handle-&gt;<span class="built_in">queue</span>);</span><br><span class="line">uv__handle_start(handle);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;ç¬¬äº”è¡Œä»¥åçš„æ“ä½œå°±æ˜¯åˆå§‹åŒ–åŸºç±»uv_handle_tä»¥åŠå­ç±»uv_async_tï¼Œç„¶åå°†è¿™ä¸ªhandleæ”¾å…¥loop-&gt;queue(æ”¾uv_handle_tçš„é˜Ÿåˆ—)ä»¥åŠæ”¾å…¥loop-&gt;async_handlesï¼ˆæ”¾uv_async_tçš„é˜Ÿåˆ—ï¼‰ä¸­ï¼Œç„¶åuv__handle_startä¸­å°†loop-&gt;active_handlesåŠ ä¸€ã€‚<br/><br>&emsp;&emsp;æ€»è€Œè¨€ä¹‹ï¼Œç¬¬äº”è¡Œä»¥åçš„å†…å®¹å°±æ˜¯åˆå§‹åŒ–uv_async_tï¼Œå¯ä»¥ç†è§£æˆ<strong>uv_async_tçš„æ„é€ å‡½æ•°</strong>ã€‚<br/><br>&emsp;&emsp;uv__async_startåˆ™ä¸ä¸€æ ·ï¼Œå®ƒæ˜¯åˆå§‹åŒ–å‡½æ•°ï¼Œå®ƒ<strong>åªä¼šè°ƒç”¨ä¸€æ¬¡</strong>ï¼ˆä¸€èˆ¬æƒ…å†µæ˜¯åœ¨uv_loop_initä¸­è°ƒç”¨ï¼‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸‹å®ƒçš„å®ç°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">uv__async_start</span><span class="params">(<span class="keyword">uv_loop_t</span>* loop)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> pipefd[<span class="number">2</span>];</span><br><span class="line">  <span class="keyword">int</span> err;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (loop-&gt;async_io_watcher.fd != <span class="number">-1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  err = uv__async_eventfd();</span><br><span class="line">  <span class="keyword">if</span> (err &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">    pipefd[<span class="number">0</span>] = err;</span><br><span class="line">    pipefd[<span class="number">1</span>] = <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//ä¸­é—´çœç•¥</span></span><br><span class="line"></span><br><span class="line">  uv__io_init(&amp;loop-&gt;async_io_watcher, uv__async_io, pipefd[<span class="number">0</span>]);</span><br><span class="line">  uv__io_start(loop, &amp;loop-&gt;async_io_watcher, POLLIN);</span><br><span class="line">  loop-&gt;async_wfd = pipefd[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;çœ‹ç¬¬ä¸‰è¡Œloop-&gt;async_io_watcher.fdï¼Œå½“ä½ è°ƒç”¨è¿‡ä¸€æ¬¡è¿™ä¸ªå‡½æ•°åï¼Œloop-&gt;async_io_watcher.fdä¸ä¼šç­‰äº-1ï¼Œä»¥åä½ åˆå§‹åŒ–uv_async_tç±»å‹å˜é‡ï¼Œè°ƒç”¨uv_async_initå‡½æ•°æ—¶ï¼Œuv__async_startéƒ½æ˜¯ç›´æ¥è¿”å›çš„ã€‚<br><br>&emsp;&emsp;æˆ‘çœç•¥æ‰äº†ä¸­é—´å¦‚æœeventfdæ²¡æœ‰åœ¨å½“å‰ç³»ç»Ÿä¸‹å®ç°æ—¶çš„å…¼å®¹æ€§å¤„ç†ã€‚æ€»çš„æ¥è¯´ï¼Œå°±æ˜¯<strong>åˆå§‹åŒ–loop-&gt;async_io_watcher</strong>ã€‚uv__io_tæ˜¯ä¸ºepollè®¾è®¡çš„ç»“æ„ä½“ã€‚<del>è¿™é‡Œä½ è‚¯å®šæ„Ÿè§‰å¾ˆæ‡µé€¼ï¼Œè¯·åšæŒä¸€ä¸‹ï¼Œæœ€åæˆ‘ä¼šæ¢³ç†ä¸€ä¸‹æ€»ä½“çš„æ•´ä¸ªè¿‡ç¨‹ã€‚</del><br><br>&emsp;&emsp;uv__io_tçš„å®ç°æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">uv__io_t</span>&#123;</span><br><span class="line">  uv__io_cb cb;  <span class="comment">//å›è°ƒå‡½æ•° </span></span><br><span class="line">  <span class="keyword">void</span>* watcher_queue[<span class="number">2</span>]; <span class="comment">//æ”¾å…¥loop-&gt;watcher_queue</span></span><br><span class="line">  <span class="keyword">void</span>* pending_queue[<span class="number">2</span>]; <span class="comment">//åŒç†</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> pevents; <span class="comment">/* Pending event mask i.e. mask at next tick. */</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> events;  <span class="comment">/* Current event mask. */</span></span><br><span class="line">  <span class="keyword">int</span> fd;  <span class="comment">//æ–‡ä»¶æè¿°ç¬¦ï¼Œç”¨äºepollæ³¨å†Œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;è¿™é‡Œuv__io_initå‡½æ•°æ˜¯åˆå§‹åŒ–loop-&gt;async_io_watcherè¿™ä¸ªç»“æ„ä½“ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">QUEUE_INIT(&amp;w-&gt;pending_queue);</span><br><span class="line">QUEUE_INIT(&amp;w-&gt;watcher_queue);</span><br><span class="line">w-&gt;cb = cb;</span><br><span class="line">w-&gt;fd = fd; <span class="comment">//å‰é¢æˆ‘ä»¬çš„eventfd</span></span><br><span class="line">w-&gt;events = <span class="number">0</span>;</span><br><span class="line">w-&gt;pevents = <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;uv__io_startå°†loop-&gt;async_io_watcheræ”¾å…¥loop-&gt;watcher_queueã€‚è¿˜æœ‰å¯¹äºloop-&gt;nfdså¤§å°çš„å¤„ç†ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (QUEUE_EMPTY(&amp;w-&gt;watcher_queue))</span><br><span class="line">  QUEUE_INSERT_TAIL(&amp;loop-&gt;watcher_queue, &amp;w-&gt;watcher_queue);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (loop-&gt;watchers[w-&gt;fd] == <span class="literal">NULL</span>) &#123;</span><br><span class="line">  loop-&gt;watchers[w-&gt;fd] = w;</span><br><span class="line">  loop-&gt;nfds++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;ç¬¬å››è¡Œä»¥åçš„æ“ä½œæ˜¯ä¸ºäº†åœ¨epollåï¼Œæˆ‘ä»¬å¾—åˆ°struct eventç»“æ„ä½“ï¼Œæˆ‘ä»¬ä»event-&gt;data.fdå¯ä»¥å¾—åˆ°fdï¼Œé‚£<strong>æˆ‘ä»¬å¦‚ä½•è·å–åˆ°å¯¹åº”çš„uv__io_tå‘¢ï¼Ÿ</strong> å°±æ˜¯é€šè¿‡loop-&gt;watchersè¿™ä¸ªæ•°ç»„ã€‚</p><h4 id="uv-async-send"><a href="#uv-async-send" class="headerlink" title="uv_async_send"></a>uv_async_send</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">uv_async_send</span><span class="params">(<span class="keyword">uv_async_t</span>* handle)</span> </span>&#123;</span><br><span class="line">  <span class="comment">/* Do a cheap read first. */</span></span><br><span class="line">  <span class="keyword">if</span> (ACCESS_ONCE(<span class="keyword">int</span>, handle-&gt;pending) != <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Tell the other thread we're busy with the handle. */</span></span><br><span class="line">  <span class="keyword">if</span> (cmpxchgi(&amp;handle-&gt;pending, <span class="number">0</span>, <span class="number">1</span>) != <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Wake up the other thread's event loop. */</span></span><br><span class="line">  uv__async_send(handle-&gt;loop);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Tell the other thread we're done. */</span></span><br><span class="line">  <span class="keyword">if</span> (cmpxchgi(&amp;handle-&gt;pending, <span class="number">1</span>, <span class="number">2</span>) != <span class="number">1</span>)</span><br><span class="line">    <span class="built_in">abort</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;ACCESS_ONCEï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ACCESS_ONCE(type, var)  \</span></span><br><span class="line">  (*(<span class="keyword">volatile</span> type*) &amp;(var))</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;è¿™é‡Œè°ƒç”¨ä¸€æ¬¡ACCESS_ONCEï¼Œæ˜¯ä¸ºäº†å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œhandle-&gt;pendingå¯èƒ½è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹ï¼Œæ‰€ä»¥åˆ«ç»™æˆ‘ä¹±ä¼˜åŒ–ã€‚<br><br>&emsp;&emsp;cmpxchgiæ˜¯åŸå­æ“ä½œcompare_and_changeã€‚pendingçš„æœ‰ä¸‰ä¸ªå–å€¼0ï¼Œ1ï¼Œ2ã€‚0ä»£è¡¨é—²ç½®ã€1ä»£è¡¨å¿™ï¼ˆæ¯”å¦‚uv_async_sendè°ƒç”¨é€”ä¸­ï¼‰ã€2ä»£è¡¨å®Œæˆã€‚loop-&gt;async_io_watcherè°ƒç”¨uv__async_ioæ—¶ï¼Œä¼šéå†loop-&gt;async_handlesï¼Œé€šè¿‡pendingæ¥åˆ¤æ–­å“ªäº›å›è°ƒè¯¥è¢«æ‰§è¡Œã€‚<br><br>&emsp;&emsp;uv__async_sendå°±æ˜¯å‘loop-&gt;async_io_watcher.fdï¼ˆeventfdï¼‰å†™ï¼ˆè¿™é‡Œå…³ç³»åˆ°eventfdçš„æœºåˆ¶ï¼Œä¸æ‡‚å¯ä»¥man eventfdï¼‰ã€‚</p><h4 id="æ•´ä½“è°ƒç”¨è¿‡ç¨‹"><a href="#æ•´ä½“è°ƒç”¨è¿‡ç¨‹" class="headerlink" title="æ•´ä½“è°ƒç”¨è¿‡ç¨‹"></a>æ•´ä½“è°ƒç”¨è¿‡ç¨‹</h4><p>&emsp;&emsp;è¿™é‡Œæ€»ä½“å½’çº³ä¸€ä¸‹asyncçš„è¿‡ç¨‹ã€‚<br><br>&emsp;&emsp;1.åœ¨loop_uv_initä¸­åˆå§‹åŒ–async_io_watcherï¼Œå®ƒçš„fdä¸ºeventfdï¼Œå€¼ä¸º0ï¼Œä¸å¯è¯»ã€‚<br><br>&emsp;&emsp;2.ç”¨æˆ·uv_async_initæ³¨å†Œuv_async_tå˜é‡ï¼Œè¢«æ·»åŠ åˆ°loop-&gt;async_handlesï¼Œè®¾ç½®å›è°ƒå‡½æ•°ã€‚<br><br>&emsp;&emsp;3.å¦‚æœå¯¹uv_async_tå˜é‡è°ƒç”¨uv_async_sendï¼Œé‚£ä¹ˆuv_async_tå˜é‡çš„pendingå˜ä¸º2ï¼ˆdoneï¼‰ï¼Œå¹¶ä¸”å‘eventfdå†™ï¼Œloop-&gt;async_io_watcherå¯è¯»äº†ã€‚<br><br>&emsp;&emsp;4.åœ¨uv_runçš„uv__io_pollä¸­ï¼Œæ¯æ¬¡éƒ½ä¼šæŠŠloop-&gt;watchersæ³¨å†Œåˆ°epollä¸­ï¼Œ<strong>ç¬¬å››æ­¥è¿™ä¸ªè¿‡ç¨‹åœ¨æ¯æ¬¡äº‹ä»¶å¾ªç¯ä¸­éƒ½åœ¨æ‰§è¡Œ</strong>ã€‚å¦‚æœasync_io_watcherçš„fdä¸å¯è¯»ï¼Œå°±æ²¡å®ƒäº‹å„¿ã€‚å¦‚æœå¯è¯»ï¼Œasync_io_watcherçš„å›è°ƒå‡½æ•°uv__async_ioæ‰§è¡Œï¼Œå®ƒéå†loop-&gt;async_handlesï¼Œå°†å…¶ä¸­pendingä¸º2çš„uv_async_tå˜é‡ç§»é™¤é˜Ÿåˆ—ï¼Œå¹¶æ‰§è¡Œå…¶å›è°ƒå‡½æ•°ã€‚</p><h4 id="çœ‹æºç åå†™çš„å°DEMOï¼š-https-github-com-LurenAA-simple-imitation-of-libuv"><a href="#çœ‹æºç åå†™çš„å°DEMOï¼š-https-github-com-LurenAA-simple-imitation-of-libuv" class="headerlink" title="çœ‹æºç åå†™çš„å°DEMOï¼š https://github.com/LurenAA/simple_imitation_of_libuv"></a>çœ‹æºç åå†™çš„å°DEMOï¼š <a href="https://github.com/LurenAA/simple_imitation_of_libuv" target="_blank" rel="noopener">https://github.com/LurenAA/simple_imitation_of_libuv</a></h4>]]></content>
      
      
      
        <tags>
            
            <tag> libuv </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ssh: connect to host github.com port 22: Connection refused</title>
      <link href="/2019/11/24/problems1/"/>
      <url>/2019/11/24/problems1/</url>
      
        <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> </span><br><span class="line">vim .ssh/config</span><br></pre></td></tr></table></figure><p>ä½ ä¼šå‘ç°è¿™æ˜¯ä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­æ·»åŠ ä»¥ä¸‹æ–‡å­—ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Host github.com</span><br><span class="line">User ä½ çš„ç”¨æˆ·åï¼ˆä¾‹å¦‚97860xx@qq.comï¼‰</span><br><span class="line">Hostname ssh.github.com</span><br><span class="line">PreferredAuthentications publickey</span><br><span class="line">IdentityFile ~/.ssh/id_rsa</span><br><span class="line">Port 443</span><br></pre></td></tr></table></figure><p>ç„¶åä¿å­˜é€€å‡ºï¼ˆä»£ç å¦‚ä¸‹ï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:wq</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æµ‹è¯•ä¸€ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure><p>å‡ºç°ä¸‹é¢çš„ç”»é¢ï¼š<br><img src="../assets/ssh-connect.PNG" alt=""><br>åœ¨å›¾ç‰‡å€’æ•°ç¬¬äº”è¡Œçš„åœ°æ–¹ä¼šè¯¢é—®æ˜¯å¦å»ºç«‹è¿æ¥ï¼Œè¾“å…¥yeså³å¯ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> é‡è§çš„é—®é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>libuvæºç åˆ†æï¼ˆ3ï¼‰init_threads</title>
      <link href="/2019/11/18/libuv3/"/>
      <url>/2019/11/18/libuv3/</url>
      
        <content type="html"><![CDATA[<h4 id="ç”±æ¥"><a href="#ç”±æ¥" class="headerlink" title="ç”±æ¥"></a>ç”±æ¥</h4><p>&emsp;&emsp;åœ¨æˆ‘ä»¬ç¬¬ä¸€æ¬¡æäº¤ioæ“ä½œæ—¶ï¼Œä¼šæœ‰uv_onceè¢«è°ƒç”¨ï¼Œæ¥æ£€æµ‹æ˜¯å¦åˆå§‹åŒ–è¿‡çº¿ç¨‹æ± ï¼Œå¦‚æœæ²¡æœ‰åˆ™ç«‹åˆ»<strong>åˆå§‹åŒ–çº¿ç¨‹æ± </strong>ã€‚æ‰€ä»¥è¯´çº¿ç¨‹æ± å¹¶éä¸€å¼€å§‹åœ¨uv_runçš„æ—¶å€™æˆ–è€…åœ¨loopä¸­åˆå§‹åŒ–çš„ï¼Œè€Œæ˜¯åœ¨ioæ“ä½œå¼€å§‹å‰ã€‚<br><strong>æˆ‘ä»¥uv_openä¸ºä¾‹å­ç”»ä¸€ä¸‹UMLå›¾å¦‚ä¸‹ï¼š</strong><br><img src="https://img-blog.csdnimg.cn/20191118023241696.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMDE1MDQ4,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åœ¨uv_openä¸­å…ˆåˆå§‹åŒ–reqï¼Œç„¶åå‡†å¤‡æäº¤workï¼Œæäº¤å‰ä¼šè°ƒç”¨uv_onceæ£€æµ‹æ˜¯å¦åˆå§‹åŒ–çº¿ç¨‹æ± ï¼Œæ²¡æœ‰åˆ™åˆå§‹åŒ–ã€‚</p><h4 id="init-once"><a href="#init-once" class="headerlink" title="init_once"></a>init_once</h4><p>uv_onceå®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> UV_ONCE_INIT PTHREAD_ONCE_INIT</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">uv_once_t</span> once = UV_ONCE_INIT;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">init_once</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _WIN32</span></span><br><span class="line">  <span class="comment">/* Re-initialize the threadpool after fork.</span></span><br><span class="line"><span class="comment">   * Note that this discards the global mutex and condition as well</span></span><br><span class="line"><span class="comment">   * as the work queue.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">if</span> (pthread_atfork(<span class="literal">NULL</span>, <span class="literal">NULL</span>, &amp;reset_once))</span><br><span class="line">    <span class="built_in">abort</span>();</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">  init_threads();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨uv__work_submitä¸­uv_onceæ˜¯è¿™æ ·è¢«è°ƒç”¨çš„ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">uv__work_submit</span><span class="params">(...)</span> </span>&#123;</span><br><span class="line">  uv_once(&amp;once, init_once);</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;è¿™ä¸€éƒ¨åˆ†å¯ä»¥å‚çœ‹TLPI 31.2éƒ¨åˆ†ï¼Œlibuvå¤šåšäº†pthread_atforkçš„å¤„ç†ã€‚<br>&emsp;&emsp;pthread_atforkæ³¨å†Œreset_onceå‡½æ•°ï¼Œåœ¨forkä¹‹åé‡ç½®onceï¼Œä¿è¯åœ¨libuvå¾ªç¯ä¸­å¦‚æœä½ forkäº†ä¸€ä¸ªè¿›ç¨‹ï¼Œå¦‚æœåœ¨é‚£ä¸ªæ–°çš„è¿›ç¨‹ä¸­ä½ ä¹Ÿå¯åŠ¨ä¸€ä¸ªlibuvï¼Œinit_threads()èƒ½è¢«è°ƒç”¨ã€‚</p><h4 id="init-threads"><a href="#init-threads" class="headerlink" title="init_threads"></a>init_threads</h4><h6 id="ğŸ¤æ¡ä»¶å˜é‡"><a href="#ğŸ¤æ¡ä»¶å˜é‡" class="headerlink" title="ğŸ¤æ¡ä»¶å˜é‡"></a>ğŸ¤æ¡ä»¶å˜é‡</h6><p>&emsp;&emsp;libuvåˆå§‹åŒ–<strong>æ¡ä»¶å˜é‡</strong>æ—¶ï¼Œè°ƒç”¨è‡ªå·±çš„uv_cond_initï¼Œè¿™ä¸ªå‡½æ•°åªåšäº†ä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯å°†<strong>æ¡ä»¶å˜é‡</strong>çš„æ—¶é’Ÿè®¾ç½®ä¸ºç›¸å¯¹æ—¶é—´ï¼Œè¿™ä¸€ç‚¹æ˜¯å€¼å¾—æˆ‘ä»¬è‡ªå·±å†™ä»£ç æ—¶å‚è€ƒçš„ï¼Œç›¸å¯¹æ—¶é—´ä¸å—ç³»ç»Ÿæ—¶é—´çš„å½±å“ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">uv_cond_init</span><span class="params">(<span class="keyword">uv_cond_t</span>* cond)</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  err = pthread_condattr_setclock(&amp;attr, CLOCK_MONOTONIC);</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="ğŸ¥›äº’æ–¥é”"><a href="#ğŸ¥›äº’æ–¥é”" class="headerlink" title="ğŸ¥›äº’æ–¥é”"></a>ğŸ¥›äº’æ–¥é”</h6><p>&emsp;&emsp;åˆå§‹åŒ–<strong>äº’æ–¥é”</strong>æ—¶ï¼Œè°ƒç”¨uv_mutex_initï¼Œåœ¨DEBUGæ—¶ï¼Œlibuvä¼šå°†<strong>äº’æ–¥é”</strong>è®¾ç½®ä¸ºPTHREAD_MUTEX_ERRORCHECKï¼Œè¿™æ ·èƒ½è‡ªæˆ‘æ£€æµ‹æ˜¯å¦ä¸ºæ­»é”ï¼Œä¸è¿‡è¿™ä¼šæ¶ˆè€—æ€§èƒ½ï¼Œæ‰€ä»¥åœ¨è¿è¡Œæ—¶è®¾ç½®ä¸ºé»˜è®¤å€¼ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">uv_mutex_init</span><span class="params">(<span class="keyword">uv_mutex_t</span>* mutex)</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(NDEBUG) || !defined(PTHREAD_MUTEX_ERRORCHECK)</span></span><br><span class="line">  <span class="keyword">return</span> UV__ERR(pthread_mutex_init(mutex, <span class="literal">NULL</span>));</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">if</span> (pthread_mutexattr_settype(&amp;attr, PTHREAD_MUTEX_ERRORCHECK))</span><br><span class="line">    <span class="built_in">abort</span>();</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>PTHREAD_MUTEX_ERRORCHECK<br>This type of mutex provides error checking. A thread attempting to relock this mutex without first unlocking it shall return with an error. A thread attempting to unlock a mutex which another thread has locked shall return with an error. A thread attempting to unlock an unlocked mutex shall return with an error.</p></blockquote><h6 id="ğŸ¥¡ä¿¡å·é‡"><a href="#ğŸ¥¡ä¿¡å·é‡" class="headerlink" title="ğŸ¥¡ä¿¡å·é‡"></a>ğŸ¥¡ä¿¡å·é‡</h6><p>&emsp;&emsp;åˆå§‹åŒ–æ¯ä¸ªçº¿ç¨‹æ—¶ï¼Œlibuvç”¨<strong>ä¿¡å·é‡</strong>æ¥ä¿è¯init_threadså‡½æ•°åœ¨åˆå§‹åŒ–å®Œæ‰€æœ‰çº¿ç¨‹åé€€å‡ºã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (uv_sem_init(&amp;sem, <span class="number">0</span>))</span><br><span class="line">    <span class="built_in">abort</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; nthreads; i++)</span><br><span class="line">    <span class="keyword">if</span> (uv_thread_create(threads + i, worker, &amp;sem))</span><br><span class="line">      <span class="built_in">abort</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; nthreads; i++)</span><br><span class="line">    uv_sem_wait(&amp;sem);</span><br><span class="line"></span><br><span class="line">  uv_sem_destroy(&amp;sem);</span><br></pre></td></tr></table></figure><p>åœ¨linuxä¸‹å¹¶ä¸”glibcç‰ˆæœ¬å¤§äº2.21æ—¶ï¼Œuv_sem_init(&amp;sem, 0)å’Œsem_init(&amp;sem, 0)æ˜¯ä¸€æ ·çš„ï¼Œæ²¡æœ‰é¢å¤–çš„å¤„ç†ã€‚<br>çº¿ç¨‹åˆ›å»ºå¥½åï¼Œåœ¨workerå‡½æ•°ä¸­ä¼šè°ƒç”¨uv_sem_posté‡Šæ”¾<strong>ä¿¡å·é‡</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">worker</span><span class="params">(<span class="keyword">void</span>* arg)</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  uv_sem_post((<span class="keyword">uv_sem_t</span>*) arg);</span><br><span class="line">  ...</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h6 id="ğŸ¥šuv-thread-create"><a href="#ğŸ¥šuv-thread-create" class="headerlink" title="ğŸ¥šuv_thread_create"></a>ğŸ¥šuv_thread_create</h6><p>&emsp;&emsp;uv_thread_createåšçš„äº‹æƒ…å°±æ˜¯<strong>è®¾ç½®çº¿ç¨‹çš„stackå¤§å°</strong>ï¼Œç„¶ååˆ›å»ºå®ƒã€‚<br><img src="https://img-blog.csdnimg.cn/20191118025701932.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>thread_stack_sizeå‡½æ•°è·å–æ ˆå¤§å°ï¼Œæœ‰ä¸€äº›æ˜¯è·¨å¹³å°å…¼å®¹æ€§çš„å¤„ç†ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lim.rlim_cur -= lim.rlim_cur % (<span class="keyword">rlim_t</span>) getpagesize(); å’Œ</span><br><span class="line"><span class="keyword">if</span> (lim.rlim_cur &gt;= PTHREAD_STACK_MIN)</span><br><span class="line">        <span class="keyword">return</span> lim.rlim_cur;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä¸¤è¡Œçš„é™åˆ¶æ˜¯æ¥æºäºpthread_attr_setstacksizeå‡½æ•°ï¼Œä¸€ä¸‹æ˜¯pthread_attr_setstacksizeå‡½æ•°manæ‰‹å†Œçš„ä¸€éƒ¨åˆ†ã€‚</p><blockquote><p>ERRORS<br>       pthread_attr_setstacksize() can fail with the following error:<br>EINVAL The stack size is less than PTHREAD_STACK_MIN (16384) bytes.<br> On some systems, pthread_attr_setstacksize() can fail with the error EINVAL if stacksize is not a multiple of<br>       the system page size.</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> size_t <span class="title">thread_stack_size</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(__APPLE__) || defined(__linux__)</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">rlimit</span> <span class="title">lim</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (getrlimit(RLIMIT_STACK, &amp;lim))</span><br><span class="line">    <span class="built_in">abort</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (lim.rlim_cur != RLIM_INFINITY) &#123;</span><br><span class="line">    <span class="comment">/* pthread_attr_setstacksize() expects page-aligned values. */</span></span><br><span class="line">    lim.rlim_cur -= lim.rlim_cur % (<span class="keyword">rlim_t</span>) getpagesize();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Musl's PTHREAD_STACK_MIN is 2 KB on all architectures, which is</span></span><br><span class="line"><span class="comment">     * too small to safely receive signals on.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Musl's PTHREAD_STACK_MIN + MINSIGSTKSZ == 8192 on arm64 (which has</span></span><br><span class="line"><span class="comment">     * the largest MINSIGSTKSZ of the architectures that musl supports) so</span></span><br><span class="line"><span class="comment">     * let's use that as a lower bound.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * We use a hardcoded value because PTHREAD_STACK_MIN + MINSIGSTKSZ</span></span><br><span class="line"><span class="comment">     * is between 28 and 133 KB when compiling against glibc, depending</span></span><br><span class="line"><span class="comment">     * on the architecture.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">if</span> (lim.rlim_cur &gt;= <span class="number">8192</span>)</span><br><span class="line">      <span class="keyword">if</span> (lim.rlim_cur &gt;= PTHREAD_STACK_MIN)</span><br><span class="line">        <span class="keyword">return</span> lim.rlim_cur;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span> &lt;&lt; <span class="number">20</span>;  <span class="comment">/* glibc default. */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>ğŸ˜‚æ— è¶£çš„æ˜¯åœ¨linux Ubuntusæˆ‘çš„ç¯å¢ƒä¸‹æµ‹è¯•æ—¶ï¼Œattrçš„é»˜è®¤stacksizeå’Œthread_stack_sizeå‡½æ•°è®¾ç½®åˆ°çš„æ˜¯ä¸€æ ·çš„å€¼ã€‚ä¸‹é¢æ˜¯æˆ‘çš„æµ‹è¯•ä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;uv.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/resource.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">a</span><span class="params">(<span class="keyword">void</span> *)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="number">123</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">size_t</span> stack_page() &#123;</span><br><span class="line">  rlimit x;</span><br><span class="line">  assert(getrlimit(RLIMIT_STACK, &amp;x) == <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">size_t</span> stack_size = x.rlim_cur - x.rlim_cur % getpagesize();</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; stack_size &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">  <span class="keyword">if</span>(stack_size &gt; PTHREAD_STACK_MIN) </span><br><span class="line">    <span class="keyword">return</span> stack_size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">pthread_attr_t</span> attr;</span><br><span class="line">  assert(pthread_attr_init(&amp;attr) == <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">size_t</span> stack_size;</span><br><span class="line">  pthread_attr_getstacksize(&amp;attr, &amp;stack_size);</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; stack_size &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">  stack_size = stack_page();</span><br><span class="line">  pthread_attr_setstacksize(&amp;attr, stack_size);</span><br><span class="line">  <span class="keyword">pthread_t</span> p1;</span><br><span class="line">  pthread_create(&amp;p1, &amp;attr, (<span class="keyword">void</span>* (*)(<span class="keyword">void</span>*))a, <span class="literal">nullptr</span>);</span><br><span class="line">  pthread_attr_destroy(&amp;attr);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> libuv </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>libuvæºç åˆ†æï¼ˆ2ï¼‰uv__loop_alive</title>
      <link href="/2019/11/16/libuv2/"/>
      <url>/2019/11/16/libuv2/</url>
      
        <content type="html"><![CDATA[<h5 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h5><p>&emsp;&emsp;ä¸Šä¸€ç¯‡è¯´äº†ä¸€ä¸‹æ•´ä½“çš„äº‹ä»¶å¾ªç¯ï¼Œå¯¹äºUV_RUN_DEFAULTæ¨¡å¼æ¥è°ƒç”¨uv_runæ¥è¯´ï¼Œuv__loop_aliveå°±å†³å®šäº†æ˜¯å¦é€€å‡ºï¼Œè¿™ä¸€ç¯‡çœ‹ä¸€ä¸‹uv__loop_aliveçš„æºç ã€‚</p><h5 id="è¯¦æƒ…"><a href="#è¯¦æƒ…" class="headerlink" title="è¯¦æƒ…"></a>è¯¦æƒ…</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">uv__loop_alive</span><span class="params">(<span class="keyword">const</span> <span class="keyword">uv_loop_t</span>* loop)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> uv__has_active_handles(loop) ||</span><br><span class="line">         uv__has_active_reqs(loop) ||</span><br><span class="line">         loop-&gt;closing_handles != <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;å¯è§loopçš„çŠ¶æ€å–å†³äºä¸‰ä¸ªæ–¹é¢ï¼šhandlesã€reqsã€closing_handles </p><h5 id="handles"><a href="#handles" class="headerlink" title="handles"></a>handles</h5><p>&emsp;&emsp;uv__has_active_handleså°±æ˜¯æ£€æŸ¥loop-&gt;active_handleså€¼æ˜¯å¦å¤§äº0.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> uv__has_active_handles(loop)                                          \</span></span><br><span class="line">  ((loop)-&gt;active_handles &gt; <span class="number">0</span>)</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Handle types. */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">uv_loop_s</span> <span class="title">uv_loop_t</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">uv_handle_s</span> <span class="title">uv_handle_t</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">uv_dir_s</span> <span class="title">uv_dir_t</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">uv_stream_s</span> <span class="title">uv_stream_t</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">uv_tcp_s</span> <span class="title">uv_tcp_t</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">uv_udp_s</span> <span class="title">uv_udp_t</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">uv_pipe_s</span> <span class="title">uv_pipe_t</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">uv_tty_s</span> <span class="title">uv_tty_t</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">uv_poll_s</span> <span class="title">uv_poll_t</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">uv_timer_s</span> <span class="title">uv_timer_t</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">uv_prepare_s</span> <span class="title">uv_prepare_t</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">uv_check_s</span> <span class="title">uv_check_t</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">uv_idle_s</span> <span class="title">uv_idle_t</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">uv_async_s</span> <span class="title">uv_async_t</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">uv_process_s</span> <span class="title">uv_process_t</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">uv_fs_event_s</span> <span class="title">uv_fs_event_t</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">uv_fs_poll_s</span> <span class="title">uv_fs_poll_t</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">uv_signal_s</span> <span class="title">uv_signal_t</span>;</span></span><br></pre></td></tr></table></figure><p>&emsp;&emsp;handlesåˆ—è¡¨å¦‚ä¸Šã€‚handleåœ¨è°ƒç”¨æ—¶ï¼Œä¼šåŒ…å«ä¸€ä¸ªå‡½æ•°çš„è°ƒç”¨ï¼Œå°±æ˜¯<br>uv__handle_startã€‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ˜¯å“ªäº›å‡½æ•°è°ƒç”¨äº†uv__handle_startã€‚<del>æœ‰ä¸€äº›handleä¸åœ¨å…¶ä¸­ï¼Œå¯èƒ½ä¸å…¶è°ƒç”¨æ–¹å¼æœ‰å…³ï¼Œæˆ‘æš‚æ—¶æ— æ³•è§£é‡Š</del><br><img src="https://img-blog.csdnimg.cn/20191116181231294.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMDE1MDQ4,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> uv__handle_start(h)                                                   \</span></span><br><span class="line">  <span class="keyword">do</span> &#123;                                                                        \</span><br><span class="line">    <span class="keyword">if</span> (((h)-&gt;flags &amp; UV_HANDLE_ACTIVE) != <span class="number">0</span>) <span class="keyword">break</span>;                          \</span><br><span class="line">    (h)-&gt;flags |= UV_HANDLE_ACTIVE;                                           \</span><br><span class="line">    <span class="keyword">if</span> (((h)-&gt;flags &amp; UV_HANDLE_REF) != <span class="number">0</span>) uv__active_handle_add(h);          \</span><br><span class="line">  &#125;                                                                           \</span><br><span class="line">  <span class="keyword">while</span> (<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;uv__handle_startå‡½æ•°åœ¨è°ƒç”¨æ—¶ï¼Œä¼šè°ƒç”¨uv__active_handle_addï¼Œuv__active_handle_addå°±æ˜¯å°†loop-&gt;active_handles++</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> uv__active_handle_add(h)                                              \</span></span><br><span class="line">  <span class="keyword">do</span> &#123;                                                                        \</span><br><span class="line">    (h)-&gt;loop-&gt;active_handles++;                                              \</span><br><span class="line">  &#125;                                                                           \</span><br><span class="line">  <span class="keyword">while</span> (<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;ç›¸åº”çš„åœ¨handleç»“æŸæ—¶æœ‰uv__active_handle_rmçš„è°ƒç”¨ï¼Œ(h)-&gt;loop-&gt;active_handleså‡ä¸€ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> uv__active_handle_rm(h)                                               \</span></span><br><span class="line">  <span class="keyword">do</span> &#123;                                                                        \</span><br><span class="line">    (h)-&gt;loop-&gt;active_handles--;                                              \</span><br><span class="line">  &#125;                                                                           \</span><br><span class="line">  <span class="keyword">while</span> (<span class="number">0</span>)</span><br></pre></td></tr></table></figure><h5 id="req"><a href="#req" class="headerlink" title="req"></a>req</h5><p>&emsp;&emsp;uv__has_active_reqså’Œhandleçš„é“ç†ä¸€æ ·ï¼Œæ˜¯æ£€æµ‹(loop)-&gt;active_reqs.count &gt; 0ã€‚active_reqsæ˜¯ä¸ªå…±ç”¨ä½“ï¼Œå®ƒçš„å¦ä¸€ä¸ªç”¨é€”æš‚æ—¶æˆ‘è¿˜ä¸çŸ¥é“ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> uv__has_active_reqs(loop)                                             \</span></span><br><span class="line">  ((loop)-&gt;active_reqs.count &gt; <span class="number">0</span>)</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Request types. */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">uv_req_s</span> <span class="title">uv_req_t</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">uv_getaddrinfo_s</span> <span class="title">uv_getaddrinfo_t</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">uv_getnameinfo_s</span> <span class="title">uv_getnameinfo_t</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">uv_shutdown_s</span> <span class="title">uv_shutdown_t</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">uv_write_s</span> <span class="title">uv_write_t</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">uv_connect_s</span> <span class="title">uv_connect_t</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">uv_udp_send_s</span> <span class="title">uv_udp_send_t</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">uv_fs_s</span> <span class="title">uv_fs_t</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">uv_work_s</span> <span class="title">uv_work_t</span>;</span></span><br></pre></td></tr></table></figure><p>&emsp;&emsp;uv__req_register(loop, req)ç­‰åŒäºhandleçš„uv__active_handle_addã€‚uv__req_registeråœ¨uv__req_initä¸­è°ƒç”¨ï¼Œå‡ ä¹ï¼ˆ<del>æ¼ç½‘çš„æš‚æ—¶æ²¡æ³•è§£é‡Š</del> ï¼‰æ¯ä¸ªreqåœ¨åˆå§‹åŒ–æ—¶éƒ½è°ƒç”¨äº†uv__req_initã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> uv__req_init(loop, req, typ)                                          \</span></span><br><span class="line">  <span class="keyword">do</span> &#123;                                                                        \</span><br><span class="line">    UV_REQ_INIT(req, typ);                                                    \</span><br><span class="line">    uv__req_register(loop, req);                                              \</span><br><span class="line">  &#125;                                                                           \</span><br><span class="line">  <span class="keyword">while</span> (<span class="number">0</span>)</span><br><span class="line">  </span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> uv__req_register(loop, req)                                           \</span></span><br><span class="line">  <span class="keyword">do</span> &#123;                                                                        \</span><br><span class="line">    (loop)-&gt;active_reqs.count++;                                              \</span><br><span class="line">  &#125;                                                                           \</span><br><span class="line">  <span class="keyword">while</span> (<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;ä¸‹å›¾æ‰€ç¤ºæ˜¯é‚£äº›å‡½æ•°è°ƒç”¨äº†uv__req_initï¼Œç”±åç§°æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥å®ƒä»¬æ˜¯å±äºå“ªäº›reqçš„ã€‚<br><img src="https://img-blog.csdnimg.cn/20191116181900253.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>&emsp;&emsp;åŒç†ï¼Œè¿˜æœ‰uv__req_unregisterã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> uv__req_unregister(loop, req)                                         \</span></span><br><span class="line">  <span class="keyword">do</span> &#123;                                                                        \</span><br><span class="line">    assert(uv__has_active_reqs(loop));                                        \</span><br><span class="line">    (loop)-&gt;active_reqs.count--;                                              \</span><br><span class="line">  &#125;                                                                           \</span><br><span class="line">  <span class="keyword">while</span> (<span class="number">0</span>)</span><br></pre></td></tr></table></figure><h5 id="closing-handles"><a href="#closing-handles" class="headerlink" title="closing_handles"></a>closing_handles</h5><p>&emsp;&emsp;è¦å…³é—­çš„handleä¼šä»¥é“¾è¡¨çš„å½¢å¼æŒ‚åœ¨loop-&gt;closing_handlesä¸Šã€‚è¿™ä¸ªæ“ä½œé€šè¿‡è°ƒç”¨uv__make_close_pendingæ¥å®ç°ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">uv__make_close_pending</span><span class="params">(<span class="keyword">uv_handle_t</span>* handle)</span> </span>&#123;</span><br><span class="line">  assert(handle-&gt;flags &amp; UV_HANDLE_CLOSING);</span><br><span class="line">  assert(!(handle-&gt;flags &amp; UV_HANDLE_CLOSED));</span><br><span class="line">  handle-&gt;next_closing = handle-&gt;loop-&gt;closing_handles;</span><br><span class="line">  handle-&gt;loop-&gt;closing_handles = handle;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœclosing_handlesä¸ä¸ºç©ºï¼Œé‚£ä¹ˆè¿˜éœ€è¦è¿›å…¥äº‹ä»¶å¾ªç¯ï¼Œå»è°ƒç”¨å…³é—­çš„handleçš„å›è°ƒå‡½æ•°ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> libuv </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>libuvæºç åˆ†æï¼ˆ1ï¼‰äº‹ä»¶å¾ªç¯åˆ†æ</title>
      <link href="/2019/11/16/libuv1/"/>
      <url>/2019/11/16/libuv1/</url>
      
        <content type="html"><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><blockquote><p>&emsp;&emsp;libuvæ€»æ˜¯æŠ¥å‡ºä¸€äº›è®©äººéš¾ä»¥ç†è§£çš„é”™è¯¯ğŸ˜‚ï¼Œä½œä¸ºä¸€ä¸ªCçš„é¡¹ç›®ï¼Œä¸å…·æœ‰Javaã€JavaScriptã€phpé‚£æ ·çš„äººæ°”ï¼Œå¾ˆéš¾ç™¾åº¦åˆ°ä¸€äº›é—®é¢˜çš„ç­”æ¡ˆï¼Œç”šè‡³googleä¹Ÿä¸è¡Œã€‚ä¸ºäº†ç”¨å¥½libuvï¼Œä¹Ÿä¸ºäº†å­¦ä¹ å§ã€‚æˆ‘å¼€å§‹çœ‹libuvçš„æºç ï¼Œä¸çŸ¥é“è‡ªå·±èƒ½èµ°å¤šè¿œã€‚ã€‚ã€‚</p></blockquote><h4 id="äº‹ä»¶å¾ªç¯"><a href="#äº‹ä»¶å¾ªç¯" class="headerlink" title="äº‹ä»¶å¾ªç¯"></a>äº‹ä»¶å¾ªç¯</h4><img src="https://img-blog.csdnimg.cn/20191116165040610.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMDE1MDQ4,size_16,color_FFFFFF,t_70" width="400" height="500" alt="Event Loop" align=center><p>è¿™æ˜¯å®˜æ–¹äº‹ä»¶å¾ªç¯çš„ç¤ºæ„å›¾ã€‚<a href="http://docs.libuv.org/en/v1.x/design.html" target="_blank" rel="noopener">é“¾æ¥-&gt;å®˜æ–¹å›¾ç‰‡ä½ç½®</a></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">uv_run</span><span class="params">(<span class="keyword">uv_loop_t</span>* loop, uv_run_mode mode)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> timeout;</span><br><span class="line">  <span class="keyword">int</span> r;</span><br><span class="line">  <span class="keyword">int</span> ran_pending;</span><br><span class="line"></span><br><span class="line">  r = uv__loop_alive(loop);</span><br><span class="line">  <span class="keyword">if</span> (!r)</span><br><span class="line">    uv__update_time(loop);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (r != <span class="number">0</span> &amp;&amp; loop-&gt;stop_flag == <span class="number">0</span>) &#123;</span><br><span class="line">    uv__update_time(loop);</span><br><span class="line">    uv__run_timers(loop);</span><br><span class="line">    ran_pending = uv__run_pending(loop);</span><br><span class="line">    uv__run_idle(loop);</span><br><span class="line">    uv__run_prepare(loop);</span><br><span class="line"></span><br><span class="line">    timeout = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ((mode == UV_RUN_ONCE &amp;&amp; !ran_pending) || mode == UV_RUN_DEFAULT)</span><br><span class="line">      timeout = uv_backend_timeout(loop);</span><br><span class="line"></span><br><span class="line">    uv__io_poll(loop, timeout);</span><br><span class="line">    uv__run_check(loop);</span><br><span class="line">    uv__run_closing_handles(loop);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (mode == UV_RUN_ONCE) &#123;</span><br><span class="line">      <span class="comment">/* UV_RUN_ONCE implies forward progress: at least one callback must have</span></span><br><span class="line"><span class="comment">       * been invoked when it returns. uv__io_poll() can return without doing</span></span><br><span class="line"><span class="comment">       * I/O (meaning: no callbacks) when its timeout expires - which means we</span></span><br><span class="line"><span class="comment">       * have pending timers that satisfy the forward progress constraint.</span></span><br><span class="line"><span class="comment">       *</span></span><br><span class="line"><span class="comment">       * UV_RUN_NOWAIT makes no guarantees about progress so it's omitted from</span></span><br><span class="line"><span class="comment">       * the check.</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      uv__update_time(loop);</span><br><span class="line">      uv__run_timers(loop);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    r = uv__loop_alive(loop);</span><br><span class="line">    <span class="keyword">if</span> (mode == UV_RUN_ONCE || mode == UV_RUN_NOWAIT)</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* The if statement lets gcc compile it to a conditional store. Avoids</span></span><br><span class="line"><span class="comment">   * dirtying a cache line.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">if</span> (loop-&gt;stop_flag != <span class="number">0</span>)</span><br><span class="line">    loop-&gt;stop_flag = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;æ•´ä¸ªäº‹ä»¶å¾ªç¯å°±æ˜¯åœ¨ä¸»çº¿ç¨‹çš„uv_runï¼ˆï¼‰è°ƒç”¨ä¸­æ‰§è¡Œçš„ã€‚æˆ‘å°±è·Ÿç€å®˜æ–¹çš„ä»‹ç»ä¸€æ­¥ä¸€æ­¥æ¥çœ‹ï¼ˆ<a href="http://docs.libuv.org/en/v1.x/design.html" target="_blank" rel="noopener">å®˜æ–¹ä»‹ç»</a>ï¼‰ã€‚</p><h5 id="ç¬¬ä¸€æ­¥"><a href="#ç¬¬ä¸€æ­¥" class="headerlink" title="ç¬¬ä¸€æ­¥"></a>ç¬¬ä¸€æ­¥</h5><blockquote><p>The loop concept of â€˜nowâ€™ is updated. The event loop caches the current time at the start of the event loop tick in order to reduce the number of time-related system calls.</p></blockquote><p>&emsp;&emsp;ç¬¬ä¸€æ­¥æ˜¯æ›´æ–°æ—¶é—´ã€‚å¯¹åº”ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uv__update_time(loop);</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;æ€»ç»“æ¥è¯´å°±æ˜¯è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œæ›´æ–°æ—¶é—´ã€‚<del>uv__update_timeå®ç°æˆ‘ä¸‹ä¸€ç¯‡æ¥ä»‹ç»</del> </p><h5 id="ç¬¬äºŒæ­¥"><a href="#ç¬¬äºŒæ­¥" class="headerlink" title="ç¬¬äºŒæ­¥"></a>ç¬¬äºŒæ­¥</h5><blockquote><p>If the loop is alive an iteration is started, otherwise the loop will exit immediately. So, when is a loop considered to be alive? If a loop has active and refâ€™d handles, active requests or closing handles itâ€™s considered to be alive.</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r = uv__loop_alive(loop);</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;ç”¨uv__loop_aliveå‡½æ•°è·å–loopçŠ¶æ€ã€‚<br>&emsp;&emsp;å¦‚æœuv__loop_aliveè¿”å›é›¶æˆ–è€…loop-&gt;stop_flag == 1è¯´æ˜loopç»ˆæ­¢ï¼Œç›´æ¥è·³è¿‡å¾ªç¯ï¼Œåˆ°ä»£ç æœ€ä¸‹é¢ï¼ˆ<del>è¿™é‡Œæœ‰ä¸€äº›æ€§èƒ½çš„å¤„ç†æš‚æ—¶ä¸ç®¡</del> ï¼‰ï¼Œé€€å‡ºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* The if statement lets gcc compile it to a conditional store. Avoids</span></span><br><span class="line"><span class="comment">   * dirtying a cache line.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">if</span> (loop-&gt;stop_flag != <span class="number">0</span>)</span><br><span class="line">    loop-&gt;stop_flag = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> r;</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;loop-&gt;stop_flag == 0çš„ä¸€ä¸ªæ¥æºæ˜¯è°ƒç”¨äº†uv_stopï¼Œè¿™ä¸ªå‡½æ•°åœ¨æ‰‹å†Œä¸­çœ‹è§ã€‚å®ƒçš„æºä»£ç ä¹Ÿå¾ˆæ¸…æ™°ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">uv_stop</span><span class="params">(<span class="keyword">uv_loop_t</span>* loop)</span> </span>&#123;</span><br><span class="line">  loop-&gt;stop_flag = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;å¦‚æœloopçŠ¶æ€OKï¼Œé‚£ä¹ˆå°±è¿›å…¥å¾ªç¯ä¸­ã€‚</p><h5 id="ç¬¬ä¸‰æ­¥"><a href="#ç¬¬ä¸‰æ­¥" class="headerlink" title="ç¬¬ä¸‰æ­¥"></a>ç¬¬ä¸‰æ­¥</h5><blockquote><p>Due timers are run. All active timers scheduled for a time before the loopâ€™s concept of now get their callbacks called.</p></blockquote><p>&emsp;&emsp;å¯¹åº”ä»£ç è¿™ä¸€éƒ¨åˆ†ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">uv__run_timers(loop);</span><br><span class="line">å…¶å®ç°ï¼š</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">uv__run_timers</span><span class="params">(<span class="keyword">uv_loop_t</span>* loop)</span> </span>&#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">heap_node</span>* <span class="title">heap_node</span>;</span></span><br><span class="line">  <span class="keyword">uv_timer_t</span>* handle;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">    heap_node = heap_min(timer_heap(loop));</span><br><span class="line">    <span class="keyword">if</span> (heap_node == <span class="literal">NULL</span>)</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    handle = container_of(heap_node, <span class="keyword">uv_timer_t</span>, heap_node);</span><br><span class="line">    <span class="keyword">if</span> (handle-&gt;timeout &gt; loop-&gt;time)</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    uv_timer_stop(handle);</span><br><span class="line">    uv_timer_again(handle);</span><br><span class="line">    handle-&gt;timer_cb(handle);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;å°†å †é‡Œé¢å·²ç»è¶…æ—¶çš„æ‹¿å‡ºæ¥è¿è¡Œã€‚</p><h5 id="ç¬¬å››æ­¥"><a href="#ç¬¬å››æ­¥" class="headerlink" title="ç¬¬å››æ­¥"></a>ç¬¬å››æ­¥</h5><blockquote><p>Pending callbacks are called. All I/O callbacks are called right after polling for I/O, for the most part. There are cases, however, in which calling such a callback is deferred for the next loop iteration. If the previous iteration deferred any I/O callback it will be run at this point.</p></blockquote><p>å¯¹åº”ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">ran_pending = uv__run_pending(loop);</span><br><span class="line">å…¶å®ç°ï¼š</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">uv__run_pending</span><span class="params">(<span class="keyword">uv_loop_t</span>* loop)</span> </span>&#123;</span><br><span class="line">  QUEUE* q;</span><br><span class="line">  QUEUE pq;</span><br><span class="line">  <span class="keyword">uv__io_t</span>* w;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (QUEUE_EMPTY(&amp;loop-&gt;pending_queue))</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  QUEUE_MOVE(&amp;loop-&gt;pending_queue, &amp;pq);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (!QUEUE_EMPTY(&amp;pq)) &#123;</span><br><span class="line">    q = QUEUE_HEAD(&amp;pq);</span><br><span class="line">    QUEUE_REMOVE(q);</span><br><span class="line">    QUEUE_INIT(q);</span><br><span class="line">    w = QUEUE_DATA(q, <span class="keyword">uv__io_t</span>, pending_queue);</span><br><span class="line">    w-&gt;cb(loop, w, POLLOUT);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;å°†loop-&gt;pending_queueä¸­çš„ä»»åŠ¡æ‹¿å‡ºæ¥è¿è¡Œã€‚</p><h5 id="ç¬¬äº”ã€å…­ã€ä¹æ­¥"><a href="#ç¬¬äº”ã€å…­ã€ä¹æ­¥" class="headerlink" title="ç¬¬äº”ã€å…­ã€ä¹æ­¥"></a>ç¬¬äº”ã€å…­ã€ä¹æ­¥</h5><blockquote><p>5.Idle handle callbacks are called. Despite the unfortunate name, idle handles are run on every loop iteration, if they are active</p></blockquote><blockquote><p> 6.Prepare handle callbacks are called. Prepare handles get their callbacks called right before the loop will block for I/O.</p></blockquote><blockquote><p>9.Check handle callbacks are called. Check handles get their callbacks called right after the loop has blocked for I/O. Check handles are essentially the counterpart of prepare handles.</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uv__run_idle(loop);</span><br><span class="line">uv__run_prepare(loop);</span><br><span class="line">uv__run_check(loop);</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;è¿™ä¸‰éƒ¨ä¸ºä»€ä¹ˆè¦ä¸€èµ·è¯´å‘¢ï¼Ÿå› ä¸ºå®ƒä»¬çš„å®è´¨æ˜¯ä¸€æ ·çš„ã€‚åœ¨æ¯æ¬¡å¾ªç¯å›ºå®šçš„ä½ç½®è°ƒç”¨ã€‚<br>&emsp;&emsp;è¿™ä¸‰ä¸ªå‡½æ•°å®šä¹‰åœ¨loop-watcher.cè¿™ä¸ªæ–‡ä»¶é‡Œé¢ï¼Œå®ƒä»¬æ˜¯ç”¨å®å®šä¹‰å®šä¹‰çš„ã€‚åªæ”¹äº†idleã€prepareã€checkè¿™ä¸‰ä¸ªåå­—çš„éƒ¨åˆ†ï¼Œå…¶ä½™éƒ¨åˆ†å‡½æ•°éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Copyright Joyent, Inc. and other Node contributors. All rights reserved.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Permission is hereby granted, free of charge, to any person obtaining a copy</span></span><br><span class="line"><span class="comment"> * of this software and associated documentation files (the "Software"), to</span></span><br><span class="line"><span class="comment"> * deal in the Software without restriction, including without limitation the</span></span><br><span class="line"><span class="comment"> * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or</span></span><br><span class="line"><span class="comment"> * sell copies of the Software, and to permit persons to whom the Software is</span></span><br><span class="line"><span class="comment"> * furnished to do so, subject to the following conditions:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The above copyright notice and this permission notice shall be included in</span></span><br><span class="line"><span class="comment"> * all copies or substantial portions of the Software.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span></span><br><span class="line"><span class="comment"> * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span></span><br><span class="line"><span class="comment"> * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span></span><br><span class="line"><span class="comment"> * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span></span><br><span class="line"><span class="comment"> * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING</span></span><br><span class="line"><span class="comment"> * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS</span></span><br><span class="line"><span class="comment"> * IN THE SOFTWARE.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"uv.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"internal.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> UV_LOOP_WATCHER_DEFINE(name, type)                                    \</span></span><br><span class="line">  <span class="keyword">int</span> uv_#<span class="meta">#name##_init(uv_loop_t* loop, uv_##name##_t* handle) &#123;              \</span></span><br><span class="line">    uv__handle_init(loop, (<span class="keyword">uv_handle_t</span>*)handle, UV_##type);                   \</span><br><span class="line">    handle-&gt;name##_cb = <span class="literal">NULL</span>;                                                 \</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;                                                                 \</span><br><span class="line">  &#125;                                                                           \</span><br><span class="line">                                                                              \</span><br><span class="line">  <span class="keyword">int</span> uv_#<span class="meta">#name##_start(uv_##name##_t* handle, uv_##name##_cb cb) &#123;           \</span></span><br><span class="line">    <span class="keyword">if</span> (uv__is_active(handle)) <span class="keyword">return</span> <span class="number">0</span>;                                      \</span><br><span class="line">    <span class="keyword">if</span> (cb == <span class="literal">NULL</span>) <span class="keyword">return</span> UV_EINVAL;                                         \</span><br><span class="line">    QUEUE_INSERT_HEAD(&amp;handle-&gt;loop-&gt;name##_handles, &amp;handle-&gt;<span class="built_in">queue</span>);         \</span><br><span class="line">    handle-&gt;name##_cb = cb;                                                   \</span><br><span class="line">    uv__handle_start(handle);                                                 \</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;                                                                 \</span><br><span class="line">  &#125;                                                                           \</span><br><span class="line">                                                                              \</span><br><span class="line">  <span class="keyword">int</span> uv_#<span class="meta">#name##_stop(uv_##name##_t* handle) &#123;                               \</span></span><br><span class="line">    <span class="keyword">if</span> (!uv__is_active(handle)) <span class="keyword">return</span> <span class="number">0</span>;                                     \</span><br><span class="line">    QUEUE_REMOVE(&amp;handle-&gt;<span class="built_in">queue</span>);                                             \</span><br><span class="line">    uv__handle_stop(handle);                                                  \</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;                                                                 \</span><br><span class="line">  &#125;                                                                           \</span><br><span class="line">                                                                              \</span><br><span class="line">  <span class="keyword">void</span> uv__run_#<span class="meta">#name(uv_loop_t* loop) &#123;                                      \</span></span><br><span class="line">    uv_#<span class="meta">#name##_t* h;                                                         \</span></span><br><span class="line">    QUEUE <span class="built_in">queue</span>;                                                              \</span><br><span class="line">    QUEUE* q;                                                                 \</span><br><span class="line">    QUEUE_MOVE(&amp;loop-&gt;name##_handles, &amp;<span class="built_in">queue</span>);                                \</span><br><span class="line">    <span class="keyword">while</span> (!QUEUE_EMPTY(&amp;<span class="built_in">queue</span>)) &#123;                                            \</span><br><span class="line">      q = QUEUE_HEAD(&amp;<span class="built_in">queue</span>);                                                 \</span><br><span class="line">      h = QUEUE_DATA(q, uv_##name##<span class="keyword">_t</span>, <span class="built_in">queue</span>);                                \</span><br><span class="line">      QUEUE_REMOVE(q);                                                        \</span><br><span class="line">      QUEUE_INSERT_TAIL(&amp;loop-&gt;name##_handles, q);                            \</span><br><span class="line">      h-&gt;name##_cb(h);                                                        \</span><br><span class="line">    &#125;                                                                         \</span><br><span class="line">  &#125;                                                                           \</span><br><span class="line">                                                                              \</span><br><span class="line">  <span class="keyword">void</span> uv__#<span class="meta">#name##_close(uv_##name##_t* handle) &#123;                            \</span></span><br><span class="line">    uv_#<span class="meta">#name##_stop(handle);                                                 \</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">UV_LOOP_WATCHER_DEFINE(prepare, PREPARE)</span><br><span class="line">UV_LOOP_WATCHER_DEFINE(check, CHECK)</span><br><span class="line">UV_LOOP_WATCHER_DEFINE(idle, IDLE)</span><br></pre></td></tr></table></figure><h5 id="ç¬¬ä¸ƒæ­¥"><a href="#ç¬¬ä¸ƒæ­¥" class="headerlink" title="ç¬¬ä¸ƒæ­¥"></a>ç¬¬ä¸ƒæ­¥</h5><blockquote><p>Poll timeout is calculated. Before blocking for I/O the loop calculates for how long it should block. These are the rules when calculating the timeout:<br>If the loop was run with the UV_RUN_NOWAIT flag, the timeout is 0.<br>If the loop is going to be stopped (uv_stop() was called), the timeout is 0.<br>If there are no active handles or requests, the timeout is 0.<br>If there are any idle handles active, the timeout is 0.<br>If there are any handles pending to be closed, the timeout is 0.<br>If none of the above cases matches, the timeout of the closest timer is taken, or if there are no active timers, infinity.</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((mode == UV_RUN_ONCE &amp;&amp; !ran_pending) || mode == UV_RUN_DEFAULT)</span><br><span class="line">      timeout = uv_backend_timeout(loop);</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;è¿™éƒ¨åˆ†æ˜¯å–å†³äºuv_runçš„æ¨¡å¼çš„ç‰¹æ®Šå¤„ç†ï¼Œæš‚æ—¶ä¸ç»†çœ‹ã€‚</p><h5 id="ç¬¬å…«æ­¥"><a href="#ç¬¬å…«æ­¥" class="headerlink" title="ç¬¬å…«æ­¥"></a>ç¬¬å…«æ­¥</h5><blockquote><p>The loop blocks for I/O. At this point the loop will block for I/O for the duration calculated in the previous step. All I/O related handles that were monitoring a given file descriptor for a read or write operation get their callbacks called at this point.</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uv__io_poll(loop, timeout);</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;è¿™ä¸€éƒ¨åˆ†å¯¹äºä¸åŒæ“ä½œç³»ç»Ÿæœ‰æ‰€ä¸åŒï¼Œlinuxæ˜¯pollï¼Œmacæ˜¯kqueueã€‚</p><h5 id="ç¬¬åæ­¥"><a href="#ç¬¬åæ­¥" class="headerlink" title="ç¬¬åæ­¥"></a>ç¬¬åæ­¥</h5><blockquote><p>Close callbacks are called. If a handle was closed by calling uv_close() it will get the close callback called.</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uv__run_closing_handles(loop);</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;è°ƒç”¨å„ç±»çš„closeå›è°ƒå‡½æ•°ã€‚</p><h5 id="ç¬¬åä¸€ã€åäºŒæ­¥"><a href="#ç¬¬åä¸€ã€åäºŒæ­¥" class="headerlink" title="ç¬¬åä¸€ã€åäºŒæ­¥"></a>ç¬¬åä¸€ã€åäºŒæ­¥</h5><blockquote><p>11.Special case in case the loop was run with UV_RUN_ONCE, as it implies forward progress. Itâ€™s possible that no I/O callbacks were fired after blocking for I/O, but some time has passed so there might be timers which are due, those timers get their callbacks called.<br>12.Iteration ends. If the loop was run with UV_RUN_NOWAIT or UV_RUN_ONCE modes the iteration ends and uv_run() will return. If the loop was run with UV_RUN_DEFAULT it will continue from the start if itâ€™s still alive, otherwise it will also end.</p></blockquote><p>&emsp;&emsp;å¯¹äºuv_runä¸åŒæ¨¡å¼çš„ä¸€ç‚¹ç‰¹æ®Šå¤„ç†ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (mode == UV_RUN_ONCE) &#123;</span><br><span class="line">      <span class="comment">/* UV_RUN_ONCE implies forward progress: at least one callback must have</span></span><br><span class="line"><span class="comment">       * been invoked when it returns. uv__io_poll() can return without doing</span></span><br><span class="line"><span class="comment">       * I/O (meaning: no callbacks) when its timeout expires - which means we</span></span><br><span class="line"><span class="comment">       * have pending timers that satisfy the forward progress constraint.</span></span><br><span class="line"><span class="comment">       *</span></span><br><span class="line"><span class="comment">       * UV_RUN_NOWAIT makes no guarantees about progress so it's omitted from</span></span><br><span class="line"><span class="comment">       * the check.</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      uv__update_time(loop);</span><br><span class="line">      uv__run_timers(loop);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    r = uv__loop_alive(loop);</span><br><span class="line">    <span class="keyword">if</span> (mode == UV_RUN_ONCE || mode == UV_RUN_NOWAIT)</span><br><span class="line">      <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure><h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><p>&emsp;&emsp;å®è§‚ä¸Šæ¢³ç†ä¸€ä¸‹æ•´ä¸ªäº‹ä»¶å¾ªç¯çš„è¿‡ç¨‹ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> libuv </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>redisåŸºæ•°æ ‘raxæºç åˆ†æ(2.5)</title>
      <link href="/2019/08/14/rax3/"/>
      <url>/2019/08/14/rax3/</url>
      
        <content type="html"><![CDATA[<h5 id="ç‚¹ç‚¹åºŸè¯"><a href="#ç‚¹ç‚¹åºŸè¯" class="headerlink" title="ç‚¹ç‚¹åºŸè¯"></a>ç‚¹ç‚¹åºŸè¯</h5><p>&emsp;&emsp;æœ€è¿‘æ²¡æœ‰å†å°†raxçš„æºç å¾€ä¸‹çœ‹ï¼Œraxå¯¹äºä¸€ä¸ªæ–°æ‰‹æ¥è¯´è¿˜æ˜¯ä½“é‡è¿‡å¤§ï¼Œåœ¨å°è¯•è‡ªå·±å†™å†™ï¼Œåœ¨å†™çš„æ—¶å€™é‡åˆ°äº†ä¸€äº›å‘ï¼Œä¹Ÿä½“ä¼šåˆ°äº†raxçš„ä¸€äº›å†™æ³•çš„ç²¾å¦™ä¹‹å¤„ï¼Œè®°å½•ä¸€ä¸‹ã€‚</p><hr><h5 id="å®å®šä¹‰å‡½æ•°çš„æ³¨æ„ç‚¹ï¼š"><a href="#å®å®šä¹‰å‡½æ•°çš„æ³¨æ„ç‚¹ï¼š" class="headerlink" title="å®å®šä¹‰å‡½æ•°çš„æ³¨æ„ç‚¹ï¼š"></a>å®å®šä¹‰å‡½æ•°çš„æ³¨æ„ç‚¹ï¼š</h5><p>&emsp;&emsp;æˆ‘å®šä¹‰äº†è¿™æ ·ä¸€ä¸ªå®å®šä¹‰å‡½æ•°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#define radixNthChild(h, n) \</span><br><span class="line">  (radix_node**)((char*)&amp;h-&gt;data + h-&gt;size + padding(h-&gt;size) + n * sizeof(void*))</span><br></pre></td></tr></table></figure><p>æˆ‘è¿™æ ·è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">radixNthChild(new_cur, new_cur-&gt;size - 1)</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸€ä¸ªè°ƒç”¨å¤§å®¶è§‰å¾—æœ‰é—®é¢˜å—ï¼Ÿå—¯ï¼Œè‚¯å®šæ˜¯æœ‰é—®é¢˜çš„ï¼Œä¸ç„¶æˆ‘è¯´å•¥?ã€‚</p><p>è¿™é‡Œï¼ŒæŒ‰ç…§æˆ‘ä»¬ä¸€èˆ¬çš„è°ƒç”¨å‡½æ•°çš„æ€è·¯ï¼Œè¿™æ ·ä¸€ä¸ªè°ƒç”¨çš„è¿è¡Œè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>è®¡ç®—å‡ºnew_cur-&gt;size - 1</li><li>å¸¦å…¥radixNthChildå‡½æ•°</li></ol><p>å®é™…ä¸Šæ°æ°ç›¸åï¼Œ<strong>å®å®šä¹‰çš„å¤„ç†åœ¨é¢„ç¼–è¯‘æ—¶ï¼ˆg++ -Eï¼‰</strong>ï¼Œå®å®šä¹‰æ˜¯å°†å¯¹äºçš„å®šä¹‰æ›¿æ¢æ‰ï¼Œæ‰€ä»¥åœ¨<br>é¢„ç¼–è¯‘åçš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 363 &quot;radix_tree.c&quot;</span><br><span class="line">    memcpy((radix_node**)((char*)&amp;new_cur-&gt;data + new_cur-&gt;size + ((sizeof(void*) - (sizeof(radix_node) + new_cur-&gt;size) % sizeof(void*)) &amp; (sizeof(void*) - 1)) + new_cur-&gt;size - 1 * sizeof(void*)), &amp;keyOne, sizeof(void*));</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ˜¯ ï¼š + new_cur-&gt;size - 1 * sizeof(void<em>)<br>è€Œä¸æ˜¯æˆ‘æ‰€æƒ³çš„ï¼š + ï¼ˆnew_cur-&gt;size - 1ï¼‰ * sizeof(void</em>)</p><p><strong>å¯ä»¥å¾—å‡ºå…¶è¿‡ç¨‹å…¶å®æ˜¯ï¼š</strong></p><ol><li>å‡½æ•°å®å®šä¹‰æ›¿æ¢</li><li>è¿è¡Œæ—¶è®¡ç®—</li></ol><p> <strong>ç»“è®ºï¼š åœ¨å®å®šä¹‰å‡½æ•°è°ƒç”¨æ—¶æ³¨æ„æ‹¬å·çš„é—®é¢˜</strong>ï¼Œä¸åŠ æ‹¬å·å¯èƒ½ä¼š<del>ç”±äºè¿ç®—ç¬¦ä¼˜å…ˆçº§è€Œ</del> å¯¼è‡´è¡¨è¾¾å¼æ„ä¹‰ä¸æˆ‘ä»¬æƒ³çš„æœ‰å‡ºå…¥?</p><hr><h5 id="åœ°å€è¿ç®—æ³¨æ„ç‚¹"><a href="#åœ°å€è¿ç®—æ³¨æ„ç‚¹" class="headerlink" title="åœ°å€è¿ç®—æ³¨æ„ç‚¹"></a>åœ°å€è¿ç®—æ³¨æ„ç‚¹</h5><p>å…ˆç»™å‡ºè¿™æ ·ä¸€ä¸ªç»“æ„ä½“ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">struct test &#123;</span><br><span class="line">void* a, *b, *c;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><pre><code>int main(void) {cout &lt;&lt; sizeof(test) &lt;&lt; endl;test* p = new test;fprintf(stdout, &quot;%p:%p:%p:%p\n&quot;, p, p + 1, (char*)p + 1, (int*)p+1);return 0;}</code></pre><p>&emsp;&emsp;åœ¨è¿™æ ·ä¸€ä¸ªæµ‹è¯•ä»£ç ä¸­ï¼Œå¤§å®¶è§‰å¾—p + 1, (char<em>)p + 1, (int</em>)p+1è¿™ä¸‰ä¸ªç»“æœï¼Œç›¸å¯¹äºpçš„æ•°å€¼ç›¸å·®å¤šå°‘å‘¢ï¼Ÿ<br><img src="https://img-blog.csdnimg.cn/20190814211800282.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>&emsp;&emsp;è¿è¡Œç»“æœæ˜¯è¿™æ ·çš„ã€‚ç±»å‹ä¸åœ°å€çš„è¿ç®—æ˜¯æœ‰ç€å¯†åˆ‡å…³ç³»çš„ã€‚</p><ul><li>p + 1æ˜¯ä¸€ä¸ªé»˜è®¤æƒ…å†µï¼Œ è¿™æ—¶1çš„æ„ä¹‰æ˜¯ä¸€ä¸ªpçš„åœ°å€å®½åº¦</li><li>(char*)p + 1ï¼Œpè¢«è§£é‡Šä¸ºcharç±»å‹æŒ‡é’ˆï¼ŒæŒ‡å‘çš„åœ°å€è¢«è§£é‡Šä¸ºcharï¼Œäºæ˜¯1å°±æ˜¯ä¸€ä¸ªcharçš„åœ°å€å®½åº¦ã€‚</li></ul><p><strong>æ€»ç»“ï¼š</strong> åœ¨è®¡ç®—åœ°å€æ—¶ï¼Œè¦æ³¨æ„è¿ç®—ç¬¦å·¦è¾¹å€¼çš„ç±»å‹ã€‚ä½ åŠ ä¸Šçš„1å¯èƒ½å¹¶ä¸æ˜¯ä¸€ä¸ªå­—èŠ‚çš„å¤§å°ã€‚</p><blockquote><p>è¿™æ˜¯æˆ‘è¾¹çœ‹raxè¾¹å®ç°çš„ä¸€ä¸ªå°ç»ƒä¹ ï¼Œæ¬¢è¿å¤§å®¶æŒ‡æ•™ï¼š<a href="https://github.com/LurenAA/radix_tree" target="_blank" rel="noopener">https://github.com/LurenAA/radix_tree</a> ï¼Œå¥½æƒ³è¦ä¸ªstarï¼Œæ±‚æ±‚äº†ï¼Œå…„å¼ŸèŒ:kissing_heart:</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> raxæºç é˜…è¯» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>redisåŸºæ•°æ ‘raxæºç åˆ†æ(2)</title>
      <link href="/2019/08/12/rax2/"/>
      <url>/2019/08/12/rax2/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ä»Šå¤©æˆ‘æƒ³è¦è¯´çš„æ˜¯raxä¸­çš„paddingè¿™ä¸ªå‡½æ•°ï¼Œæˆ‘æŸ¥äº†å¾ˆå¤šçš„èµ„æ–™ï¼Œå¤§å®¶çš„åšå®¢éƒ½å‘Šè¯‰æˆ‘ä»¬å†…å­˜å¯¹é½æé«˜æ€§èƒ½ï¼Œå´æ²¡æœ‰å»åˆ†æä¸ºä»€ä¹ˆï¼Œæ˜¯æœ‰æ ¹æ®è®©ä½œè€…é€‰æ‹©è¿™æ ·åšï¼Ÿå¦‚æœåªæ˜¯è¿™æ ·ç®€å•çš„æ”¾è¿‡ï¼Œæ€»æ„Ÿè§‰è®©äººæœ‰ä¸€ä¸çš„é—æ†¾ã€‚</p></blockquote><hr><p>&emsp;&emsp;<br><strong>å…ˆæŠŠä¸»è§’æ‹‰å‡ºæ¥ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#define raxPadding(nodesize) </span><br><span class="line">((sizeof(void*)-((nodesize+4) % sizeof(void*))) &amp; (sizeof(void*)-1))</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;é¦–å…ˆè¦è¯´çš„æ˜¯raxPaddingçš„ä½œç”¨æ˜¯ï¼šè®©raxNewNodeç”³è¯·çš„å†…å­˜nodesizeæ˜¯8çš„å€æ•°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">raxNode *raxNewNode(size_t children, int datafield) &#123;</span><br><span class="line">    size_t nodesize = sizeof(raxNode)+children+raxPadding(children)+</span><br><span class="line">                      sizeof(raxNode*)*children;</span><br><span class="line">    if (datafield) nodesize += sizeof(void*);</span><br><span class="line">    raxNode *node = rax_malloc(nodesize);</span><br><span class="line">    if (node == NULL) return NULL;</span><br><span class="line">    node-&gt;iskey = 0;</span><br><span class="line">    node-&gt;isnull = 0;</span><br><span class="line">    node-&gt;iscompr = 0;</span><br><span class="line">    node-&gt;size = children;</span><br><span class="line">    return node;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šå¯¹é½çš„ä¼˜åŠ¿"><a href="#ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šå¯¹é½çš„ä¼˜åŠ¿" class="headerlink" title="ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šå¯¹é½çš„ä¼˜åŠ¿"></a>ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šå¯¹é½çš„ä¼˜åŠ¿</h6><p>&emsp;&emsp;è¿™ä¸ªå¹¶ä¸æ˜¯æˆ‘æƒ³è¯´çš„é‡ç‚¹ï¼Œè¿™é‡Œæ˜¯å¤§å®¶éƒ½è°ˆåˆ°çš„ï¼Œä¹Ÿå°±æ˜¯<strong>ç»è¿‡å†…å­˜å¯¹é½ä¹‹åï¼ŒCPUçš„å†…å­˜è®¿é—®é€Ÿåº¦å¤§å¤§æå‡</strong>ã€‚å¯¹äºæˆ‘æ¥è¯´ï¼Œè¿™ä¸ªç»“è®ºæ„Ÿè§‰è¿˜æ˜¯å¤ªæ¨¡ç³Šï¼Œè¿™æ˜¯ä¸€ä¸ªå®šæ€§çš„ç»“è®ºï¼Œå…·ä½“çš„åº•å±‚ç»†èŠ‚å¯¹äºæˆ‘ä»¬åˆå­¦è€…æ¥è¯´å€’æ˜¯æ²¡å¿…è¦å»æ·±ç©¶ã€‚</p><h6 id="ç¬¬äºŒä¸ªé—®é¢˜ï¼šä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå»åšï¼Ÿ"><a href="#ç¬¬äºŒä¸ªé—®é¢˜ï¼šä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå»åšï¼Ÿ" class="headerlink" title="ç¬¬äºŒä¸ªé—®é¢˜ï¼šä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå»åšï¼Ÿ"></a>ç¬¬äºŒä¸ªé—®é¢˜ï¼šä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå»åšï¼Ÿ</h6><p>&emsp;&emsp;raxçš„ä½œè€…è¿™æ ·çš„åšæ³•å…¶å®æ˜¯<strong>å‚è€ƒç»“æ„ä½“çš„åšæ³•</strong>ã€‚<br><strong>ä¸¾ä¸ªä¾‹å­ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">struct X</span><br><span class="line">&#123;</span><br><span class="line">    char a;</span><br><span class="line">    int c;</span><br><span class="line">    double b;</span><br><span class="line">&#125;S2;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸€ä¸ªç»“æ„ä½“ï¼Œå®ƒçš„å¤§å°æ˜¯å¤šå°‘ï¼Ÿç­”æ¡ˆæ˜¯16ã€‚<br>åœ¨cè¯­è¨€çš„å†…éƒ¨ï¼Œåšäº†è¿™æ ·çš„å†…å­˜å¯¹é½å¤„ç†ï¼š<br><img src="https://img-blog.csdnimg.cn/20190812190523897.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMDE1MDQ4,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><blockquote><p>è¿™é‡Œè½¬è½½äº†<a href="https://www.cnblogs.com/zhoujiayi/p/7872262.html" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>ä¸­çš„å¾ˆå¤šèµ„æºï¼Œå¤§å®¶ä¹Ÿå¯ä»¥å»çœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼Œå†™çš„å¾ˆä¸é”™ã€‚ä¹Ÿæœ‰æ›´å¤šä¾‹å­ã€‚</p></blockquote><h5 id="å›åˆ°raxä¸Šæ¥"><a href="#å›åˆ°raxä¸Šæ¥" class="headerlink" title="å›åˆ°raxä¸Šæ¥"></a>å›åˆ°raxä¸Šæ¥</h5><p>&emsp;&emsp; åœ¨raxçš„raxNodeè¿™ä¸ªç»“æ„ä½“ä¸­ï¼Œ<del>å› ä¸ºä½¿ç”¨äº†<strong>æŸ”æ€§æ•°ç»„</strong>ï¼Œæ‰€ä»¥åœ¨cè¯­è¨€æœ¬èº«æ˜¯æ— æ³•å¸®åŠ©æˆ‘ä»¬å®ç°åƒä¸Šé¢ä¸€æ ·çš„å†…å­˜å¯¹é½çš„ï¼ˆsizeof(raxNode) == 4,æˆ‘ä»¬ç”³è¯·çš„å†…å­˜å¤§å°å†³å®šäº†æŸ”æ€§æ•°ç»„çš„é•¿åº¦ï¼Œè¯¦æƒ…è¯·ç™¾åº¦æŸ”æ€§æ•°ç»„ï¼‰</del> ï¼Œcè¯­è¨€å¯¹äºç»“æ„ä½“çš„ä¼˜åŒ–æ²¡æœ‰åŒ…å«æŸ”æ€§æ•°ç»„è¿™ä¸ªéƒ¨åˆ†ï¼Œæ‰€ä»¥<strong>æˆ‘ä»¬å¿…é¡»è‡ªå·±æ¥æ¥ç®¡è¿™ä¸€éƒ¨åˆ†çš„å†…å­˜å¯¹é½ï¼Œä¿è¯ç¨‹åºçš„è¿è¡Œæ•ˆç‡ã€‚</strong></p><pre><code>typedef struct raxNode {uint32_t iskey:1;     /* Does this node contain a key? */uint32_t isnull:1;    /* Associated value is NULL (don&apos;t store it). */uint32_t iscompr:1;   /* Node is compressed. */uint32_t size:29;     /* Number of children, or compressed string len. */unsigned char data[];} raxNode;</code></pre><blockquote><p>è¿™æ˜¯æˆ‘è¾¹çœ‹raxè¾¹å®ç°çš„ä¸€ä¸ªå°ç»ƒä¹ ï¼Œæ¬¢è¿å¤§å®¶æŒ‡æ•™ï¼š<a href="https://github.com/LurenAA/radix_tree" target="_blank" rel="noopener">https://github.com/LurenAA/radix_tree</a> ï¼Œå¥½æƒ³è¦ä¸ªstarï¼Œæ±‚æ±‚äº†ï¼Œå…„å¼ŸèŒ:kissing_heart:</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> raxæºç é˜…è¯» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>redisåŸºæ•°æ ‘raxæºç åˆ†æ(1)</title>
      <link href="/2019/08/12/rax1/"/>
      <url>/2019/08/12/rax1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>&emsp;&emsp;æœ€è¿‘æƒ³ç”¨libuvå†™ä¸ªhttpæœåŠ¡å™¨ï¼Œçœ‹åˆ°äº†è¿™ä¸ªå¼€æºé¡¹ç›®<a href="https://github.com/haywire/haywire" target="_blank" rel="noopener">haywire</a>ï¼Œåœ¨çœ‹åˆ°ç¬¬39æ¬¡æäº¤çš„æ—¶å€™ï¼Œä½œè€…ç”¨åŸºæ•°æ ‘æ¥å­˜å‚¨ä¸åŒè·¯ç”±çš„controllerï¼Œä¸è¿‡åœ¨åç»­ç‰ˆæœ¬ä¸­æ”¹ä¸ºäº†ä½¿ç”¨hashï¼Œä¸è¿‡æƒ³æ¥ä¸å¦‚æ­£å¥½å­¦å­¦åŸºæ•°æ ‘ï¼Œä½œè€…ä½¿ç”¨çš„åŸºæ•°æ ‘æ˜¯è¿™ä¸ªç‰ˆæœ¬<a href="https://github.com/j0sh/radixtree" target="_blank" rel="noopener">radix_tree</a>ï¼Œè¿™ä¸ªç‰ˆæœ¬ç¼ºå°‘æ³¨é‡Šï¼Œä¸”å’Œä¸€èˆ¬æ€è·¯ä¸ä¸€æ ·çš„ä½¿ç”¨çš„æ˜¯äºŒå‰æ ‘è€ŒéNå‰æ ‘ï¼Œä¸ºäº†ç†è§£æ–¹ä¾¿ï¼Œæˆ‘é€‰æ‹©äº†æ³¨é‡Šè¾ƒå¤šçš„<a href="https://github.com/antirez/rax" target="_blank" rel="noopener">rax</a></p></blockquote><hr><h5 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h5><p>&emsp;&emsp;é¦–å…ˆè¦æåˆ°çš„æ˜¯raxçš„æ•°æ®ç»“æ„è®¾è®¡ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">typedef struct raxNode &#123;</span><br><span class="line">    uint32_t iskey:1;     /* Does this node contain a key? */</span><br><span class="line">    uint32_t isnull:1;    /* Associated value is NULL (don&apos;t store it). */</span><br><span class="line">    uint32_t iscompr:1;   /* Node is compressed. */</span><br><span class="line">    uint32_t size:29;     /</span><br><span class="line">    unsigned char data[];</span><br><span class="line">&#125; raxNode;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç¬¬ä¸€ä¸ªè¦è¯´åˆ°çš„ç‚¹æ˜¯ï¼šä½ è§‰å¾—è¿™æ ·ä¸€ä¸ªæ•°æ®ç»“æ„çš„å¤§å°æ˜¯å¤šå°‘ï¼Ÿ24ï¼Ÿ 16ï¼Ÿ è¿˜æ˜¯8ï¼Ÿ<br><img src="https://img-blog.csdnimg.cn/20190811233343948.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>&emsp;&emsp;<strong>ç¬¬ä¸€ä¸ªåŸå› </strong>æ˜¯ä½åŸŸï¼Œä¹Ÿå°±æ˜¯ç»“æ„ä½“ä¸­çš„<strong>å†’å·ï¼š</strong>  ï¼Œå†’å·åœ¨è¿™é‡Œå£°æ˜å®é™…éœ€è¦ä½¿ç”¨çš„ä½æ•°ï¼Œiskeyï¼Œisnullï¼Œiscomprï¼Œsizeå››ä¸ªä¸€å…±åŠ èµ·æ¥32ä½ï¼Œå 4ä¸ªå­—èŠ‚ã€‚<br>&emsp;&emsp;<strong>ç¬¬äºŒä¸ªåŸå› </strong>æ˜¯data[]å 0ä¸ªå­—èŠ‚ã€‚unsigned char data[];è¿™æ ·ä¸€ä¸ªç»“æ„åœ¨è¿™é‡Œå¹¶ä¸æ˜¯ç†è§£æˆä¸€ä¸ªæŒ‡é’ˆ8ä¸ªå­—èŠ‚ã€‚è€Œæ˜¯ä¸€ä¸ª<strong>æŸ”æ€§æ•°ç»„</strong>çš„æ¦‚å¿µï¼Œå®ç°ä¸€ä¸ªå¯å˜é•¿åº¦ã€‚data[1]å ç»“æ„ä½“1ä¸ªå­—èŠ‚ï¼Œdata[2]å ç»“æ„ä½“2ä¸ªå­—èŠ‚â€¦â€¦.data[13]å 13ä¸ªå­—èŠ‚ã€‚æ•°ç»„ç±»å‹çš„å†…å­˜æ˜¯ç»“æ„ä½“ä¸­ç›´æ¥åˆ†é…çš„ï¼Œè€Œä¸æ˜¯åƒæŒ‡é’ˆä¸€æ ·éœ€è¦æˆ‘ä»¬åæ¥åˆ†é…ã€‚å¦‚ä¸‹å›¾å¯è§ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">typedef struct raxNode &#123;</span><br><span class="line">    unsigned char data[13];</span><br><span class="line">&#125; raxNode;</span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">  printf(&quot;%d\n&quot;, sizeof(raxNode));</span><br><span class="line"></span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20190812000143659.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><hr><h5 id="data"><a href="#data" class="headerlink" title="data[]"></a>data[]</h5><p>&emsp;&emsp;æ¥ä¸‹æ¥æˆ‘ä»¬è¿˜æ˜¯è¦è°ˆdataï¼Œåœ¨è¿™é‡Œdataçš„æ„ä¹‰å¹¶ä¸æ˜¯ä¸€ä¸ªç®€å•çš„unsigned charæ•°ç»„ï¼Œå®ƒå­˜å‚¨çš„æ˜¯é”®å€¼keyå’ŒradixNodeæŒ‡é’ˆä¸¤ç§å˜é‡ã€‚<br><img src="https://img-blog.csdnimg.cn/20190812001425256.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å›¾æ¥è‡ªï¼š<a href="https://my.oschina.net/yunqi/blog/3039132" target="_blank" rel="noopener">https://my.oschina.net/yunqi/blog/3039132</a><br>dataçš„å®é™…ä½¿ç”¨æ–¹å¼åœ¨å¤§å¤šæ•°æ—¶å€™æ˜¯ä»¥<strong>å†…å­˜åœ°å€</strong>çš„æ–¹å¼è¿›è¡Œçš„ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#define raxNodeLastChildPtr(n) ((raxNode**) ( \</span><br><span class="line">    ((char*)(n)) + \</span><br><span class="line">    raxNodeCurrentLength(n) - \</span><br><span class="line">    sizeof(raxNode*) - \</span><br><span class="line">    (((n)-&gt;iskey &amp;&amp; !(n)-&gt;isnull) ? sizeof(void*) : 0) \</span><br><span class="line">))</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;è¿™æ˜¯è®¿é—®æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„å‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯è®¿é—®å›¾ä¸­çš„A-ptrï¼‰ã€‚næ˜¯ä¸€ä¸ªraxNode*æŒ‡é’ˆï¼Œå¯¹è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘çš„åœ°å€è¿›è¡Œï¼‹æ“ä½œæ¥å¾—åˆ°æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„åœ°å€ã€‚</p><hr><h5 id="èŠ‚ç‚¹çš„è¡¨ç¤º"><a href="#èŠ‚ç‚¹çš„è¡¨ç¤º" class="headerlink" title="èŠ‚ç‚¹çš„è¡¨ç¤º"></a>èŠ‚ç‚¹çš„è¡¨ç¤º<img src="https://img-blog.csdnimg.cn/20190812001723801.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMDE1MDQ4,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></h5><p>å›¾æ¥è‡ªï¼š<a href="https://my.oschina.net/yunqi/blog/3039132" target="_blank" rel="noopener">https://my.oschina.net/yunqi/blog/3039132</a><br>&emsp;&emsp;å‡è®¾åŸºæ•°æ ‘ä¸­æœ‰â€œabcdâ€è¿™ä¸ªé”®å€¼çš„èŠ‚ç‚¹ã€‚é‚£ä¹ˆå®ƒçš„è¡¨ç¤ºå½¢å¼æ˜¯åƒä¸Šå›¾è¿™æ ·çš„ã€‚â€œabcdâ€è¿™ä¸ªèŠ‚ç‚¹çš„value-dataå­˜å‚¨åœ¨å›¾ç‰‡ä¸‹åŠéƒ¨åˆ†çš„èŠ‚ç‚¹å¤„ï¼Œå¹¶ä¸”ä¸‹é¢ä¸€ä¸ªèŠ‚ç‚¹iskeyè®¾ä¸º1.<br>&emsp;&emsp;<strong>ä¸ºä»€ä¹ˆä¸æ˜¯ç›´æ¥åªæœ‰å›¾ç‰‡çš„ä¸ŠåŠéƒ¨åˆ†ï¼Œç”±å›¾ç‰‡ä¸ŠåŠéƒ¨åˆ†é‚£ä¸ªèŠ‚ç‚¹å°†iskeyè®¾ç½®ä¸º1å¹¶ä¸”å°†å€¼å­˜å‚¨åœ¨å…¶valueÂ·dataä¸­å‘¢ï¼Ÿ</strong><br>åƒè¿™æ ·ï¼š <strong>[iskey:1][isnull: 0][iscompr:1][size:4][abcd] [z-ptr ][value-ptr]</strong></p><h4 id="å…ˆç»™å‡ºç»“è®ºï¼š-åœ¨raxä¸­ä¸€ä¸ªèŠ‚ç‚¹çš„å­˜åœ¨ï¼ˆiskey-1ï¼‰æ˜¯ç”±dataä¸­å¯¹åº”çš„å­èŠ‚ç‚¹æ¥è¡¨ç¤ºçš„ã€‚"><a href="#å…ˆç»™å‡ºç»“è®ºï¼š-åœ¨raxä¸­ä¸€ä¸ªèŠ‚ç‚¹çš„å­˜åœ¨ï¼ˆiskey-1ï¼‰æ˜¯ç”±dataä¸­å¯¹åº”çš„å­èŠ‚ç‚¹æ¥è¡¨ç¤ºçš„ã€‚" class="headerlink" title="å…ˆç»™å‡ºç»“è®ºï¼š åœ¨raxä¸­ä¸€ä¸ªèŠ‚ç‚¹çš„å­˜åœ¨ï¼ˆiskey == 1ï¼‰æ˜¯ç”±dataä¸­å¯¹åº”çš„å­èŠ‚ç‚¹æ¥è¡¨ç¤ºçš„ã€‚"></a>å…ˆç»™å‡ºç»“è®ºï¼š åœ¨raxä¸­ä¸€ä¸ªèŠ‚ç‚¹çš„å­˜åœ¨ï¼ˆiskey == 1ï¼‰æ˜¯ç”±dataä¸­å¯¹åº”çš„å­èŠ‚ç‚¹æ¥è¡¨ç¤ºçš„ã€‚</h4><p><strong>åŸå› å¾ˆç®€å•ï¼š</strong><br><img src="https://img-blog.csdnimg.cn/20190812002913974.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åœ¨è¿™ä¸ªä¾‹å­é‡Œé¢ï¼Œè¿™æ˜¯ä¸€ä¸ªæ²¡æœ‰å‹ç¼©çš„èŠ‚ç‚¹ï¼Œè¿™ä¸€å±‚ç”±aå’ŒAä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œå¦‚æœåœ¨å½“å‰å±‚æ¬¡è¡¨ç¤ºï¼Œå¦‚ä½•åˆ†è¾¨ä½ æŒ‡å®šçš„æ˜¯aè¿˜æ˜¯Aï¼Ÿæ‰€ä»¥ç”¨å¼•å‡ºå­èŠ‚ç‚¹æ¥è¡¨ç¤ºã€‚</p><blockquote><p>è¿™æ˜¯æˆ‘è¾¹çœ‹raxè¾¹å®ç°çš„ä¸€ä¸ªå°ç»ƒä¹ ï¼Œæ¬¢è¿å¤§å®¶æŒ‡æ•™ï¼š<a href="https://github.com/LurenAA/radix_tree" target="_blank" rel="noopener">https://github.com/LurenAA/radix_tree</a> ï¼Œå¥½æƒ³è¦ä¸ªstarï¼Œæ±‚æ±‚äº†ï¼Œå…„å¼ŸèŒ:kissing_heart:</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> raxæºç é˜…è¯» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•é€€å‡ºnohupè¿è¡Œçš„ç¨‹åºï¼Ÿ</title>
      <link href="/2019/07/04/problems8/"/>
      <url>/2019/07/04/problems8/</url>
      
        <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -aux | grep ç¨‹åºå | grep -v grep</span><br></pre></td></tr></table></figure><p>ps -auxå¯ä»¥æ˜¾ç¤ºæ‰€æœ‰çš„è¿›ç¨‹ã€‚<br>grep ç¨‹åºåæŸ¥æ‰¾ä½ è¦æ‰¾çš„ç¨‹åºã€‚<br>grep -v grepè¿‡æ»¤æ‰grepè¿™ä¸ªè¿›ç¨‹ã€‚</p><p>è¿™æ ·å°±å¯ä»¥æ‰¾åˆ°è¿è¡Œè¯¥ç¨‹åºçš„è¿›ç¨‹çš„è¿›ç¨‹å·ï¼Œç„¶å</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill pid</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> é‡è§çš„é—®é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
